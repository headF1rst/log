{"pageProps":{"postData":{"id":"text-me-diary1","lang":"ko","title":"GitHub Actionsë¥¼ í†µí•´ CI/CD êµ¬ì¶•í•˜ê¸° (feat. Docker, Jib)","category":null,"thumbnail":"https://miro.medium.com/max/1400/1*DmFbJvnRIiQIyi5xBuIXlQ.png","tags":"tech, í”„ë¡œì íŠ¸, CI/CD, Docker","date":"2022-12-06 10:00","preview":"\nì €í¬ `Text Me` ì„œë¹„ìŠ¤ì˜ ë² íƒ€ ë²„ì „ì´ ë°°í¬ë˜ê³  ë‚œ ë’¤ì—, ì‚¬ìš©ìë“¤ë¡œ ë¶€í„° ìˆ˜ë§ì€ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. \nì‚¬ìš©ì í”¼ë“œë°±ì„ ë¹ ë¥´ê²Œ ë°˜ì˜í•˜ë‹¤ ë³´ë‹ˆ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° ë°°í¬ ì£¼ê¸°ê°€ ì§§ì•„ì¡Œê³  ì´ëŸ¬í•œ ê³¼ì •ì´ ì„œì„œíˆ ë²ˆê±°ë¡­ê²Œ ëŠê»´ì§€ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤"},"detail":"\nì €í¬ `Text Me` ì„œë¹„ìŠ¤ì˜ ë² íƒ€ ë²„ì „ì´ ë°°í¬ë˜ê³  ë‚œ ë’¤ì—, ì‚¬ìš©ìë“¤ë¡œ ë¶€í„° ìˆ˜ë§ì€ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. \nì‚¬ìš©ì í”¼ë“œë°±ì„ ë¹ ë¥´ê²Œ ë°˜ì˜í•˜ë‹¤ ë³´ë‹ˆ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° ë°°í¬ ì£¼ê¸°ê°€ ì§§ì•„ì¡Œê³  ì´ëŸ¬í•œ ê³¼ì •ì´ ì„œì„œíˆ ë²ˆê±°ë¡­ê²Œ ëŠê»´ì§€ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.\n\nì‚¬ìš©ìì˜ í”¼ë“œë°±ì„ ë¹ ë¥´ê²Œ ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” í•˜ë£¨ì— ë§ê²ŒëŠ” 20ë²ˆì˜ ë°°í¬ê°€ ì´ë£¨ì–´ì ¸ì•¼í–ˆê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° ë°°í¬ê³¼ì •ì„ ìë™í™” í•˜ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤. \n(í•˜ë£¨ì— 1,000ë²ˆ ì´ìƒì˜ í¬ê³  ì‘ì€ ë°°í¬ê°€ ì´ë¤„ì§€ëŠ” í…Œí¬ ê¸°ì—…ì— ë¹„í•˜ë©´ ê·€ì—¬ìš´ ìˆ˜ì¤€ì´ì§€ë§Œ ë§ì´ì£ â€¦ )\n\nì´ë²ˆ ê¸€ì—ì„œëŠ” ì €í¬ê°€ CI/CD ë„êµ¬ ì¤‘ GitHub Actionsë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì™€ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ì„œ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤.\n\n## 1. GitHub Actionsì˜ ì¥ì \n\nGitHub Actoinsë¥¼ CI ì†”ë£¨ì…˜ìœ¼ë¡œ ì±„íƒí•˜ê²Œ ëœ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\n\n- GitHubì™€ í†µì¼ëœ í™˜ê²½ì—ì„œ CI ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë‹¤.\n- ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” `GitHub Actions Runner` ì— ì§€ì†ì ìœ¼ë¡œ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…í•˜ì—¬ ì›í™œí•œ CI í™˜ê²½ êµ¬ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.\n- í”„ë¡œì íŠ¸ë§ˆë‹¤ ê°œë³„ Runnerë¥¼ í†µí•œ ë¹Œë“œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.\n- ì¹œìˆ™í•œ ë¬¸ë²•ì˜ YAML íŒŒì¼ë¡œ íŒŒì´í”„ë¼ì¸ êµ¬ì„±ì´ ê°„ë‹¨í•˜ë‹¤.\n\n- GitHub Actions Runnerë€?\n    - GitHub Actionsë¥¼ ê¸°ë™í•˜ëŠ” Runner\n    - GitHubëŠ” í¼ë¸”ë¦­ ìª½ì˜ GitHub Actions Runnerë¥¼ í´ë¼ìš°ë“œì—ì„œ ì œê³µí•´ ì£¼ê³  ìˆë‹¤.\n        - ë•ë¶„ì— ì§ì ‘ í”„ë¡œë¹„ì €ë‹í•  í•„ìš” ì—†ì´ Runnerë¥¼ ë°”ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n## 2. Github Actionì˜ êµ¬ì„± ìš”ì†Œ\n\n- workflow\n    - í•œê°œ ì´ìƒì˜ `job` ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìë™í™”ëœ ì‘ì—…\n    - `YAML` íŒŒì¼ë¡œ ì‘ì„±ëœë‹¤.\n    - `event` ì— ì˜í•´ì„œ ì‹¤í–‰ëœë‹¤.\n- event\n    - `workflow` ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” íŠ¹ì • í™œë™\n    - ê¹ƒí—ˆë¸Œì—ì„œ ë°œìƒí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì„ eventë¡œ ì •ì˜ ê°€ëŠ¥.\n        - ex) `push event` , `pull request event` , `issue event`\n- jobs\n    - í•œê°€ì§€ `runner` ì•ˆì—ì„œ ì‹¤í–‰ë˜ëŠ” ì—¬ëŸ¬ `step` ë“¤ì˜ ëª¨ìŒ\n    - ê° `step` ë“¤ì€ ì¼ì¢…ì˜ `shell script` ì²˜ëŸ¼ ì‹¤í–‰ëœë‹¤.\n    - stepë“¤ì€ ìˆœì„œì— ë”°ë¼ ì‹¤í–‰ë˜ë©° stepë¼ë¦¬ ë°ì´í„° ê³µìœ ê°€ ê°€ëŠ¥í•˜ë‹¤\n    - jobì€ ë‹¤ë¥¸ jobì— ì˜ì¡´ê´€ê³„ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©° `ë³‘ë ¬ ì‹¤í–‰` ì´ ê°€ëŠ¥í•˜ë‹¤.\n- actions\n    - ë°˜ë³µ ì‘ì—…ì„ ì •ì˜í•œ ì»¤ìŠ¤í…€ ì–´í”Œë¦¬ì¼€ì´ì…˜\n    - workflow íŒŒì¼ì—ì„œ ìì£¼ ë°˜ë³µë˜ëŠ” ì½”ë“œë¥¼ ë¯¸ë¦¬ ì •ì˜í•  ìˆ˜ ìˆë‹¤.\n        - ì½”ë“œ ì–‘ì„ ì¤„ì´ëŠ” ì´ì \n    - ê¹ƒí—ˆë¸Œ ë§ˆì¼“í”Œë ˆì´ìŠ¤ë¥¼ í†µí•´ ë‹¤ë¥¸ ì‚¬ëŒì´ ë§Œë“  action ì‚¬ìš© ê°€ëŠ¥\n\në” ìì„¸í•œ GitHub Actions workflow syntaxëŠ” [í•´ë‹¹ í¬ìŠ¤íŠ¸](https://jinmay.github.io/2020/05/13/git/github-action-syntax/)ë¥¼ ì°¸ê³ í•˜ë©´ ë„ì›€ì´ ë˜ì‹¤ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\n![ë¨€](https://i.imgur.com/9tu0sgH.png)\n\n## 3. Github Actionìœ¼ë¡œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•˜ê¸°\n\në‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ íŒŒì´í”„ë¼ì¸ì´ êµ¬ë™ë˜ë„ë¡ workflowë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n1. Github Actionì´ íŠ¸ë¦¬ê±°ë˜ë©´ jibë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œë‹¤.\n2. ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ë¥¼ DockerHubì— pushí•œë‹¤.\n3. ì„œë²„ì— ì ‘ì†í•´ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ pull í•œë‹¤.\n\n`.github/workflows` ë””ë ‰í† ë¦¬ë¥¼ í”„ë¡œì íŠ¸ì— ìƒì„±í•˜ê³ , ê±°ê¸°ì— gradle ë¹Œë“œë¥¼ ìœ„í•œ `build_backend.yml` ì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### 3.1 build_backend.yml\n\në‹¤ìŒ `jobs` ê°€ ì‹¤ì œë¡œ CIë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì´ë©° `steps` ë‹¨ê³„ë¡œ jobsê°€ ì§„í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.\n\n```yaml\nname: Build Backend Image\n\non:\n  pull_request:\n    branches:\n      - production\n      - master\n    paths:\n      - \"backend/**\"\n  workflow_dispatch:\n\ndefaults:\n  run:\n    working-directory: \"backend/text-me\"\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - name: Set up JDK 11\n        uses: actions/setup-java@v1\n        with:\n          java-version: '11'\n          distribution: 'temurin'\n\n      - name: Set environment variables\n          run:|\n            echo \"::set-env name=DB_URL::${{ secrets.DB_URL }}\"\n            echo \"::set-env name=DB_USERNAME::${{ secrets.DB_USERNAME }}\"\n            echo \"::set-env name=DB_PASSWORD::${{ secrets.DB_PASSWORD }}\"\n            echo \"::set-env name=JWT_KEY::${{ secrets.JWT_KEY }}\"\n            echo \"::set-env name=JWT_EXPIRY::${{ secrets.JWT_EXPIRY }}\"\n            echo \"::set-env name=REFRESH_EXPIRY::${{ secrets.REFRESH_EXPIRY }}\"\n            echo \"::set-env name=AWS_ACCESS_KEY_ID::${{ secrets.AWS_ACCESS_KEY_ID }}\"\n            echo \"::set-env name=AWS_SECRET_ACCESS_KEY::${{ secrets.AWS_SECRET_ACCESS_KEY }}\"\n\n      - name: Login to Docker Hub\n        uses: docker/login-action@v2.1.0\n        with:\n          username: ${{ secrets.DOCKERHUB_USERNAME }}\n          password: ${{ secrets.DOCKERHUB_PASSWORD }}\n\n      - name: Grant execute permission for gradlew\n        run: chmod +x gradlew\n        shell: bash\n\n      - name: Build with jib\n        run: |\n          ./gradlew jib \\\n          -Djib.to.auth.username=${{ secrets.DOCKERHUB_USERNAME }} \\\n          -Djib.to.auth.password=${{ secrets.DOCKERHUB_PASSWORD }} \\\n          -Djib.to.image=\"${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/}\"\n\n      - name: Get current time\n        uses: 1466587594/get-current-time@v2\n        id: current-time\n        with:\n          format: YYYY-MM-DDTHH-mm-ss\n          utcOffset: \"+09:00\"\n\n      - name: Show Current Time\n        run: echo \"CurrentTime=${{steps.current-time.outputs.formattedTime}}\"\n        shell: bash\n```\n\në¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì— ì‘ì„±ëœ ë‚´ìš©ì„ ì¢€ ë” ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n- `jobs: build: runs-on: ubuntu-latest`\n  - ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ë™ë  OS í™˜ê²½ì„ ì§€ì •í•©ë‹ˆë‹¤.\n  - text me ì„œë¹„ìŠ¤ëŠ” ìš°ë¶„íˆ¬ 18.04ì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— `ubuntu-latest` ë¡œ ì§€ì •í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.\n    ![d](https://i.imgur.com/mRZU1aq.png)\n    \n- `steps: uses`\n    - ë§ˆì¼“ í”Œë ˆì´ìŠ¤ì— ì‚¬ì „ ì •ì˜ëœ ë‚´ìš©ì„ ì´ìš©í•˜ì—¬ stepì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n    - ì‚¬ì „ ì‘ì—…ì„ ìœ„í•œ í™˜ê²½ ì„¤ì •ìš©.\n      ![d](https://i.imgur.com/xZ8nmau.png)\n\n- `steps: run`\n    - ê°œë°œìê°€ ì§ì ‘ ì •ì˜í•œ ì»¤ë§¨ë“œë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n    - ì‹¤ì œ ìˆ˜í–‰ìš©.\n\n- `-Djib.to.image=\"${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/}\"`\n  - Jibë¥¼ í†µí•´ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•´ì„œ ë„ì»¤ í—ˆë¸Œì— push í•©ë‹ˆë‹¤.\n\n**ë„ì»¤ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì™€ JIB**\n\nìŠ¤í”„ë§ í”„ë¡œì íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\n\n- **ë¡œì»¬ í™˜ê²½ì—ì„œ jar íŒŒì¼ ë¹Œë“œ , jar íŒŒì¼ì„ ì´ë¯¸ì§€ì— ë³µì‚¬ í›„ ì‹¤í–‰**\n  - í”„ë¡œì íŠ¸ í´ë”ë¡œ ë“¤ì–´ê°€ì„œ gradlew clean buildë¥¼ í†µí•´ grdlewë¡œ jar íŒŒì¼ ë¹Œë“œ\n    - `./gradlew clean build`\n  - í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë“¤ì´ ì‹¤í–‰ë˜ê³  ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ `./build/libs` ì— ì‹¤í–‰ ê°€ëŠ¥í•œ jar íŒŒì¼ì´ ìƒì„±ëœë‹¤.\n  - jar íŒŒì¼ì„ ë°”íƒ•ìœ¼ë¡œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ Dockerfileì„ ì‘ì„±\n\n      ```yaml\n      FROM openjdk:11\n      ARG JAR_FILE=./build/libs/jpashop-0.0.1-SNAPSHOT.jar\n      COPY ${JAR_FILE} app.jar\n      ENTRYPOINT [\"java\",\"-Djava.security.egd=file:/dev/./urandom\",\"-jar\",\"/app.jar\"]\n      ```\n\n  - í•´ë‹¹ Dockerfileì„ í”„ë¡œì íŠ¸ í´ë”ì— ë„£ì€ í›„ docker build . -t íƒœê·¸ ì´ë¦„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ìƒì„±\n  - java11ì˜ ì‹¤í–‰í™˜ê²½ì„ ì œê³µí•˜ëŠ” openjdk:11 ì´ë¯¸ì§€ ìœ„ì—ì„œ í´ë”ì— ìˆëŠ” jar íŒŒì¼ì„ ì´ë¯¸ì§€ ë‚´ë¶€ë¡œ ë³µì‚¬ í›„ java ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰\n\n![d](https://cloud.google.com/java/images/docker_build_flow.png)\n\ní•˜ì§€ë§Œ jar íŒŒì¼ì„ ë¹Œë“œí•˜ê³  ì¶”ê°€ë¡œ ì´ë¯¸ì§€ì— ë³µì‚¬í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì€ ì†ŒìŠ¤ì½”ë“œì— ì¡°ê¸ˆì˜ ë³€í™”ë§Œ ìƒê¸°ë”ë¼ë„ ë³€ê²½ëœ ë¶€ë¶„ê³¼ ì˜ì¡´ì„±ì´ ì—°ê²°ëœ jar íŒŒì¼ ì „ì²´ê°€ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì¸ì‹ë˜ì–´ ì „ì²´ íŒŒì¼ì´ ë‹¤ì‹œ ë¹Œë“œë˜ê¸° ë•Œë¬¸ì— Docker layerì˜ ì¥ì ì„ ì‚´ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ layerë¥¼ ë‚˜ëˆ„ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ Google Cloudì—ì„œ ì œê³µí•´ì£¼ëŠ” jibë¥¼ í†µí•´ì„œ ì´ë¯¸ì§€ ë¹Œë“œë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\n- **JIBë¥¼ í†µí•œ ì´ë¯¸ì§€ ë¹Œë“œ**\n  - JibëŠ” **Dockerfile, Dockerì— ì˜ì¡´í•˜ì§€ ì•Šê³ ** gradle, mavenì—ì„œ Jib í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•´ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  í—ˆë¸Œì— í‘¸ì‹œí•˜ëŠ” ë°©ë²•.\n  - ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ **(ì¢…ì† í•­ëª©, ë¦¬ì†ŒìŠ¤, í´ë˜ìŠ¤ ë“±)** ë³„ê°œì˜ ë ˆì´ì–´ë¡œ êµ¬ì„±í•˜ê³  Docker ì´ë¯¸ì§€ ë ˆì´ì–´ ìºì‹±ì„ í™œìš©í•´ì„œ **ë³€ê²½ì‚¬í•­ë§Œ ë‹¤ì‹œ ë¹Œë“œ**í•¨ìœ¼ë¡œì¨ ë¹Œë“œë¥¼ ë¹ ë¥´ê²Œ ìœ ì§€\n  - jib ë ˆì´ì–´ êµ¬ì„±ê³¼ ì‘ì€ ê¸°ë³¸ ì´ë¯¸ì§€ëŠ” ì „ì²´ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì‘ê²Œ ìœ ì§€ì‹œí‚¤ë©° ë¹Œë“œ ì†ë„ë¥¼ í–¥ìƒ ì‹œí‚´\n\n![d](https://cloud.google.com/java/images/jib_build_flow.png)\n\n**Gradleì— jib í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ë° í™˜ê²½ ë³€ìˆ˜ ë“±ë¡**\n\n```bash\nplugins {\n    id 'com.google.cloud.tools.jib' version '3.3.1'\n}\n\njib {\n\tto {\n\t\timage = \"sanha1998/text-me-docker-repo\"\n\t}\n\tfrom {\n\t\timage = \"eclipse-temurin:11-jre\"\n\t}\n\tcontainer {\n\t\tjvmFlags = [\"-Xms128m\", \"-Xmx128m\"]\n\t\tenvironment = [\n\t\t\t\t'DB_URL': System.getenv('DB_URL'),\n\t\t\t\t'DB_USERNAME': System.getenv('DB_USERNAME'),\n\t\t\t\t'DB_PASSWORD': System.getenv('DB_PASSWORD'),\n\t\t\t\t'JWT_KEY': System.getenv('JWT_KEY'),\n\t\t\t\t'JWT_EXPIRY': System.getenv('JWT_EXPIRY'),\n\t\t\t\t'REFRESH_EXPIRY': System.getenv('REFRESH_EXPIRY'),\n\t\t\t\t'AWS_ACCESS_KEY_ID': System.getenv('AWS_ACCESS_KEY_ID'),\n\t\t\t\t'AWS_SECRET_ACCESS_KEY': System.getenv('AWS_SECRET_ACCESS_KEY')\n\t\t]\n\t}\n}\n```\n\n**í™˜ê²½ ë³€ìˆ˜ ì£¼ì…**\n\nìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œê°€ ì‹œì‘ë˜ë©´`application.yml` í˜¹ì€ `application.properties` \në‚´ì— ì„¤ì •ëœ í™˜ê²½ë³€ìˆ˜ ê°’ë“¤ì´ ì£¼ì…ë©ë‹ˆë‹¤. ì´ë•Œ AWS ê³„ì • ì •ë³´ì™€ ê°™ì€ ë¯¼ê° ì •ë³´ë¥¼ application.ymlì— ë…¸ì¶œì‹œí‚¤ì§€ ì•Šê¸° ìœ„í•´ì„œ Secrete í™˜ê²½ ë³€ìˆ˜ë¥¼ ê¹ƒí—ˆë¸Œì— ë“±ë¡í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-12-17 á„‹á…©á„’á…® 9.19.33.png](https://i.imgur.com/VPtkmpm.png)\n\nê¹ƒí—ˆë¸Œì— ë“±ë¡í•œ secrets í™˜ê²½ ë³€ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n```yaml\n- name: Set environment variables\n  run:|\n    echo \"::set-env name=DB_URL::${{ secrets.DB_URL }}\"\n    echo \"::set-env name=DB_USERNAME::${{ secrets.DB_USERNAME }}\"\n    echo \"::set-env name=DB_PASSWORD::${{ secrets.DB_PASSWORD }}\"\n    echo \"::set-env name=JWT_KEY::${{ secrets.JWT_KEY }}\"\n    echo \"::set-env name=JWT_EXPIRY::${{ secrets.JWT_EXPIRY }}\"\n    echo \"::set-env name=REFRESH_EXPIRY::${{ secrets.REFRESH_EXPIRY }}\"\n    echo \"::set-env name=AWS_ACCESS_KEY_ID::${{ secrets.AWS_ACCESS_KEY_ID }}\"\n    echo \"::set-env name=AWS_SECRET_ACCESS_KEY::${{ secrets.AWS_SECRET_ACCESS_KEY }}\"\n```\n\n### 3.2 deploy-backend\n\nì´ì œ ìš´ì˜ ì„œë²„ì—ì„œ ë„ì»¤ í—ˆë¸Œì— ì˜¬ë¦° ì´ë¯¸ì§€ë¥¼ pullí•œ ë‹¤ìŒ, ì‹¤í–‰ì‹œì¼œ ì£¼ë©´ ë©ë‹ˆë‹¤.\n\n docker ê´€ë ¨ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ [ìš´ì˜ ì„œë²„ì— dockerë¥¼ ì„¤ì¹˜](https://headf1rst.github.io/TIL/infra-1)í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\ndockerê°€ ìš´ì˜ ì„œë²„ì— ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´, ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ì‹¤í–‰ì‹œí‚¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ë°°í¬ë¥¼ ìë™í™” ì‹œì¼œ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n\n```yaml\nname: Deploy Backend\n\non:\n  push:\n    branches:\n      - production\n  workflow_dispatch:\n\ndefaults:\n  run:\n    working-directory: \"backend/text-me\"\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n\n      - name: Set up JDK 11\n        uses: actions/setup-java@v1\n        with:\n          java-version: '11'\n          distribution: 'temurin'\n\n      - name: SSH setting\n        uses: appleboy/ssh-action@master\n        with:\n          host: ${{ secrets.HOST }}\n          username: ${{ secrets.USER_NAME }}\n          key: ${{ secrets.PRIVATE_KEY }}\n          envs: GITHUB_SHA\n          script: |\n            whoami\n            docker pull ${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/}\n            docker tag ${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/} ${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/}\n            docker stop text-me-api\n            docker run -d --rm --name text-me-api -p 8080:8080 ${{ secrets.DOCKERHUB_USERNAME }}/text-me-docker-repo:${GITHUB_REF##*/}\n```\n\në°°í¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ëˆˆì—¬ê²¨ ë³¼ ë¶€ë¶„ì€ ì›ê²© ì„œë²„ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ SSH setting ë¶€ë¶„ì…ë‹ˆë‹¤. ([ssh-action](https://github.com/appleboy/ssh-action)) \n\në¡œì»¬ ì„œë²„ë¥¼ ì—´ê³  í„°ë¯¸ë„ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ssh í‚¤ë¥¼ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n- `ssh-keygen -t rsa -b 4096 -C \"ë‚´ì´ë©”ì¼@gmail.com\"`\n\n![d](https://i.imgur.com/s7q725G.png)\n\nssh í‚¤ë¥¼ `./authorized_keys2` ê²½ë¡œì— ì €ì¥í•˜ê³  ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ssh í‚¤ê°’ì„ í™•ì¸í•´ ì¤ë‹ˆë‹¤.\n\n- `vim ./ssh/authorized_keys2.pub`\n\nssh í‚¤ë¥¼ GITHUB SECRETì˜ PRIVATE_KEYë¡œ ë“±ë¡í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n![d](https://i.imgur.com/wJ7mdpG.png)\n\nëª¨ë“  ê³¼ì •ì´ ë§ˆë¬´ë¦¬ë˜ì—ˆë‹¤ë©´ ì§ì ‘ docker hubì— ì ‘ì†í•´ì„œ ì´ë¯¸ì§€ë¥¼ pull ë°›ì•„ì˜¬ í•„ìš” ì—†ì´ ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ìš´ì˜ ì„œë²„ì— ë„ì›Œì£¼ê²Œë©ë‹ˆë‹¤.\n\n## ë§ˆì¹˜ë©°\n\nì§€ê¸ˆê¹Œì§€ ê¸°í”„í„°ì¦ˆíŒ€ì´ GitHub Actionsë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì™€ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ ì„¤ëª…ë“œë ¸ìŠµë‹ˆë‹¤.\n\nì‹œê°„ì´ ëœë‹¤ë©´ í”„ë¡ íŠ¸ ë¹Œë“œ ë° ë°°í¬ ê³¼ì •ë„ í¬ìŠ¤íŒ… í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.\n\n---\n\n**ì°¸ê³  ìë£Œ** ğŸ“š\n\n- [GitHub Actionìœ¼ë¡œ CI/CD êµ¬ì¶•í•˜ê¸°](https://velog.io/@sgwon1996/GitHub-Action%EC%9C%BC%EB%A1%9C-CICD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0)\n\n- [ì¹´ì¹´ì˜¤ì—”í„°í”„ë¼ì´ì¦ˆê°€ GitHub Actionsë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ](https://tech.kakao.com/2022/05/06/github-actions/)\n\n- [Github actionsë¥¼ ì´ìš©í•œ CICD - 2](https://itcoin.tistory.com/685)\n\n- [[Github]ê¹ƒí—ˆë¸Œì˜ CIíˆ´ì¸ Actionsì˜ ë¬¸ë²• ê°„ë‹¨ ì •ë¦¬](https://jinmay.github.io/2020/05/13/git/github-action-syntax/)\n\n- [ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì— ìŠ¤í”„ë§ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬í•˜ê¸°](https://velog.io/@sgwon1996/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%99%98%EA%B2%BD%EC%97%90-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)\n","lang":"ko","allPostsInOtherLang":[]},"__N_SSG":true}