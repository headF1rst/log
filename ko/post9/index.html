<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/DP8b7FU.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/DP8b7FU.png"/><link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/DP8b7FU.png"/><link rel="manifest" href="/log/site.webmanifest"/><link rel="mask-icon" href="/log/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><title>ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°</title><meta name="title" content="ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°"/><meta name="description" content=""/><meta name="keywords" content=""/><meta name="robots" content="index, follow"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="language" content="Korean"/><meta name="author" content="Sanha Ko"/><meta property="og:title" content="ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°"/><meta property="og:url" content="https://headf1rst.github.io/log/ko/post9"/><meta property="og:type" content="blog"/><meta property="og:image" content="https://i.imgur.com/mHibXLP.jpg"/><meta property="og:description"/><link rel="alternate" hrefLang="ko" href="https://headf1rst.github.io/log/ko/post9"/><link rel="alternate" hrefLang="x-default" href="https://headf1rst.github.io/log/ko/post9"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","headline":"ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°","datePublished":"2022-09-20 10:00","dateModified":"2022-09-20 10:00","author":{"@type":"Person","name":"Sanha Ko","url":"https://github.com/headF1rst"},"description":"","image":"https://i.imgur.com/mHibXLP.jpg","url":"https://headf1rst.github.io/log/ko/post9","keywords":"Spring, ThreadPool","inLanguage":"ko-KR","about":[{"@type":"Thing","name":"Spring"},{"@type":"Thing","name":"ThreadPool"}],"programmingLanguage":"Java, Kotlin, JavaScript, TypeScript","publisher":{"@type":"Organization","name":"JustAnotherBlog","logo":{"@type":"ImageObject","url":"https://i.imgur.com/JtjOEf3.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://headf1rst.github.io/log/ko/post9"}}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://headf1rst.github.io/log/ko"},{"@type":"ListItem","position":2,"name":"ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°","item":"https://headf1rst.github.io/log/ko/post9"}]}</script><meta name="next-head-count" content="26"/><link rel="preload" href="/log/_next/static/css/34440283646fd35f.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/34440283646fd35f.css" data-n-g=""/><link rel="preload" href="/log/_next/static/css/38994dd0aed51f22.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/38994dd0aed51f22.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/log/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/log/_next/static/chunks/webpack-82b4c2acf5604dc5.js" defer=""></script><script src="/log/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/log/_next/static/chunks/main-6e6d6dc6617c8481.js" defer=""></script><script src="/log/_next/static/chunks/pages/_app-d82207f592413e1f.js" defer=""></script><script src="/log/_next/static/chunks/9f96d65d-fb5fd9e6ccafc67e.js" defer=""></script><script src="/log/_next/static/chunks/259-59cbd4b09a9629be.js" defer=""></script><script src="/log/_next/static/chunks/819-49378f41c4211145.js" defer=""></script><script src="/log/_next/static/chunks/pages/%5Blang%5D/%5Bid%5D-15e3418404732f38.js" defer=""></script><script src="/log/_next/static/RQi-WhCUNal12o9SrKu8R/_buildManifest.js" defer=""></script><script src="/log/_next/static/RQi-WhCUNal12o9SrKu8R/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="flex bg-white sticky top-0 left-0 z-50 justify-between items-center border-b-2 border-gray-100 py-3 md:justify-start md:space-x-10 px-10 sm:px-5 dark:bg-[#0d1117] dark:text-[#c9d1d9] dark:border-gray-600"><div class="flex justify-start"><a href="/log/ko/"><div class="flex items-center gap-2 cursor-pointer"><h1 class="text-lg ">JustAnotherBlog</h1></div></a></div><div class="flex justify-between gap-10 sm:hidden items-center"><a href="/log/ko/"><button class="font-light hover:text-indigo-300 text-base">Home</button></a><a href="/log/ko/?section=tech"><button class="font-light hover:text-indigo-300 text-base">Tech</button></a><a href="/log/ko/?section=domain"><button class="font-light hover:text-indigo-300 text-base">Domain</button></a><a href="https://www.linkedin.com/in/san0498/" target="_blank" rel="noreferrer" class="hover:text-indigo-300 text-base font-light flex gap-1">About<span class="flex justify-center" style="align-items:center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z"></path><path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"></path></svg></span></a><div class="relative"><button class="flex items-center gap-1 hover:text-indigo-300 text-base font-light">ğŸ‡°ğŸ‡·<!-- --> <!-- -->í•œêµ­ì–´</button></div></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="lg:hidden" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></nav><main class="dark:bg-[#0d1117] h-screen pb-10"><div class="flex flex-col w-3/5 sm:w-5/6 m-auto pt-20 pb-20 gap-10 dark:bg-[#0d1117] dark:text-[#c9d1d9]"><ul id="scroll-spy" class="sm:hidden p-10 fixed top-50 right-0 h-full w-1/5 text-gray-500 dark:text-[#c9d1d9]"></ul><div class="text-5xl font-bold">ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°</div><div class="flex flex-col gap-2"><div class="text-base text-gray-600 dark:text-gray-300">2022-09-20 10:00</div><div class="flex flex-wrap gap-2 dark:text-black sm:m-0"><span class="p-1 pl-3 pr-3 rounded-md bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition ease-in-out duration-200 text-sm">Spring</span><span class="p-1 pl-3 pr-3 rounded-md bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition ease-in-out duration-200 text-sm">ThreadPool</span></div></div><div class="flex items-center gap-2"><span class="text-sm text-gray-400">ğŸ‡ºğŸ‡¸ ì˜ì–´ë¡œ ì½ê¸°</span></div><div class="markdown-body" style="font-size:17px"><p>í”„ë ˆì„ì›Œí¬ëŠ” ê°œë°œìê°€ ì‰½ê³  í¸í•˜ê²Œ ê°œë°œì„ í•  ìˆ˜ ìˆë„ë¡ ë§ì€ ê¸°ìˆ ì„ ì¶”ìƒí™”í•´ì„œ ì œê³µí•œë‹¤.</p>
<p>ìŠ¤í”„ë§ ë˜í•œ ë§ì€ ë¶€ë¶„ì´ ì¶”ìƒí™” ë˜ì—ˆìœ¼ë©° ê°œë°œì ìŠ¤ìŠ¤ë¡œê°€ ì˜ë¬¸ì„ ê°–ì§€ ì•ŠëŠ”ë‹¤ë©´, ëª¨ë¥¸ì±„ ë„˜ì–´ê°ˆ ê¸°ìˆ ë“¤ì´ ì—¬ëŸ¿ ì¡´ì¬í•œë‹¤.</p>
<p>ì˜¤ëŠ˜ì€ ê·¸ëŸ¬í•œ ê¸°ìˆ ë“¤ ì¤‘, ê°œë°œìë“¤ì„ ëŒ€ì‹ í•´ì„œ ì‚¬ìš©ìì˜ ë‹¤ì¤‘ ìš”ì²­ì„ ì²˜ë¦¬í•´ì£¼ëŠ” WASì˜ <code node="[object Object]">ThreadPool</code>ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<h1>WASì˜ Thread ìƒì„± ê³¼ì •</h1>
<p>ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” 2.5.4 ë²„ì „ ì´í›„ë¡œ Tomcat (WAS)ì„ ë‚´ì¥í•˜ê³  ìˆë‹¤.</p>
<p>WASëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ë§ˆë‹¤ Threadë¥¼ í• ë‹¹í•´ ì£¼ëŠ”ë°, ì½”ë“œë¥¼ í†µí•´ WASì˜ Thread ìƒì„± ê³¼ì •ì„ ì‚´í´ë³´ë„ë¡ í•˜ì.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">import</span><span> java.net.ServerSocket;
</span><span></span><span style="color:#a626a4">import</span><span> java.net.Socket;
</span>
<span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">WebApplicationServer</span><span class="hljs-class"> </span><span>{
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> DEFAULT_PORT = </span><span style="color:#986801">8080</span><span>;
</span>
<span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">main</span><span class="hljs-function hljs-params">(String[] args)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> Exception </span><span>{
</span><span>        </span><span style="color:#a626a4">int</span><span> port = </span><span style="color:#986801">0</span><span>;
</span>
<span>        </span><span style="color:#a626a4">if</span><span> (args == </span><span style="color:#a626a4">null</span><span> || args.length == </span><span style="color:#986801">0</span><span>) {
</span>            port = DEFAULT_PORT;
<span>        } </span><span style="color:#a626a4">else</span><span> {
</span><span>            port = Integer.parseInt(args[</span><span style="color:#986801">0</span><span>]);
</span>        }
<!-- -->
<span>        </span><span style="color:#a0a1a7;font-style:italic">// ì„œë²„ì†Œì¼“ì„ ìƒì„±í•œë‹¤. ì›¹ ì„œë²„ëŠ” 8080 í¬íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.</span><span>
</span><span>        </span><span style="color:#a626a4">try</span><span> (ServerSocket listenSocket = </span><span style="color:#a626a4">new</span><span> ServerSocket(port)) {
</span>
<!-- -->            Socket connection;
<span>            </span><span style="color:#a626a4">while</span><span> ((connection = listenSocket.accept()) != </span><span style="color:#a626a4">null</span><span>) {
</span><span>                Thread thread = </span><span style="color:#a626a4">new</span><span> Thread(</span><span style="color:#a626a4">new</span><span> RequestHandler(connection));
</span>                thread.start();
<!-- -->            }
<!-- -->        }
<!-- -->    }
<!-- -->}</code></div></pre>
<p>ìœ„ ì½”ë“œëŠ” ë‹¤ìŒ ê³¼ì •ì„ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.</p>
<ul>
<li>ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•œë‹¤.</li>
<li><code node="[object Object]">try (ServerSocket listenSocket = new ServerSocket(port)) {</code>
<ul>
<li>8080 í¬íŠ¸ë¥¼ ë””í´íŠ¸ë¡œ ì‚¬ìš©í•˜ëŠ” <code node="[object Object]">ServerSocket</code> ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.</li>
<li><code node="[object Object]">ServerSocket</code> ê°ì²´ëŠ” ì£¼ì–´ì§„ í¬íŠ¸ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²­ì·¨í•œë‹¤.</li>
</ul>
</li>
<li><code node="[object Object]">while ((connection = listenSocket.accept()) != null) {</code>
<ul>
<li><code node="[object Object]">listenSocket.accept()</code>ëŠ” ì—°ê²° ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œê¹Œì§€ ë¸”ë¡œí‚¹ëœë‹¤.</li>
<li>ì—°ê²° ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ì—°ê²°ì„ ìˆ˜ë½í•˜ê³  <code node="[object Object]">Socket</code> ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.</li>
<li>ì—°ê²° ìš”ì²­ì´ ëŠê¸¸ë•Œ ê¹Œì§€ ë£¨í”„ë¥¼ ëŒë©° ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.</li>
</ul>
</li>
<li>í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ìš”ì²­(task)ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ì—¬ í• ë‹¹í•œë‹¤.</li>
<li>í• ë‹¹ëœ ìŠ¤ë ˆë“œê°€ <code node="[object Object]">RequestHandler</code> ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.<!-- -->
<ul>
<li><a href="https://kim-jong-hyun.tistory.com/101">thread.start()</a> ì— ì˜í•´ì„œ Threadê°€ taskë¥¼ ìˆ˜í–‰í•œë‹¤</li>
<li><code node="[object Object]">RequestHandler</code> ì— ì˜¤ë°”ë¼ì´ë“œëœ <code node="[object Object]">run()</code> ë©”ì„œë“œë¥¼ ìˆ˜í–‰í•œë‹¤.</li>
</ul>
</li>
</ul>
<p>í•˜ì§€ë§Œ ì´ì²˜ëŸ¼ ì‚¬ìš©ì ìš”ì²­ì´ ìˆì„ ë•Œ ë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©ì ìš”ì²­ì„ ì²˜ë¦¬í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.</p>
<ul>
<li>ëª¨ë“  ìš”ì²­ë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œ ìƒì„± ë¹„ìš© ë°œìƒ â†’ ì„±ëŠ¥ ì €í•˜.</li>
<li>ë™ì‹œ ì ‘ì†ìê°€ ë§ì•„ì§ˆ ê²½ìš°, Context Switching ë¹„ìš© ì¦ê°€, WASì˜ ë©”ëª¨ë¦¬ ìì›ì´ ë¶€ì¡±í•˜ì—¬ ì„œë²„ê°€ ë‹¤ìš´ë  ê°€ëŠ¥ì„±ì´ ì¡´ì¬.</li>
</ul>
<p>ì´ì²˜ëŸ¼ ì—¬ëŸ¬ ìœ ì €ì˜ ìš”ì²­ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ë™ì‹œ ì ‘ì†ìê°€ ë§ë”ë¼ë„ ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ì„œ WASëŠ” <strong>Thread Pool</strong>ì„ ì œê³µí•œë‹¤.</p>
<h1>Thread Pool ì´ë€?</h1>
<p><a href="https://www.baeldung.com/thread-pool-java-and-guava">Thread Pool</a>ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì— í•„ìš”í•œ <a href="https://en.wikipedia.org/wiki/Thread_(computing)">Thread</a>ë“¤ì„ ë¯¸ë¦¬ ìƒì„±í•œ ë‹¤ìŒ, Poolì— ìˆëŠ” Threadë¥¼ ëŒë ¤ê°€ë©° ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.
(Taskë¥¼ ì²˜ë¦¬í•œ ThreadëŠ” ë‹¤ì‹œ Thread Poolì— ë°˜ë‚©ë˜ì–´ ì¬ì‚¬ìš© ëœë‹¤.)</p>
<p>ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ëŠ” ë°©ì‹ê³¼ Threadê°€ taskë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì— ë”°ë¼ì„œ ì—¬ëŸ¬ Pool êµ¬í˜„ì²´ë“¤ì´ ì¡´ì¬í•œë‹¤.
ëŒ€í‘œì ì¸ Thread Poolì—ëŠ” <code node="[object Object]">newFixedThreadPool</code>ì´ ìˆë‹¤.</p>
<h2>Thread Poolì˜ Thread í• ë‹¹ ê³¼ì •</h2>
<p><img src="https://i.imgur.com/kZs00M1.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>Thread Poolì˜ Thread í• ë‹¹ ê³¼ì •ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<ul>
<li>ì„¤ì •ëœ <code node="[object Object]">core size</code> ë§Œí¼ Thread Poolì— Threadë¥¼ ìƒì„±í•œë‹¤.</li>
<li>ì‚¬ìš©ìë¡œ ë¶€í„° Task(ìš”ì²­)ê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ íì— Taskë¥¼ ì €ì¥í•œë‹¤.</li>
<li>Thread Poolì— idle ìƒíƒœì˜ Threadê°€ ìˆë‹¤ë©´ íì—ì„œ Taskë¥¼ êº¼ë‚´ í•´ë‹¹ Theadì— í• ë‹¹í•œë‹¤.<!-- -->
<ul>
<li>idle ìƒíƒœì˜ Threadê°€ Poolì— ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ TaskëŠ” íì— ëŒ€ê¸°í•œë‹¤.</li>
<li>â—ï¸ ëŒ€ê¸°ì¤‘ì¸ Taskë¡œ ì¸í•´ <strong>íê°€ ê½‰ ì°¨ë©´, Threadë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤</strong>. (ì„¤ì •ëœ <code node="[object Object]">Maximum Thread Size</code> ê¹Œì§€)</li>
<li>Maximum Thread Size ê¹Œì§€ Threadì˜ ìˆ˜ê°€ ë„ë‹¬í•˜ê³  íë„ ê½‰ ì°¨ê²Œ ë˜ë©´ ì¶”ê°€ Taskì— ëŒ€í•´ì„  <code node="[object Object]">Connection-refused</code> ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•œë‹¤.</li>
</ul>
</li>
<li>Taskë¥¼ ì²˜ë¦¬í•œ ThreadëŠ” ë‹¤ì‹œ idle ìƒíƒœë¡œ Thread Poolì— ë°˜ë‚©ëœë‹¤.<!-- -->
<ul>
<li>íê°€ ë¹„ì–´ìˆê³  <code node="[object Object]">core size</code> ì´ìƒì˜ Threadê°€ ìƒì„±ë˜ì–´ìˆë‹¤ë©´ <strong>Threadë¥¼ ì‚­ì œí•œë‹¤.</strong></li>
</ul>
</li>
</ul>
<h2>Thread Poolì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ì¤‘ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” WAS</h2>
<p>ì´ì œ ìë°”ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadPoolExecutor.html">ThreadPoolExecutor</a> ë¥¼ í™œìš©í•´ ì•„ë˜ì˜ ì„¤ì •ê°’ì„ ë°”íƒ•ìœ¼ë¡œí•˜ëŠ” Thread Pool ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë³´ì.</p>
<ul>
<li>ìµœëŒ€ Thread Poolì˜ í¬ê¸° = <code node="[object Object]">250</code> (Pool Size)</li>
<li>ëª¨ë“  Threadê°€ ì‚¬ìš©ì¤‘ì¸ (Busy) ìƒíƒœì´ë©´ <code node="[object Object]">100</code> ëª…ê¹Œì§€ ëŒ€ê¸° ìƒíƒœ ìœ ì§€ (Queue Size)</li>
</ul>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">import</span><span> java.net.ServerSocket;
</span><span></span><span style="color:#a626a4">import</span><span> java.net.Socket;
</span><span></span><span style="color:#a626a4">import</span><span> java.util.concurrent.LinkedBlockingQueue;
</span><span></span><span style="color:#a626a4">import</span><span> java.util.concurrent.ThreadPoolExecutor;
</span><span></span><span style="color:#a626a4">import</span><span> java.util.concurrent.TimeUnit;
</span>
<span></span><span style="color:#a626a4">import</span><span> org.slf4j.Logger;
</span><span></span><span style="color:#a626a4">import</span><span> org.slf4j.LoggerFactory;
</span>
<span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">WebApplicationServer</span><span class="hljs-class"> </span><span>{
</span>
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> Logger logger = LoggerFactory.getLogger(WebApplicationServer.class);
</span>
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> DEFAULT_PORT = </span><span style="color:#986801">8080</span><span>;
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> PORT_ARGS_INDEX = </span><span style="color:#986801">0</span><span>;
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> THREAD_POOL_SIZE_ARGS_INDEX = </span><span style="color:#986801">1</span><span>;
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> THREAD_QUEUE_SIZE_ARGS_INDEX = </span><span style="color:#986801">2</span><span>;
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> DEFAULT_THREAD_POOL_SIZE = </span><span style="color:#986801">250</span><span>;
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> DEFAULT_THREAD_QUEUE_SIZE = </span><span style="color:#986801">100</span><span>;
</span>
<span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">main</span><span class="hljs-function hljs-params">(String args[])</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> Exception </span><span>{
</span>
<span>        </span><span style="color:#a626a4">int</span><span> port = port(args);
</span>        ThreadPoolExecutor threadPoolExecutor = threadPoolExecutor(poolSize(args), queueSize(args));
<!-- -->
<span>        </span><span style="color:#a0a1a7;font-style:italic">// ì„œë²„ì†Œì¼“ì„ ìƒì„±í•œë‹¤. ì›¹ì„œë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 8080ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.</span><span>
</span><span>        </span><span style="color:#a626a4">try</span><span> (ServerSocket listenSocket = </span><span style="color:#a626a4">new</span><span> ServerSocket(port)) {
</span><span>            logger.info(</span><span style="color:#50a14f">&quot;Web Application Server started {} port.&quot;</span><span>, port);
</span>
<span>            </span><span style="color:#a0a1a7;font-style:italic">// í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤.</span><span>
</span>            Socket connection;
<span>            </span><span style="color:#a626a4">while</span><span> ((connection = listenSocket.accept()) != </span><span style="color:#a626a4">null</span><span>) {
</span><span>                threadPoolExecutor.execute(</span><span style="color:#a626a4">new</span><span> RequestHandler(connection));
</span>            }
<!-- -->        }
<!-- -->    }
<!-- -->    ...
<!-- -->
<span>    </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">port</span><span class="hljs-function hljs-params">(String[] args)</span><span class="hljs-function"> </span><span>{
</span><span>        </span><span style="color:#a626a4">return</span><span> extractValueByIndexOrDefault(args, PORT_ARGS_INDEX, DEFAULT_PORT);
</span>    }
<!-- -->
<span>    </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">extractValueByIndexOrDefault</span><span class="hljs-function hljs-params">(String[] args, </span><span class="hljs-function hljs-params" style="color:#a626a4">int</span><span class="hljs-function hljs-params"> index, </span><span class="hljs-function hljs-params" style="color:#a626a4">int</span><span class="hljs-function hljs-params"> defaultValue)</span><span class="hljs-function"> </span><span>{
</span><span>        </span><span style="color:#a626a4">if</span><span> (args == </span><span style="color:#a626a4">null</span><span> || args.length &lt; index + </span><span style="color:#986801">1</span><span>) {
</span><span>            </span><span style="color:#a626a4">return</span><span> defaultValue;
</span>        }
<span>        </span><span style="color:#a626a4">return</span><span> Integer.parseInt(args[index]);
</span>    }
<!-- -->}</code></div></pre>
<p>ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, Thread Pool ì ìš©ì˜ í•µì‹¬ ë¡œì§ì€ <code node="[object Object]">threadPoolExecutor</code> ë©”ì„œë“œì— ì¡´ì¬í•œë‹¤.</p>
<p><code node="[object Object]">threadPoolExecutor</code> ë©”ì„œë“œë¥¼ ì‚´í´ë³´ê¸°ì— ì•ì„œ, ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” ê°’ì„ êµ¬í•˜ëŠ” ë‘ê°œì˜ ë©”ì„œë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì.</p>
<p><code node="[object Object]">threadPoolExecutor</code> ë©”ì„œë“œëŠ” ë‘ê°œì˜ ì¸ìê°’ì„ ì „ë‹¬ë°›ëŠ”ë‹¤.</p>
<ul>
<li>Thread Poolì˜ <code node="[object Object]">core size</code></li>
<li>Taskë¥¼ ì €ì¥í•  <code node="[object Object]">queue size</code></li>
</ul>
<p>ì´ë“¤ì€ ê°ê° <code node="[object Object]">poolSize(args)</code>, <code node="[object Object]">queueSize(args)</code> ë©”ì„œë“œì— ì˜í•´ì„œ ê°’ì´ êµ¬í•´ì§„ë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">WebApplicationServer</span><span class="hljs-class"> </span><span>{
</span>    ...
<!-- -->    
<span>    </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">poolSize</span><span class="hljs-function hljs-params">(String[] args)</span><span class="hljs-function"> </span><span>{
</span><span>        </span><span style="color:#a626a4">return</span><span> extractValueByIndexOrDefault(args, THREAD_POOL_SIZE_ARGS_INDEX, DEFAULT_THREAD_POOL_SIZE);
</span>    }
<!-- -->
<span>    </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">queueSize</span><span class="hljs-function hljs-params">(String[] args)</span><span class="hljs-function"> </span><span>{
</span><span>        </span><span style="color:#a626a4">return</span><span> extractValueByIndexOrDefault(args, THREAD_QUEUE_SIZE_ARGS_INDEX, DEFAULT_THREAD_QUEUE_SIZE);
</span>    }</code></div></pre>
<p><code node="[object Object]">port(args)</code>, <code node="[object Object]">poolSize(args)</code> , <code node="[object Object]">queueSize(args)</code> ëª¨ë‘ <code node="[object Object]">extractValueByIndexOrDefault()</code> ë©”ì„œë“œì— ì˜í•´ì„œ ê°’ì´ íŒŒì‹±ëœë‹¤.</p>
<p><code node="[object Object]">extractValueByIndexOrDefault()</code> ë©”ì„œë“œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì‹œ ì „ë‹¬ë˜ëŠ” <code node="[object Object]">args[]</code> ì— í•„ìš”í•œ ì˜µì…˜ì˜ ê°’ì´ ì „ë‹¬ë˜ì§€ ì•Šì€ ê²½ìš°ì— ê¸°ë³¸ê°’ì„ ë°˜í™˜í•˜ê³  ì˜µì…˜ ê°’ì´ ì „ë‹¬ëœ ê²½ìš°ì—ëŠ” ì „ë‹¬ëœ ê°’ì„ ë°˜í™˜í•œë‹¤.</p>
<h3>ThreadPoolExecutor</h3>
<p><code node="[object Object]">poolSize</code> ì™€ <code node="[object Object]">queueSize</code> ë©”ì„œë“œë¡œ ë¶€í„°</p>
<p>ì „ë‹¬ë°›ì€ ë‘ ì¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ <code node="[object Object]">ThreadPoolExecutor</code> ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ Thread Poolì„ ì ìš©í•œë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">WebApplicationServer</span><span class="hljs-class"> </span><span>{
</span>    ...
<!-- -->    
<span>    </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> ThreadPoolExecutor </span><span class="hljs-function" style="color:#4078f2">threadPoolExecutor</span><span class="hljs-function hljs-params">(</span><span class="hljs-function hljs-params" style="color:#a626a4">int</span><span class="hljs-function hljs-params"> corePoolSize, </span><span class="hljs-function hljs-params" style="color:#a626a4">int</span><span class="hljs-function hljs-params"> queueSize)</span><span class="hljs-function"> </span><span>{
</span><span>        </span><span style="color:#a626a4">return</span><span> </span><span style="color:#a626a4">new</span><span> ThreadPoolExecutor(corePoolSize, corePoolSize, </span><span style="color:#986801">0L</span><span>, TimeUnit.MILLISECONDS,
</span><span>                </span><span style="color:#a626a4">new</span><span> LinkedBlockingQueue&lt;&gt;(queueSize));
</span>    }</code></div></pre>
<blockquote>
<p>ThreadPoolExecutor(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue)</p>
</blockquote>
<ul>
<li>
<p>corePoolSize</p>
<ul>
<li>ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ì‹œ Poolì— í• ë‹¹ë˜ëŠ” ì“°ë ˆë“œ ìˆ˜</li>
</ul>
</li>
<li>
<p>maximumPoolSize</p>
<ul>
<li>Poolì— ìœ ì§€ë  ìˆ˜ ìˆëŠ” <strong>ìµœëŒ€</strong> ì“°ë ˆë“œ ìˆ˜</li>
</ul>
</li>
<li>
<p>keepAliveTime</p>
<ul>
<li>corePoolSize ë³´ë‹¤ ì“°ë ˆë“œ ê°œìˆ˜ê°€ ë§ì•„ ì§„ ìƒíƒœì—ì„œ, ìƒˆë¡œìš´ í…ŒìŠ¤í¬ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„.</li>
<li>keepAliveTime ì´ìƒ ì‹œê°„ì´ ê²½ê³¼í•˜ë©´ ì“°ë ˆë“œë¥¼ ì—†ì• ì„œ corePoolSizeë§Œí¼ ì“°ë ˆë“œ ìˆ˜ë¥¼ ìœ ì§€í•œë‹¤.</li>
</ul>
</li>
<li>
<p>unit</p>
<ul>
<li>keepAliveTimeì˜ ì‹œê°„ ë‹¨ìœ„</li>
</ul>
</li>
<li>
<p>workQueue</p>
<ul>
<li>ì‹¤í–‰ ë˜ê¸°ì „ì— í™€ë“œì‹œì¼œ ë‘ëŠ” í…ŒìŠ¤í¬ë¥¼ ìœ ì§€í•˜ëŠ” í.</li>
<li>idle ìƒíƒœì˜ ì“°ë ˆë“œê°€ ì—†ëŠ” ê²½ìš°, í…ŒìŠ¤í¬ë¥¼ workQueueì— ì €ì¥í•œë‹¤.</li>
</ul>
</li>
<li>
<p>corePoolSize = 1, maximumPoolSize = 1 ì´ë©´ <code node="[object Object]">newSingleThreadExecutor</code> ê°€ ëœë‹¤.</p>
</li>
<li>
<p>corePoolSize = 0, maximumPoolSize = MAX_VALUE ì´ë©´ <code node="[object Object]">newCachedThreadPool</code></p>
</li>
</ul>
<p>í˜„ì¬ ìš°ë¦¬ëŠ” ìµœì†Œ, ìµœëŒ€ê°€ 250ì¸ ê³ ì •ëœ Thread Poolì„ ìƒì„±í•œ ê²ƒì´ë‹¤.</p>
<p><code node="[object Object]">threadPoolExecutor.execute(new RequestHandler(connection))</code></p>
<p>Thread Poolì„ ë§Œë“¤ê³  ë‚˜ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê¸°ê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ê°€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ëŠ” ìˆœê°„ Thread Poolì˜ idleí•œ Threadë¥¼ í•˜ë‚˜ í• ë‹¹í•˜ì—¬ ìš”ì²­ (Task)ë¥¼ ì²˜ë¦¬í•œë‹¤.</p>
<ul>
<li><code node="[object Object]">execute(í…ŒìŠ¤í¬)</code>
<ul>
<li>Thead Poolì—ì„œ í•˜ë‚˜ì˜ Threadë¥¼ í• ë‹¹.</li>
</ul>
</li>
</ul>
<h2>Thread Pool ìˆ˜ë³´ë‹¤ ë§ì€ ìš”ì²­ì„ ë™ì‹œì— ë³´ë‚´ë³´ê¸°</h2>
<p>ì•ì„œ ì ìš©í•œ Thread Poolê³¼ ë™ì¼í•œ <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html">newFixedThreadPool</a> ë¥¼ ì‚¬ìš©í•˜ì—¬ Thread Poolì´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ë³´ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì.</p>
<p>ë¨¼ì € Thread Poolì˜ ì´ ìŠ¤ë˜ë“œ ê°œìˆ˜ë³´ë‹¤ ì ì€ ë™ì‹œ ìš”ì²­ì„ ë³´ëƒˆì„ë•Œ WASê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤.</p>
<p><img src="https://i.imgur.com/06RShUw.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<ul>
<li>
<p><code node="[object Object]">executorService.execute()</code></p>
<p>Thread Poolì—ì„œ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ í• ë‹¹í•´ì„œ í…ŒìŠ¤í¬ë¥¼ ìˆ˜í–‰í•œë‹¤.</p>
</li>
<li>
<p><code node="[object Object]">restTemplate.getForEntity()</code></p>
<p>ë™ê¸°ë°©ì‹ìœ¼ë¡œ, ì¸ìë¡œ ì£¼ì–´ì§„ url ì£¼ì†Œì— HTTP GET ìš”ì²­ì„ ë³´ë‚´ê³  ê²°ê³¼ëŠ” ResponseEntityë¥¼ ë°›ëŠ”ë‹¤.</p>
</li>
</ul>
<p>Thread Poolì—ì„œ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì”© í• ë‹¹í•´ ì£¼ì–´ index.htmlì„ ë¶ˆëŸ¬ì˜¤ëŠ” get ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ì˜€ë‹¤.</p>
<p>ê·¸ë¦¬ê³  í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ì„ ë§ˆì¹˜ë©´ latchì˜ ìˆ«ìê°€ í•˜ë‚˜ì”© ê°ì†Œí•œë‹¤.</p>
<p>200ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” Thread Poolì´ 100ê°œì˜ ìš”ì²­ì„ ë‹¤ ì²˜ë¦¬í•˜ì˜€ë‹¤ë©´ latchì˜ ìˆ«ìëŠ” 0ì´ì–´ì•¼í•˜ë©° ì •ìƒì ìœ¼ë¡œ ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•˜ì˜€ê¸° ë•Œë¬¸ì— awaitì˜ ê°’ë„ true ì—¬ì•¼ë§Œ í•œë‹¤.</p>
<p>Thread Pool ë‚´ë¶€ì˜ ìŠ¤ë ˆë“œê°€ ìš”ì²­ í…ŒìŠ¤í¬ ë³´ë‹¤ ë§ê¸° ë•Œë¬¸ì— WASê°€ ì •ìƒ ë™ì‘í•  ê²ƒì´ë¼ê³  ìƒê°í•˜ì˜€ê³ </p>
<p>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê²°ê³¼, WASê°€ 3ì´ˆë§Œì— ìš”ì²­ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.</p>
<p><img src="https://i.imgur.com/XdtUK2j.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ì´ë²ˆì—ëŠ” Thread Poolì— 200ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì´ë³´ë‹¤ ë§ì€ 400ê°œì˜ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ì•˜ë‹¤.</p>
<p><img src="https://i.imgur.com/is78b8W.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>200ê°œì˜ ê³ ì •ëœ í¬ê¸°ì˜ ìŠ¤ë ˆë“œí’€ì„ ë§Œë“¤ê³  400ê°œì˜ í…ŒìŠ¤í¬ë¥¼ ë„£ì–´ì£¼ì—ˆê¸° ë•Œë¬¸ì— 200ê°œì˜ ì›Œì»¤(ìŠ¤ë ˆë“œ)ëŠ” 200ê°œì˜ í…ŒìŠ¤í¬ë¥¼ ë¨¼ì € ì²˜ë¦¬í•˜ê³ , ë‚˜ë¨¸ì§€ 200ê°œëŠ” Queueì—ì„œ í• ë‹¹ë˜ê¸°ë§Œì„ ê¸°ë‹¤ë¦¬ê³  ìˆì„ ê²ƒì´ë‹¤.</p>
<p>ì´í›„, ë¨¼ì € ëë‚œ ì›Œì»¤ê°€ ë‚˜ë¨¸ì§€ ìŠ¤ë ˆë“œë“¤ì„ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.</p>
<p>(ë” ìì„¸í•œ ê³¼ì •ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ë‹¤ìŒ <a href="https://hamait.tistory.com/937?category=79137">ë§í¬</a>ë¥¼ ì°¸ê³ í•˜ê¸°ë¥¼ ë°”ë€ë‹¤.)</p>
<p><img src="https://i.imgur.com/0PMF4bv.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ê·¸ë ‡ë‹¤ë©´ ë” ë§ì€ 700ê°œì˜ í…ŒìŠ¤í¬ë¥¼ 200ê°œì˜ ê³ ì • í¬ê¸° ìŠ¤ë ˆë“œí’€ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?</p>
<p>í˜„ì¬ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ìŠ¤ë ˆë“œ í’€ì€ ê³ ì • ìŠ¤ë ˆë“œ í’€ì´ê¸° ë•Œë¬¸ì— ì´ˆê¸° ìŠ¤ë ˆë“œ ê°œìˆ˜ì—ì„œ ìŠ¤ë ˆë“œê°€ ì¶”ê°€ë¡œ ìƒì„±ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.</p>
<p>ë•Œë¬¸ì— newFixedThreadPoolì˜ workQueue ì‚¬ì´ì¦ˆ ë§Œí¼ì˜ í…ŒìŠ¤í¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê²ƒì´ë‹¤.</p>
<p>java/util/concurrent/Executors.java íŒŒì¼ì˜ Executors í´ë˜ìŠ¤ëŠ” ì •ì  ë©”ì„œë“œë¡œ newFixedPoolì„ ì œê³µí•œë‹¤.</p>
<p><img src="https://i.imgur.com/WfjqPOD.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ê³ ì • ìŠ¤ë ˆë“œ í’€ì´ê¸° ë•Œë¬¸ì— corePoolSizeì™€ maximumPoolSizeì˜ ê°’ì´ ê°™ê³  corePoolSizeë³´ë‹¤ ìŠ¤ë ˆë“œ ê°œìˆ˜ê°€ ë§ì•„ì§ˆ ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— keepAliveTimeì€ 0ì´ë‹¤.</p>
<p>ëˆˆì—¬ê²¨ë´ì•¼í•  ë¶€ë¶„ì€ ë°”ë¡œ workQueueì¸ë°, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingQueue.html">LinkedBlockingQueue</a> ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<p>LinkedBlockingQueueëŠ” ìƒì„±ìì˜ ì¸ìë¡œ queueì˜ ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ ìµœëŒ€ í ì‚¬ì´ì¦ˆë¥¼ **Integer.MAX_VALUE (2*31 - 1)**ë¡œ ì„¤ì •í•˜ê³  ê°’ì´ ì‚½ì…ë  ë•Œ ë§ˆë‹¤ ë™ì ìœ¼ë¡œ nodeë¥¼ ìƒì„±í•˜ì—¬ ê°’ì„ ì €ì¥í•œë‹¤.</p>
<p>ë•ë¶„ì— ìš°ë¦¬ëŠ” Thread Poolì— ì¡´ì¬í•˜ëŠ” ìŠ¤ë ˆë“œì˜ ê°œìˆ˜ë³´ë‹¤ ë” ë§ì€ ë™ì‹œìš”ì²­ì´ ë“¤ì–´ì˜¤ë”ë¼ë„ ì •ìˆ˜í˜•ì˜ ìµœëŒ€ ê°’ ë§Œí¼ì˜ í…ŒìŠ¤í¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.</p>
<p>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼, 700ê°œì˜ í…ŒìŠ¤í¬ë¥¼ 200ê°œì˜ ìŠ¤ë ˆë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<p><img src="https://i.imgur.com/582ZHWQ.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>í•˜ì§€ë§Œ ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ Thread Poolì„ ì§ì ‘ ì ìš©í•œì ë„, ì‹ ê²½ì¨ë³¸ì ë„ ì—†ì—ˆì„ ìˆ˜ ìˆë‹¤.</p>
<p>ì‹¤ì œë¡œ ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” Thread Poolì„ ì§ì ‘ êµ¬í˜„í•  í•„ìš” ì—†ì´ ì„¤ì • íŒŒì¼ì„ í†µí•´ì„œ Thread Pool ê´€ë ¨ ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.</p>
<h2>ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ Embedded Tomcat</h2>
<p>ìŠ¤í”„ë§ê³¼ ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ì°¨ì´ì  ì¤‘ í•˜ë‚˜ëŠ” ë°”ë¡œ ë‚´ì¥ WAS (Tomcat)ì§€ì› ì—¬ë¶€ì´ë‹¤.</p>
<p>ì§€ê¸ˆê¹Œì§€ Thread Poolì„ ì ìš©í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì´ë¥¼ ì•Œì•„ë³´ì•˜ì§€ë§Œ, ê°ì‚¬í•˜ê²Œë„ ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” Tomcatì„ ë‚´ì¥í•˜ê³  ìˆë‹¤.</p>
<p>ë‚´ì¥ Tomcat ë•ë¶„ì— ìœ„ì™€ ê°™ì´ Thread Poolì„ êµ¬í˜„í•  í•„ìš” ì—†ì´ <code node="[object Object]">application.yml</code> í˜¹ì€ <a href="http://application.properties">application.properties</a> ì—ì„œ Tomcatì˜ Connectorì„¤ì •ì„ ë³€ê²½ í•  ìˆ˜ ìˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-yml" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic"># application.yml (ì ì–´ë†“ì€ ê°’ì€ default)</span><span>
</span><span></span><span style="color:#986801">server:</span><span>
</span><span>  </span><span style="color:#986801">tomcat:</span><span>
</span><span>    </span><span style="color:#986801">threads:</span><span>
</span><span>      </span><span style="color:#986801">max:</span><span> </span><span style="color:#986801">200</span><span> </span><span style="color:#a0a1a7;font-style:italic"># ìƒì„±í•  ìˆ˜ ìˆëŠ” threadì˜ ì´ ê°œìˆ˜</span><span>
</span><span>      </span><span style="color:#986801">min-spare:</span><span> </span><span style="color:#986801">10</span><span> </span><span style="color:#a0a1a7;font-style:italic"># í•­ìƒ í™œì„±í™” ë˜ì–´ìˆëŠ”(idle) threadì˜ ê°œìˆ˜</span><span>
</span><span>    </span><span style="color:#986801">max-connections:</span><span> </span><span style="color:#986801">8192</span><span> </span><span style="color:#a0a1a7;font-style:italic"># ìˆ˜ë¦½ê°€ëŠ¥í•œ connectionì˜ ì´ ê°œìˆ˜</span><span>
</span><span>    </span><span style="color:#986801">accept-count:</span><span> </span><span style="color:#986801">100</span><span> </span><span style="color:#a0a1a7;font-style:italic"># ì‘ì—…íì˜ ì‚¬ì´ì¦ˆ (ìš´ì˜ì²´ì œì—ì„œ ê´€ë¦¬)</span><span>
</span><span>    </span><span style="color:#986801">connection-timeout:</span><span> </span><span style="color:#986801">20000</span><span> </span><span style="color:#a0a1a7;font-style:italic"># timeout íŒë‹¨ ê¸°ì¤€ ì‹œê°„, 20ì´ˆ</span><span>
</span><span>  </span><span style="color:#986801">port:</span><span> </span><span style="color:#986801">8080</span><span> </span><span style="color:#a0a1a7;font-style:italic"># ì„œë²„ë¥¼ ë„ìš¸ í¬íŠ¸ë²ˆí˜¸</span></code></div></pre>
<h2>ë§ˆì¹˜ë©°</h2>
<p>ì§€ê¸ˆê¹Œì§€ Thead Poolì„ WASì— ì ìš©í•´ ë³´ë©´ì„œ WASê°€ ë‹¤ì¤‘ ìš”ì²­ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤.</p>
<p>ì‚¬ì‹¤ ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ì—ëŠ” Thread Pool ë¿ë§Œ ì•„ë‹ˆë¼ WASì˜ Connectorë„ ë°€ì ‘í•˜ê²Œ ì—°ê´€ë˜ì–´ ìˆë‹¤.</p>
<p>í˜„ì¬ êµ¬í˜„ëœ WASëŠ” Socket Connectionì„ ì²˜ë¦¬í•  ë•Œ ìë°”ì˜ ê¸°ë³¸ì ì¸ I/Oë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<p>Thead Poolì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ìŠ¤ë ˆë“œëŠ” ì†Œì¼“ ì—°ê²°ì„ ë°›ì•„ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìš”ì²­ì— ëŒ€í•´ ì‘ë‹µí•œ ë‹¤ìŒ, ì†Œì¼“ ì—°ê²°ì´ ì¢…ë£Œë˜ë©´ Thead Poolì— ë°˜ë‚©ëœë‹¤.</p>
<p>ì¦‰, connectionì´ ë‹«í ë•Œê¹Œì§€ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œëŠ” íŠ¹ì • connectionì— ê³„ì† í• ë‹¹ë˜ì–´ ìˆê²Œ ëœë‹¤.</p>
<p>ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ìŠ¤ë ˆë“œë¥¼ í• ë‹¹í•˜ì—¬ ì‚¬ìš©í•˜ë©´, ë™ì‹œì— ì‚¬ìš©ë˜ëŠ” ìŠ¤ë ˆë“œ ìˆ˜ê°€ ë™ì‹œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ìˆ˜ê°€ ë˜ì–´ ë²„ë¦¬ëŠ”ë° ìŠ¤ë ˆë“œë“¤ì´ ì¶©ë¶„íˆ ì‚¬ìš©ë˜ì§€ ì•Šê³  idle ìƒíƒœë¡œ ë‚­ë¹„ë˜ëŠ” ì‹œê°„ì´ ë§ì´ ë°œìƒí•˜ê²Œ ëœë‹¤.</p>
<p>ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ <code node="[object Object]">NIO Connector</code> ê°€ ë“±ì¥í•˜ì˜€ëŠ”ë° ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ BIO ë°©ì‹ê³¼ NIO ë°©ì‹ì˜ ì°¨ì´ì ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<hr/>
<h3>ì°¸ê³ ìë£Œ ğŸ“š</h3>
<ul>
<li><a href="https://medium.com/@amardeepbhowmick92/task-queuing-in-executors-newfixedthreadpool-31bc8c24b4d2">Task queuing in Executors.newFixedThreadPool()</a></li>
<li><a href="https://www.baeldung.com/thread-pool-java-and-guava">Introduction to Thread Pools in Java</a></li>
<li><a href="https://hamait.tistory.com/937">JAVA ì“°ë ˆë“œí’€ ë¶„ì„ - newFixedThreadPool ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ê°€?</a></li>
<li><a href="https://velog.io/@sihyung92/how-does-springboot-handle-multiple-requests">ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ì–´ë–»ê²Œ ë‹¤ì¤‘ ìœ ì € ìš”ì²­ì„ ì²˜ë¦¬í• ê¹Œ? (Tomcat9.0 Thread Pool)</a></li>
<li><a href="https://imasoftwareengineer.tistory.com/100">ë³‘í–‰ì„±(Concurrency)ì„ ìœ„í•œ CountDownLatch</a></li>
</ul></div><section></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"post9","lang":"ko","title":"ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ ThreadPool ì ìš©í•˜ê¸°","thumbnail":"https://i.imgur.com/mHibXLP.jpg","section":"tech","tags":"Spring, ThreadPool","date":"2022-09-20 10:00","preview":"\ní”„ë ˆì„ì›Œí¬ëŠ” ê°œë°œìê°€ ì‰½ê³  í¸í•˜ê²Œ ê°œë°œì„ í•  ìˆ˜ ìˆë„ë¡ ë§ì€ ê¸°ìˆ ì„ ì¶”ìƒí™”í•´ì„œ ì œê³µí•œë‹¤.\n\nìŠ¤í”„ë§ ë˜í•œ ë§ì€ ë¶€ë¶„ì´ ì¶”ìƒí™” ë˜ì—ˆìœ¼ë©° ê°œë°œì ìŠ¤ìŠ¤ë¡œê°€ ì˜ë¬¸ì„ ê°–ì§€ ì•ŠëŠ”ë‹¤ë©´, ëª¨ë¥¸ì±„ ë„˜ì–´ê°ˆ ê¸°ìˆ ë“¤ì´ ì—¬ëŸ¿ ì¡´ì¬í•œë‹¤.\n\nì˜¤ëŠ˜ì€ ê·¸ëŸ¬í•œ ê¸°ìˆ ë“¤ ì¤‘, ê°œë°œìë“¤ì„"},"detail":"\ní”„ë ˆì„ì›Œí¬ëŠ” ê°œë°œìê°€ ì‰½ê³  í¸í•˜ê²Œ ê°œë°œì„ í•  ìˆ˜ ìˆë„ë¡ ë§ì€ ê¸°ìˆ ì„ ì¶”ìƒí™”í•´ì„œ ì œê³µí•œë‹¤.\n\nìŠ¤í”„ë§ ë˜í•œ ë§ì€ ë¶€ë¶„ì´ ì¶”ìƒí™” ë˜ì—ˆìœ¼ë©° ê°œë°œì ìŠ¤ìŠ¤ë¡œê°€ ì˜ë¬¸ì„ ê°–ì§€ ì•ŠëŠ”ë‹¤ë©´, ëª¨ë¥¸ì±„ ë„˜ì–´ê°ˆ ê¸°ìˆ ë“¤ì´ ì—¬ëŸ¿ ì¡´ì¬í•œë‹¤.\n\nì˜¤ëŠ˜ì€ ê·¸ëŸ¬í•œ ê¸°ìˆ ë“¤ ì¤‘, ê°œë°œìë“¤ì„ ëŒ€ì‹ í•´ì„œ ì‚¬ìš©ìì˜ ë‹¤ì¤‘ ìš”ì²­ì„ ì²˜ë¦¬í•´ì£¼ëŠ” WASì˜ `ThreadPool`ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.\n\n# WASì˜ Thread ìƒì„± ê³¼ì •\n\nìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” 2.5.4 ë²„ì „ ì´í›„ë¡œ Tomcat (WAS)ì„ ë‚´ì¥í•˜ê³  ìˆë‹¤.\n\nWASëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ë§ˆë‹¤ Threadë¥¼ í• ë‹¹í•´ ì£¼ëŠ”ë°, ì½”ë“œë¥¼ í†µí•´ WASì˜ Thread ìƒì„± ê³¼ì •ì„ ì‚´í´ë³´ë„ë¡ í•˜ì.\n\n```java\nimport java.net.ServerSocket;\nimport java.net.Socket;\n\npublic class WebApplicationServer {\n    private static final int DEFAULT_PORT = 8080;\n\n    public static void main(String[] args) throws Exception {\n        int port = 0;\n\n        if (args == null || args.length == 0) {\n            port = DEFAULT_PORT;\n        } else {\n            port = Integer.parseInt(args[0]);\n        }\n\n        // ì„œë²„ì†Œì¼“ì„ ìƒì„±í•œë‹¤. ì›¹ ì„œë²„ëŠ” 8080 í¬íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.\n        try (ServerSocket listenSocket = new ServerSocket(port)) {\n\n            Socket connection;\n            while ((connection = listenSocket.accept()) != null) {\n                Thread thread = new Thread(new RequestHandler(connection));\n                thread.start();\n            }\n        }\n    }\n}\n```\nìœ„ ì½”ë“œëŠ” ë‹¤ìŒ ê³¼ì •ì„ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.\n\n- ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•œë‹¤. \n- `try (ServerSocket listenSocket = new ServerSocket(port)) {`\n   - 8080 í¬íŠ¸ë¥¼ ë””í´íŠ¸ë¡œ ì‚¬ìš©í•˜ëŠ” `ServerSocket` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. \n   - `ServerSocket` ê°ì²´ëŠ” ì£¼ì–´ì§„ í¬íŠ¸ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²­ì·¨í•œë‹¤.\n- `while ((connection = listenSocket.accept()) != null) {`\n   - `listenSocket.accept()`ëŠ” ì—°ê²° ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œê¹Œì§€ ë¸”ë¡œí‚¹ëœë‹¤.\n   - ì—°ê²° ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ì—°ê²°ì„ ìˆ˜ë½í•˜ê³  `Socket` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.\n   - ì—°ê²° ìš”ì²­ì´ ëŠê¸¸ë•Œ ê¹Œì§€ ë£¨í”„ë¥¼ ëŒë©° ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.\n- í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ìš”ì²­(task)ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ì—¬ í• ë‹¹í•œë‹¤.\n- í• ë‹¹ëœ ìŠ¤ë ˆë“œê°€ `RequestHandler` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.\n   - [thread.start()](https://kim-jong-hyun.tistory.com/101) ì— ì˜í•´ì„œ Threadê°€ taskë¥¼ ìˆ˜í–‰í•œë‹¤\n   - `RequestHandler` ì— ì˜¤ë°”ë¼ì´ë“œëœ `run()` ë©”ì„œë“œë¥¼ ìˆ˜í–‰í•œë‹¤.\n    \n\ní•˜ì§€ë§Œ ì´ì²˜ëŸ¼ ì‚¬ìš©ì ìš”ì²­ì´ ìˆì„ ë•Œ ë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©ì ìš”ì²­ì„ ì²˜ë¦¬í•˜ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.\n\n- ëª¨ë“  ìš”ì²­ë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œ ìƒì„± ë¹„ìš© ë°œìƒ â†’ ì„±ëŠ¥ ì €í•˜.\n- ë™ì‹œ ì ‘ì†ìê°€ ë§ì•„ì§ˆ ê²½ìš°, Context Switching ë¹„ìš© ì¦ê°€, WASì˜ ë©”ëª¨ë¦¬ ìì›ì´ ë¶€ì¡±í•˜ì—¬ ì„œë²„ê°€ ë‹¤ìš´ë  ê°€ëŠ¥ì„±ì´ ì¡´ì¬.\n\nì´ì²˜ëŸ¼ ì—¬ëŸ¬ ìœ ì €ì˜ ìš”ì²­ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ë™ì‹œ ì ‘ì†ìê°€ ë§ë”ë¼ë„ ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ì„œ WASëŠ” **Thread Pool**ì„ ì œê³µí•œë‹¤.\n\n# Thread Pool ì´ë€?\n\n[Thread Pool](https://www.baeldung.com/thread-pool-java-and-guava)ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì— í•„ìš”í•œ [Thread](https://en.wikipedia.org/wiki/Thread_(computing))ë“¤ì„ ë¯¸ë¦¬ ìƒì„±í•œ ë‹¤ìŒ, Poolì— ìˆëŠ” Threadë¥¼ ëŒë ¤ê°€ë©° ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.\n(Taskë¥¼ ì²˜ë¦¬í•œ ThreadëŠ” ë‹¤ì‹œ Thread Poolì— ë°˜ë‚©ë˜ì–´ ì¬ì‚¬ìš© ëœë‹¤.)\n\në¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ëŠ” ë°©ì‹ê³¼ Threadê°€ taskë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì— ë”°ë¼ì„œ ì—¬ëŸ¬ Pool êµ¬í˜„ì²´ë“¤ì´ ì¡´ì¬í•œë‹¤.\nëŒ€í‘œì ì¸ Thread Poolì—ëŠ” `newFixedThreadPool`ì´ ìˆë‹¤.\n\n## Thread Poolì˜ Thread í• ë‹¹ ê³¼ì •\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-08 á„‹á…©á„’á…® 3.21.21.png](https://i.imgur.com/kZs00M1.png)\n\nThread Poolì˜ Thread í• ë‹¹ ê³¼ì •ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.\n\n- ì„¤ì •ëœ `core size` ë§Œí¼ Thread Poolì— Threadë¥¼ ìƒì„±í•œë‹¤.\n- ì‚¬ìš©ìë¡œ ë¶€í„° Task(ìš”ì²­)ê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ íì— Taskë¥¼ ì €ì¥í•œë‹¤.\n- Thread Poolì— idle ìƒíƒœì˜ Threadê°€ ìˆë‹¤ë©´ íì—ì„œ Taskë¥¼ êº¼ë‚´ í•´ë‹¹ Theadì— í• ë‹¹í•œë‹¤.\n    - idle ìƒíƒœì˜ Threadê°€ Poolì— ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ TaskëŠ” íì— ëŒ€ê¸°í•œë‹¤.\n    - â—ï¸ ëŒ€ê¸°ì¤‘ì¸ Taskë¡œ ì¸í•´ **íê°€ ê½‰ ì°¨ë©´, Threadë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤**. (ì„¤ì •ëœ `Maximum Thread Size` ê¹Œì§€)\n    - Maximum Thread Size ê¹Œì§€ Threadì˜ ìˆ˜ê°€ ë„ë‹¬í•˜ê³  íë„ ê½‰ ì°¨ê²Œ ë˜ë©´ ì¶”ê°€ Taskì— ëŒ€í•´ì„  `Connection-refused` ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•œë‹¤.\n- Taskë¥¼ ì²˜ë¦¬í•œ ThreadëŠ” ë‹¤ì‹œ idle ìƒíƒœë¡œ Thread Poolì— ë°˜ë‚©ëœë‹¤.\n    - íê°€ ë¹„ì–´ìˆê³  `core size` ì´ìƒì˜ Threadê°€ ìƒì„±ë˜ì–´ìˆë‹¤ë©´ **Threadë¥¼ ì‚­ì œí•œë‹¤.**\n\n## Thread Poolì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ì¤‘ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” WAS\n\nì´ì œ ìë°”ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” [ThreadPoolExecutor](https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadPoolExecutor.html) ë¥¼ í™œìš©í•´ ì•„ë˜ì˜ ì„¤ì •ê°’ì„ ë°”íƒ•ìœ¼ë¡œí•˜ëŠ” Thread Pool ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë³´ì.\n\n- ìµœëŒ€ Thread Poolì˜ í¬ê¸° = `250` (Pool Size)\n- ëª¨ë“  Threadê°€ ì‚¬ìš©ì¤‘ì¸ (Busy) ìƒíƒœì´ë©´ `100` ëª…ê¹Œì§€ ëŒ€ê¸° ìƒíƒœ ìœ ì§€ (Queue Size)\n\n```java\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.concurrent.ThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class WebApplicationServer {\n\n    private static final Logger logger = LoggerFactory.getLogger(WebApplicationServer.class);\n\n    private static final int DEFAULT_PORT = 8080;\n    private static final int PORT_ARGS_INDEX = 0;\n    private static final int THREAD_POOL_SIZE_ARGS_INDEX = 1;\n    private static final int THREAD_QUEUE_SIZE_ARGS_INDEX = 2;\n    private static final int DEFAULT_THREAD_POOL_SIZE = 250;\n    private static final int DEFAULT_THREAD_QUEUE_SIZE = 100;\n\n    public static void main(String args[]) throws Exception {\n\n        int port = port(args);\n        ThreadPoolExecutor threadPoolExecutor = threadPoolExecutor(poolSize(args), queueSize(args));\n\n        // ì„œë²„ì†Œì¼“ì„ ìƒì„±í•œë‹¤. ì›¹ì„œë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 8080ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.\n        try (ServerSocket listenSocket = new ServerSocket(port)) {\n            logger.info(\"Web Application Server started {} port.\", port);\n\n            // í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤.\n            Socket connection;\n            while ((connection = listenSocket.accept()) != null) {\n                threadPoolExecutor.execute(new RequestHandler(connection));\n            }\n        }\n    }\n    ...\n\n    private static int port(String[] args) {\n        return extractValueByIndexOrDefault(args, PORT_ARGS_INDEX, DEFAULT_PORT);\n    }\n\n    private static int extractValueByIndexOrDefault(String[] args, int index, int defaultValue) {\n        if (args == null || args.length \u003c index + 1) {\n            return defaultValue;\n        }\n        return Integer.parseInt(args[index]);\n    }\n}\n```\n\nì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, Thread Pool ì ìš©ì˜ í•µì‹¬ ë¡œì§ì€ `threadPoolExecutor` ë©”ì„œë“œì— ì¡´ì¬í•œë‹¤.\n\n`threadPoolExecutor` ë©”ì„œë“œë¥¼ ì‚´í´ë³´ê¸°ì— ì•ì„œ, ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” ê°’ì„ êµ¬í•˜ëŠ” ë‘ê°œì˜ ë©”ì„œë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì.\n\n`threadPoolExecutor` ë©”ì„œë“œëŠ” ë‘ê°œì˜ ì¸ìê°’ì„ ì „ë‹¬ë°›ëŠ”ë‹¤.\n\n- Thread Poolì˜ `core size`\n- Taskë¥¼ ì €ì¥í•  `queue size`\n\nì´ë“¤ì€ ê°ê° `poolSize(args)`, `queueSize(args)` ë©”ì„œë“œì— ì˜í•´ì„œ ê°’ì´ êµ¬í•´ì§„ë‹¤.\n\n```java\npublic class WebApplicationServer {\n    ...\n    \n    private static int poolSize(String[] args) {\n        return extractValueByIndexOrDefault(args, THREAD_POOL_SIZE_ARGS_INDEX, DEFAULT_THREAD_POOL_SIZE);\n    }\n\n    private static int queueSize(String[] args) {\n        return extractValueByIndexOrDefault(args, THREAD_QUEUE_SIZE_ARGS_INDEX, DEFAULT_THREAD_QUEUE_SIZE);\n    }\n```\n\n`port(args)`, `poolSize(args)` , `queueSize(args)` ëª¨ë‘ `extractValueByIndexOrDefault()` ë©”ì„œë“œì— ì˜í•´ì„œ ê°’ì´ íŒŒì‹±ëœë‹¤.\n\n`extractValueByIndexOrDefault()` ë©”ì„œë“œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì‹œ ì „ë‹¬ë˜ëŠ” `args[]` ì— í•„ìš”í•œ ì˜µì…˜ì˜ ê°’ì´ ì „ë‹¬ë˜ì§€ ì•Šì€ ê²½ìš°ì— ê¸°ë³¸ê°’ì„ ë°˜í™˜í•˜ê³  ì˜µì…˜ ê°’ì´ ì „ë‹¬ëœ ê²½ìš°ì—ëŠ” ì „ë‹¬ëœ ê°’ì„ ë°˜í™˜í•œë‹¤.\n\n### ThreadPoolExecutor\n\n`poolSize` ì™€ `queueSize` ë©”ì„œë“œë¡œ ë¶€í„°\n\nì „ë‹¬ë°›ì€ ë‘ ì¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ `ThreadPoolExecutor` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ Thread Poolì„ ì ìš©í•œë‹¤.\n\n```java\npublic class WebApplicationServer {\n    ...\n    \n    private static ThreadPoolExecutor threadPoolExecutor(int corePoolSize, int queueSize) {\n        return new ThreadPoolExecutor(corePoolSize, corePoolSize, 0L, TimeUnit.MILLISECONDS,\n                new LinkedBlockingQueue\u003c\u003e(queueSize));\n    }\n```\n\n\u003e ThreadPoolExecutor(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue)\n\n- corePoolSize\n    - ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ì‹œ Poolì— í• ë‹¹ë˜ëŠ” ì“°ë ˆë“œ ìˆ˜\n- maximumPoolSize\n    - Poolì— ìœ ì§€ë  ìˆ˜ ìˆëŠ” **ìµœëŒ€** ì“°ë ˆë“œ ìˆ˜\n- keepAliveTime\n    - corePoolSize ë³´ë‹¤ ì“°ë ˆë“œ ê°œìˆ˜ê°€ ë§ì•„ ì§„ ìƒíƒœì—ì„œ, ìƒˆë¡œìš´ í…ŒìŠ¤í¬ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„.\n    - keepAliveTime ì´ìƒ ì‹œê°„ì´ ê²½ê³¼í•˜ë©´ ì“°ë ˆë“œë¥¼ ì—†ì• ì„œ corePoolSizeë§Œí¼ ì“°ë ˆë“œ ìˆ˜ë¥¼ ìœ ì§€í•œë‹¤.\n- unit\n    - keepAliveTimeì˜ ì‹œê°„ ë‹¨ìœ„\n- workQueue\n    - ì‹¤í–‰ ë˜ê¸°ì „ì— í™€ë“œì‹œì¼œ ë‘ëŠ” í…ŒìŠ¤í¬ë¥¼ ìœ ì§€í•˜ëŠ” í.\n    - idle ìƒíƒœì˜ ì“°ë ˆë“œê°€ ì—†ëŠ” ê²½ìš°, í…ŒìŠ¤í¬ë¥¼ workQueueì— ì €ì¥í•œë‹¤.\n\n- corePoolSize = 1, maximumPoolSize = 1 ì´ë©´ `newSingleThreadExecutor` ê°€ ëœë‹¤.\n- corePoolSize = 0, maximumPoolSize = MAX_VALUE ì´ë©´ `newCachedThreadPool`\n\ní˜„ì¬ ìš°ë¦¬ëŠ” ìµœì†Œ, ìµœëŒ€ê°€ 250ì¸ ê³ ì •ëœ Thread Poolì„ ìƒì„±í•œ ê²ƒì´ë‹¤.\n\n`threadPoolExecutor.execute(new RequestHandler(connection))`\n\nThread Poolì„ ë§Œë“¤ê³  ë‚˜ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê¸°ê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ê°€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ëŠ” ìˆœê°„ Thread Poolì˜ idleí•œ Threadë¥¼ í•˜ë‚˜ í• ë‹¹í•˜ì—¬ ìš”ì²­ (Task)ë¥¼ ì²˜ë¦¬í•œë‹¤.\n\n- `execute(í…ŒìŠ¤í¬)`\n    - Thead Poolì—ì„œ í•˜ë‚˜ì˜ Threadë¥¼ í• ë‹¹.\n\n## Thread Pool ìˆ˜ë³´ë‹¤ ë§ì€ ìš”ì²­ì„ ë™ì‹œì— ë³´ë‚´ë³´ê¸°\n\nì•ì„œ ì ìš©í•œ Thread Poolê³¼ ë™ì¼í•œ [newFixedThreadPool](https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html) ë¥¼ ì‚¬ìš©í•˜ì—¬ Thread Poolì´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ë³´ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì.\n\në¨¼ì € Thread Poolì˜ ì´ ìŠ¤ë˜ë“œ ê°œìˆ˜ë³´ë‹¤ ì ì€ ë™ì‹œ ìš”ì²­ì„ ë³´ëƒˆì„ë•Œ WASê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 6.24.57.png](https://i.imgur.com/06RShUw.png)\n\n- `executorService.execute()`\n    \n    Thread Poolì—ì„œ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ í• ë‹¹í•´ì„œ í…ŒìŠ¤í¬ë¥¼ ìˆ˜í–‰í•œë‹¤.\n    \n- `restTemplate.getForEntity()`\n    \n    ë™ê¸°ë°©ì‹ìœ¼ë¡œ, ì¸ìë¡œ ì£¼ì–´ì§„ url ì£¼ì†Œì— HTTP GET ìš”ì²­ì„ ë³´ë‚´ê³  ê²°ê³¼ëŠ” ResponseEntityë¥¼ ë°›ëŠ”ë‹¤.\n    \n\nThread Poolì—ì„œ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì”© í• ë‹¹í•´ ì£¼ì–´ index.htmlì„ ë¶ˆëŸ¬ì˜¤ëŠ” get ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ì˜€ë‹¤.\n\nê·¸ë¦¬ê³  í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ì„ ë§ˆì¹˜ë©´ latchì˜ ìˆ«ìê°€ í•˜ë‚˜ì”© ê°ì†Œí•œë‹¤.\n\n200ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” Thread Poolì´ 100ê°œì˜ ìš”ì²­ì„ ë‹¤ ì²˜ë¦¬í•˜ì˜€ë‹¤ë©´ latchì˜ ìˆ«ìëŠ” 0ì´ì–´ì•¼í•˜ë©° ì •ìƒì ìœ¼ë¡œ ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•˜ì˜€ê¸° ë•Œë¬¸ì— awaitì˜ ê°’ë„ true ì—¬ì•¼ë§Œ í•œë‹¤.\n\nThread Pool ë‚´ë¶€ì˜ ìŠ¤ë ˆë“œê°€ ìš”ì²­ í…ŒìŠ¤í¬ ë³´ë‹¤ ë§ê¸° ë•Œë¬¸ì— WASê°€ ì •ìƒ ë™ì‘í•  ê²ƒì´ë¼ê³  ìƒê°í•˜ì˜€ê³ \n\ní…ŒìŠ¤íŠ¸ ì‹¤í–‰ê²°ê³¼, WASê°€ 3ì´ˆë§Œì— ìš”ì²­ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 6.23.28.png](https://i.imgur.com/XdtUK2j.png)\n\nì´ë²ˆì—ëŠ” Thread Poolì— 200ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì´ë³´ë‹¤ ë§ì€ 400ê°œì˜ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ì•˜ë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 7.35.43.png](https://i.imgur.com/is78b8W.png)\n\n200ê°œì˜ ê³ ì •ëœ í¬ê¸°ì˜ ìŠ¤ë ˆë“œí’€ì„ ë§Œë“¤ê³  400ê°œì˜ í…ŒìŠ¤í¬ë¥¼ ë„£ì–´ì£¼ì—ˆê¸° ë•Œë¬¸ì— 200ê°œì˜ ì›Œì»¤(ìŠ¤ë ˆë“œ)ëŠ” 200ê°œì˜ í…ŒìŠ¤í¬ë¥¼ ë¨¼ì € ì²˜ë¦¬í•˜ê³ , ë‚˜ë¨¸ì§€ 200ê°œëŠ” Queueì—ì„œ í• ë‹¹ë˜ê¸°ë§Œì„ ê¸°ë‹¤ë¦¬ê³  ìˆì„ ê²ƒì´ë‹¤.\n\nì´í›„, ë¨¼ì € ëë‚œ ì›Œì»¤ê°€ ë‚˜ë¨¸ì§€ ìŠ¤ë ˆë“œë“¤ì„ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.\n\n(ë” ìì„¸í•œ ê³¼ì •ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ë‹¤ìŒ [ë§í¬](https://hamait.tistory.com/937?category=79137)ë¥¼ ì°¸ê³ í•˜ê¸°ë¥¼ ë°”ë€ë‹¤.)\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 7.35.24.png](https://i.imgur.com/0PMF4bv.png)\n\nê·¸ë ‡ë‹¤ë©´ ë” ë§ì€ 700ê°œì˜ í…ŒìŠ¤í¬ë¥¼ 200ê°œì˜ ê³ ì • í¬ê¸° ìŠ¤ë ˆë“œí’€ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?\n\ní˜„ì¬ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ìŠ¤ë ˆë“œ í’€ì€ ê³ ì • ìŠ¤ë ˆë“œ í’€ì´ê¸° ë•Œë¬¸ì— ì´ˆê¸° ìŠ¤ë ˆë“œ ê°œìˆ˜ì—ì„œ ìŠ¤ë ˆë“œê°€ ì¶”ê°€ë¡œ ìƒì„±ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. \n\në•Œë¬¸ì— newFixedThreadPoolì˜ workQueue ì‚¬ì´ì¦ˆ ë§Œí¼ì˜ í…ŒìŠ¤í¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê²ƒì´ë‹¤.\n\njava/util/concurrent/Executors.java íŒŒì¼ì˜ Executors í´ë˜ìŠ¤ëŠ” ì •ì  ë©”ì„œë“œë¡œ newFixedPoolì„ ì œê³µí•œë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 8.14.32.png](https://i.imgur.com/WfjqPOD.png)\n\nê³ ì • ìŠ¤ë ˆë“œ í’€ì´ê¸° ë•Œë¬¸ì— corePoolSizeì™€ maximumPoolSizeì˜ ê°’ì´ ê°™ê³  corePoolSizeë³´ë‹¤ ìŠ¤ë ˆë“œ ê°œìˆ˜ê°€ ë§ì•„ì§ˆ ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— keepAliveTimeì€ 0ì´ë‹¤.\n\nëˆˆì—¬ê²¨ë´ì•¼í•  ë¶€ë¶„ì€ ë°”ë¡œ workQueueì¸ë°, [LinkedBlockingQueue](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/LinkedBlockingQueue.html) ë¥¼ ì‚¬ìš©í•œë‹¤.\n\nLinkedBlockingQueueëŠ” ìƒì„±ìì˜ ì¸ìë¡œ queueì˜ ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ ìµœëŒ€ í ì‚¬ì´ì¦ˆë¥¼ **Integer.MAX_VALUE (2*31 - 1)**ë¡œ ì„¤ì •í•˜ê³  ê°’ì´ ì‚½ì…ë  ë•Œ ë§ˆë‹¤ ë™ì ìœ¼ë¡œ nodeë¥¼ ìƒì„±í•˜ì—¬ ê°’ì„ ì €ì¥í•œë‹¤.\n\në•ë¶„ì— ìš°ë¦¬ëŠ” Thread Poolì— ì¡´ì¬í•˜ëŠ” ìŠ¤ë ˆë“œì˜ ê°œìˆ˜ë³´ë‹¤ ë” ë§ì€ ë™ì‹œìš”ì²­ì´ ë“¤ì–´ì˜¤ë”ë¼ë„ ì •ìˆ˜í˜•ì˜ ìµœëŒ€ ê°’ ë§Œí¼ì˜ í…ŒìŠ¤í¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.\n\ní…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼, 700ê°œì˜ í…ŒìŠ¤í¬ë¥¼ 200ê°œì˜ ìŠ¤ë ˆë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n\n![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-23 á„‹á…©á„’á…® 7.34.31.png](https://i.imgur.com/582ZHWQ.png)\n\ní•˜ì§€ë§Œ ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ Thread Poolì„ ì§ì ‘ ì ìš©í•œì ë„, ì‹ ê²½ì¨ë³¸ì ë„ ì—†ì—ˆì„ ìˆ˜ ìˆë‹¤.\n\nì‹¤ì œë¡œ ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” Thread Poolì„ ì§ì ‘ êµ¬í˜„í•  í•„ìš” ì—†ì´ ì„¤ì • íŒŒì¼ì„ í†µí•´ì„œ Thread Pool ê´€ë ¨ ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.\n\n## ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ Embedded Tomcat\n\nìŠ¤í”„ë§ê³¼ ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ì°¨ì´ì  ì¤‘ í•˜ë‚˜ëŠ” ë°”ë¡œ ë‚´ì¥ WAS (Tomcat)ì§€ì› ì—¬ë¶€ì´ë‹¤.\n\nì§€ê¸ˆê¹Œì§€ Thread Poolì„ ì ìš©í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì´ë¥¼ ì•Œì•„ë³´ì•˜ì§€ë§Œ, ê°ì‚¬í•˜ê²Œë„ ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” Tomcatì„ ë‚´ì¥í•˜ê³  ìˆë‹¤.\n\n ë‚´ì¥ Tomcat ë•ë¶„ì— ìœ„ì™€ ê°™ì´ Thread Poolì„ êµ¬í˜„í•  í•„ìš” ì—†ì´ `application.yml` í˜¹ì€ [application.properties](http://application.properties) ì—ì„œ Tomcatì˜ Connectorì„¤ì •ì„ ë³€ê²½ í•  ìˆ˜ ìˆë‹¤.\n\n```yml\n# application.yml (ì ì–´ë†“ì€ ê°’ì€ default)\nserver:\n  tomcat:\n    threads:\n      max: 200 # ìƒì„±í•  ìˆ˜ ìˆëŠ” threadì˜ ì´ ê°œìˆ˜\n      min-spare: 10 # í•­ìƒ í™œì„±í™” ë˜ì–´ìˆëŠ”(idle) threadì˜ ê°œìˆ˜\n    max-connections: 8192 # ìˆ˜ë¦½ê°€ëŠ¥í•œ connectionì˜ ì´ ê°œìˆ˜\n    accept-count: 100 # ì‘ì—…íì˜ ì‚¬ì´ì¦ˆ (ìš´ì˜ì²´ì œì—ì„œ ê´€ë¦¬)\n    connection-timeout: 20000 # timeout íŒë‹¨ ê¸°ì¤€ ì‹œê°„, 20ì´ˆ\n  port: 8080 # ì„œë²„ë¥¼ ë„ìš¸ í¬íŠ¸ë²ˆí˜¸\n```\n\n## ë§ˆì¹˜ë©°\n\nì§€ê¸ˆê¹Œì§€ Thead Poolì„ WASì— ì ìš©í•´ ë³´ë©´ì„œ WASê°€ ë‹¤ì¤‘ ìš”ì²­ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤.\n\nì‚¬ì‹¤ ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ì—ëŠ” Thread Pool ë¿ë§Œ ì•„ë‹ˆë¼ WASì˜ Connectorë„ ë°€ì ‘í•˜ê²Œ ì—°ê´€ë˜ì–´ ìˆë‹¤.\n\ní˜„ì¬ êµ¬í˜„ëœ WASëŠ” Socket Connectionì„ ì²˜ë¦¬í•  ë•Œ ìë°”ì˜ ê¸°ë³¸ì ì¸ I/Oë¥¼ ì‚¬ìš©í•œë‹¤.\n\nThead Poolì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ìŠ¤ë ˆë“œëŠ” ì†Œì¼“ ì—°ê²°ì„ ë°›ì•„ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìš”ì²­ì— ëŒ€í•´ ì‘ë‹µí•œ ë‹¤ìŒ, ì†Œì¼“ ì—°ê²°ì´ ì¢…ë£Œë˜ë©´ Thead Poolì— ë°˜ë‚©ëœë‹¤.\n\nì¦‰, connectionì´ ë‹«í ë•Œê¹Œì§€ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œëŠ” íŠ¹ì • connectionì— ê³„ì† í• ë‹¹ë˜ì–´ ìˆê²Œ ëœë‹¤.\n\nì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ìŠ¤ë ˆë“œë¥¼ í• ë‹¹í•˜ì—¬ ì‚¬ìš©í•˜ë©´, ë™ì‹œì— ì‚¬ìš©ë˜ëŠ” ìŠ¤ë ˆë“œ ìˆ˜ê°€ ë™ì‹œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ìˆ˜ê°€ ë˜ì–´ ë²„ë¦¬ëŠ”ë° ìŠ¤ë ˆë“œë“¤ì´ ì¶©ë¶„íˆ ì‚¬ìš©ë˜ì§€ ì•Šê³  idle ìƒíƒœë¡œ ë‚­ë¹„ë˜ëŠ” ì‹œê°„ì´ ë§ì´ ë°œìƒí•˜ê²Œ ëœë‹¤.\n\nì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ `NIO Connector` ê°€ ë“±ì¥í•˜ì˜€ëŠ”ë° ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ BIO ë°©ì‹ê³¼ NIO ë°©ì‹ì˜ ì°¨ì´ì ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.\n\n---\n\n### ì°¸ê³ ìë£Œ ğŸ“š\n\n- [Task queuing in Executors.newFixedThreadPool()](https://medium.com/@amardeepbhowmick92/task-queuing-in-executors-newfixedthreadpool-31bc8c24b4d2)\n- [Introduction to Thread Pools in Java](https://www.baeldung.com/thread-pool-java-and-guava)\n- [JAVA ì“°ë ˆë“œí’€ ë¶„ì„ - newFixedThreadPool ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ê°€?](https://hamait.tistory.com/937)\n- [ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” ì–´ë–»ê²Œ ë‹¤ì¤‘ ìœ ì € ìš”ì²­ì„ ì²˜ë¦¬í• ê¹Œ? (Tomcat9.0 Thread Pool)](https://velog.io/@sihyung92/how-does-springboot-handle-multiple-requests)\n- [ë³‘í–‰ì„±(Concurrency)ì„ ìœ„í•œ CountDownLatch](https://imasoftwareengineer.tistory.com/100)\n","lang":"ko","allPostsInOtherLang":[{"id":"post9","lang":"en","title":"Solving the Billion-Dollar Mistake: Modern Java Null Safety with JSpecify and NullAway","date":"2025-09-24","section":"tech","tags":"Null Safety","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ftotx4mdagz9nsegld5mr.png","description":"Learn how to eliminate NullPointerExceptions using JSpecify annotations and NullAway static analysis in modern Java applications","searchKeywords":"JSpecify, NullAway, Java null safety, NullPointerException prevention, static analysis","translationSlug":"post10","preview":"\nWhether you're a developer just starting with Java or a senior engineer with two decades of experience, the most frequently encountered err"},{"id":"post8","lang":"en","title":"PostgreSQL MVCC Internals: From xmin/xmax to Isolation Levels","date":"2025-07-06","section":"tech","tags":"PostgreSQL","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7rk467sodudw3ww7iisi.png","description":"Deep dive into PostgreSQL's MVCC implementation, understanding xmin/xmax and how different isolation levels work internally","searchKeywords":"PostgreSQL, MVCC, xmin, xmax, transaction, isolation level, concurrency control","preview":"\nWhen multiple users access a database concurrently, how can we guarantee Isolation, one of the core `ACID` properties? While we could apply"},{"id":"post7","lang":"en","title":"Prompt Engineering Tips from Anthropic Engineers","date":"2025-06-24","section":"tech","tags":"Prompt Engineering, AI, Anthropic, LLM","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fdzzrfth8zqdnrhbj9538.png","description":"Valuable prompt engineering tips and insights from Anthropic engineers","searchKeywords":"prompt engineering, AI tips, Anthropic, LLM best practices","translationSlug":"post22","preview":"\nHere are a few impressive points from [youtube (AI prompt engineering: A deep dive)](https://www.youtube.com/watch?v=T9aRN5JkmL8\u0026t=2463s) w"},{"id":"post6","lang":"en","title":"From Theory to Practice: A JMH Showdown Between Sequential and Parallel Streams","date":"2025-06-15","section":"tech","tags":"Java, JMH","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7ytq239pcfe279t9avzg.png","description":"Practical performance comparison between sequential and parallel streams using JMH benchmarking","searchKeywords":"JMH benchmark, Java performance, sequential vs parallel, stream optimization","preview":"\nIn our [previous post](https://dev.to/headf1rst/discover-how-forkjoinpool-powers-javas-high-performance-parallel-processing-3pn7), we delve"},{"id":"post5","lang":"en","title":"Discover how ForkJoinPool powers Java's high-performance parallel processing","date":"2025-06-03","section":"tech","tags":"ForkJoinPool","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qgawc6pj2vbyzuem20wn.png","description":"Understanding ForkJoinPool and how it powers Java's parallel stream processing","searchKeywords":"ForkJoinPool, Java parallel processing, work-stealing, parallelStream","preview":"\nRecently, I optimized our transport operation plan Excel upload feature, boosting performance for logistics system administrators. This too"},{"id":"post4","lang":"en","title":"Why @Transactional Sometimes Fails: A Deep Dive into Spring AOP Proxies","section":"tech","date":"2025-06-01","tags":"AOP, Transactional","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/a1wxef2amdixh3lr4any.png","description":"Understanding Spring AOP proxies and why @Transactional sometimes fails with internal method calls","searchKeywords":"Spring AOP, @Transactional, proxy pattern, self-invocation","preview":"\n## How @Transactional Works\n\n### Transaction Management via AOP and the Proxy Pattern\n\nAOP (Aspect-Oriented Programming) is a programming p"},{"id":"post3","lang":"en","title":"Java ClassLoaders: How the JVM Dynamically Loads \u0026 Executes Your Code","section":"tech","date":"2025-05-27","tags":"Java","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/iu4pe4d29jz23wt26kwz.png","description":"Deep dive into Java ClassLoaders and JVM's dynamic class loading mechanisms","searchKeywords":"Java ClassLoader, JVM, dynamic loading, class loading process","preview":"\nJava's \"Write Once, Run Anywhere\" principle is foundational to its sustained popularity. This portability is powered by the Java Virtual Ma"},{"id":"post2","lang":"en","title":"Understanding and Resolving the N+1 Query Problem in JPA","section":"tech","date":"2025-05-05","tags":"JPA, Hibernate, N+1 Problem","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fsrf6chohgt3athvqj7u1.png","description":"Learn what causes the N+1 query problem in JPA, how to identify it, and practical solutions using fetch joins, EntityGraph, and QueryDSL","searchKeywords":"JPA, N+1, Hibernate, performance, optimization, fetch join, EntityGraph, QueryDSL","preview":"\nThe **N+1 query problem** arises when one initial query (1) is followed by N additional queriesâ€”one for each result row from the first quer"},{"id":"post1","lang":"en","title":"Kafka Producer Stability Check: Ensuring Message Safety in Apache Kafka","section":"tech","date":"2025-05-04","tags":"Kafka, Producer, Reliability, Apache Kafka","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ojt2w7s7rr9kws35r2yg.png","description":"Learn how to build fault-tolerant Kafka producers that survive rolling patches and broker failures","searchKeywords":"Kafka, producer, reliability, message safety, rolling patch, broker failure","preview":"\nDuring a recent incident, our team observed message loss from a Kafka producer during an Amazon MSK rolling patch. What began as a routine "}]},"__N_SSG":true},"page":"/[lang]/[id]","query":{"lang":"ko","id":"post9"},"buildId":"RQi-WhCUNal12o9SrKu8R","assetPrefix":"/log","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>