<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/2nHGFTv.png"/><link rel="manifest" href="/log/site.webmanifest"/><link rel="mask-icon" href="/log/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><title>Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ</title><meta name="title" content="Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ"/><meta name="description" content=""/><meta name="keywords" content=""/><meta name="robots" content="index, follow"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="language" content="Korean"/><meta name="author" content="Sanha Ko"/><meta property="og:title" content="Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ"/><meta property="og:url" content="https://headf1rst.github.io/log/ko/post33"/><meta property="og:type" content="blog"/><meta property="og:image" content="https://miro.medium.com/1*KNou9wcBzw1P9IrgfxrJyQ.png"/><meta property="og:description"/><link rel="alternate" hrefLang="ko" href="https://headf1rst.github.io/log/ko/post33"/><link rel="alternate" hrefLang="x-default" href="https://headf1rst.github.io/log/ko/post33"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","headline":"Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ","datePublished":"2025-12-26","dateModified":"2025-12-26","author":{"@type":"Person","name":"Sanha Ko","url":"https://github.com/headF1rst"},"description":"","image":"https://miro.medium.com/1*KNou9wcBzw1P9IrgfxrJyQ.png","url":"https://headf1rst.github.io/log/ko/post33","keywords":"Netty","inLanguage":"ko-KR","about":[{"@type":"Thing","name":"Netty"}],"programmingLanguage":"Java, Kotlin, JavaScript, TypeScript","publisher":{"@type":"Organization","name":"ì‚°í•˜ê°œë°œì‹¤ë¡","logo":{"@type":"ImageObject","url":"https://i.imgur.com/JtjOEf3.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://headf1rst.github.io/log/ko/post33"}}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://headf1rst.github.io/log/ko"},{"@type":"ListItem","position":2,"name":"Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ","item":"https://headf1rst.github.io/log/ko/post33"}]}</script><meta name="next-head-count" content="26"/><link rel="preload" href="/log/_next/static/css/12f1bbdb773e9471.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/12f1bbdb773e9471.css" data-n-g=""/><link rel="preload" href="/log/_next/static/css/38994dd0aed51f22.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/38994dd0aed51f22.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/log/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/log/_next/static/chunks/webpack-82b4c2acf5604dc5.js" defer=""></script><script src="/log/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/log/_next/static/chunks/main-6e6d6dc6617c8481.js" defer=""></script><script src="/log/_next/static/chunks/pages/_app-3cbbaf6a90de61d5.js" defer=""></script><script src="/log/_next/static/chunks/9f96d65d-fb5fd9e6ccafc67e.js" defer=""></script><script src="/log/_next/static/chunks/259-59cbd4b09a9629be.js" defer=""></script><script src="/log/_next/static/chunks/819-49378f41c4211145.js" defer=""></script><script src="/log/_next/static/chunks/pages/%5Blang%5D/%5Bid%5D-c173481abf3f6953.js" defer=""></script><script src="/log/_next/static/vjSj3GbVwS7vkZ0Aa3KlF/_buildManifest.js" defer=""></script><script src="/log/_next/static/vjSj3GbVwS7vkZ0Aa3KlF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="flex bg-white sticky top-0 left-0 z-50 justify-between items-center border-b-2 border-gray-100 py-3 md:justify-start md:space-x-10 px-10 sm:px-5 dark:bg-[#0d1117] dark:text-[#c9d1d9] dark:border-gray-600"><div class="flex justify-start"><a href="/log/ko/"><div class="flex items-center gap-2 cursor-pointer"><h1 class="text-lg ">JustAnotherBlog</h1></div></a></div><div class="flex justify-between gap-10 sm:hidden items-center"><a href="/log/ko/"><button class="font-light hover:text-indigo-300 text-base">Home</button></a><a href="/log/ko/?section=tech"><button class="font-light hover:text-indigo-300 text-base">Tech</button></a><a href="/log/ko/?section=domain"><button class="font-light hover:text-indigo-300 text-base">Domain</button></a><a href="https://plain-composer-c65.notion.site/29c7640fdf054059b6ea28ed61189bfb" target="_blank" rel="noreferrer" class="hover:text-indigo-300 text-base font-light flex gap-1">About<span class="flex justify-center" style="align-items:center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z"></path><path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"></path></svg></span></a><div class="relative"><button class="flex items-center gap-1 hover:text-indigo-300 text-base font-light">ğŸ‡°ğŸ‡·<!-- --> <!-- -->í•œêµ­ì–´</button></div></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="lg:hidden" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></nav><main class="dark:bg-[#0d1117] h-screen pb-10"><div class="flex flex-col w-3/5 sm:w-5/6 m-auto pt-20 pb-20 gap-10 dark:bg-[#0d1117] dark:text-[#c9d1d9]"><ul id="scroll-spy" class="sm:hidden p-10 fixed top-50 right-0 h-full w-1/5 text-gray-500 dark:text-[#c9d1d9]"></ul><div class="text-5xl font-bold">Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ</div><div class="flex flex-col gap-2"><div class="text-base text-gray-600 dark:text-gray-300">2025-12-26</div><div class="flex flex-wrap gap-2 dark:text-black sm:m-0"><span class="p-1 pl-3 pr-3 rounded-md bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition ease-in-out duration-200 text-sm">Netty</span></div></div><div class="flex items-center gap-2"><span class="text-sm text-gray-400">ğŸ‡ºğŸ‡¸ ì˜ì–´ë¡œ ì½ê¸°</span></div><div class="markdown-body" style="font-size:17px"><p>ë¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ë³´ìœ í•˜ê³  ìˆëŠ” íšŒì‚¬ë“¤ì€ 3PLì´ë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 3PLì´ë€ ë¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ê°–ì¶˜ íšŒì‚¬ê°€ ê·¸ë ‡ì§€ ëª»í•œ íŒë§¤ì²˜ë¡œë¶€í„° ë°°ì†¡ ì—…ë¬´ë¥¼ ìœ„íƒë°›ì•„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤.</p>
<p>íŒë§¤ì²˜ëŠ” ë°°ì†¡ì´ í•„ìš”í•œ ì£¼ë¬¸ ëª©ë¡ì„ 3PL ì‹œìŠ¤í…œì— ë“±ë¡í•˜ê²Œ ë˜ëŠ”ë°, ì´ ê³¼ì •ì—ì„œ ì…ë ¥ëœ ì£¼ë¬¸ì´ ìœ íš¨í•œ ì£¼ë¬¸ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ ì‹œìŠ¤í…œê³¼ ì†Œí†µí•˜ê²Œ ë©ë‹ˆë‹¤.</p>
<p>ì™¸ë¶€ API í˜¸ì¶œì„ ìœ„í•œ ë„êµ¬ë¡œëŠ” WebClientë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆëŠ”ë°ìš”. ì•„ë˜ ì§€í‘œì—ì„œ ë³´ë“¯ì´, ì™¸ë¶€ API í˜¸ì¶œê¹Œì§€ì˜ ì§€ì—° ì‹œê°„ì´ ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ì´ ê¸¸ì–´ì§€ëŠ” í˜„ìƒì´ &#x27;ê°„í—ì &#x27;ìœ¼ë¡œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yb2pzcn03325b8pk9z9p.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” í•´ë‹¹ í˜„ìƒì˜ ì›ì¸ì„ íŒŒì•…í•˜ë©° ì•Œê²Œ ëœ WebClientì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ì™€ Reactor Nettyì˜ ì•„í‚¤í…ì²˜, ê·¸ë¦¬ê³  í•´ê²°ì±…ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.</p>
<h2>ì›ì¸ íŒŒì•…ì„ ìœ„í•œ ê°€ì •</h2>
<p>ì§€ì—°ì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì€ ìš”ì²­ì´ ì–´ë”˜ê°€ì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬ë˜ì§€ ëª»í•˜ê³  ëŒ€ê¸°í•˜ê³  ìˆì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.</p>
<p>ì´ì „ ì‚¬ì§„ì—ì„œ ë¹¨ê°„ ë°•ìŠ¤ë¡œ í‘œì‹œëœ ë©”ì„œë“œëŠ” ê°ì²´ ìƒì„±ê³¼ WebClient í˜¸ì¶œë§Œì„ ë‹´ë‹¹í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. WebClient ë‚´ë¶€ì˜ ì–´ëŠ ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ë³‘ëª©ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ ëª…í™•íˆ ì‹ë³„í•˜ë ¤ë©´ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ì´í•´ê°€ ì„ í–‰ë˜ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ WebClientì˜ ìš”ì²­ ì²˜ë¦¬ ë°©ì‹ê³¼ Reactor Nettyì˜ ì•„í‚¤í…ì²˜ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.</p>
<h2>WebClient ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜</h2>
<p>ë¨¼ì € ë¬¸ì œê°€ ë°œìƒí•œ ì½”ë“œì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p><strong>OrderRegistrationService.java</strong></p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">int</span><span> CONCURRENCY_CALL = </span><span style="color:#986801">10</span><span>;
</span>
<!-- -->List&lt;RefineResult&gt; results = Flux.fromIterable(registerDtos)
<!-- -->    .flatMap(dto -&gt; Mono.defer(() -&gt;
<!-- -->       omsService.refineAddress(dto.getPrimaryAddress(), dto.getSecondaryAddress())
<span>       .defaultIfEmpty(ApiResponse.failure(</span><span style="color:#50a14f">&quot;NO_RESPONSE&quot;</span><span>, </span><span style="color:#a626a4">false</span><span>))
</span><span>    ).map(resp -&gt; </span><span style="color:#a626a4">new</span><span> RefineResult(dto, resp)), CONCURRENCY_CALL)
</span>    .collectList()
<!-- -->    .block();</code></div></pre>
<p><strong>OmsService.java</strong></p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Override</span><span>
</span><span></span><span style="color:#a626a4">public</span><span> Mono&lt;ApiResponse&lt;RefineAddressDto&gt;&gt; refineAddress(String primaryAddress, String secondaryAddress) {
</span>    RefineAddressInput request = RefineAddressInput.builder()
<!-- -->        .primaryAddress(primaryAddress)
<!-- -->        .secondaryAddress(secondaryAddress)
<!-- -->        .build();
<!-- -->
<span>    </span><span style="color:#a626a4">return</span><span> omsClient.post()
</span><span>        .uri(</span><span style="color:#50a14f">&quot;/refine-address&quot;</span><span>)
</span>        .bodyValue(request)
<!-- -->        .retrieve()
<!-- -->        .bodyToMono(RefineAddressOutput.class)
<span>        .timeout(Duration.ofSeconds(</span><span style="color:#986801">5</span><span>))
</span><span>        .retryWhen(RetryPolicy.fixedDelay(</span><span style="color:#986801">1</span><span>, Duration.ofMillis(</span><span style="color:#986801">100</span><span>), </span><span style="color:#50a14f">&quot;[OMS ì£¼ì†Œì •ì œ] ì¬ì‹œë„ ìš”ì²­: &quot;</span><span> + request))
</span>        .map(output -&gt; output.isSuccess() ? ApiResponse.success(RefineAddressDto.from(output))
<span>            : ApiResponse.&lt;RefineAddressDto&gt;failure(</span><span style="color:#50a14f">&quot;ì‘ë‹µ ê²°ê³¼ì— ë°ì´í„°ê°€ ì—†ìŒ&quot;</span><span>, </span><span style="color:#a626a4">false</span><span>))
</span><span>        .onErrorResume(ex -&gt; ExternalErrorHandler.handleError(ex, extractOmsErrorMessage(ex), </span><span style="color:#50a14f">&quot;OMS ì£¼ì†Œì •ì œ&quot;</span><span>));
</span>}</code></div></pre>
<h2>Cold Sequenceì™€ êµ¬ë… ì‹œì </h2>
<p>ìœ„ ì½”ë“œì—ì„œ ì‹¤ì œ HTTP ìš”ì²­ì´ ì–¸ì œ ë°œìƒí•˜ëŠ”ì§€ ì´í•´í•˜ë ¤ë©´ WebClientì˜ Cold Sequence íŠ¹ì„±ì„ ë¨¼ì € ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>WebClientì˜ ë¦¬ì•¡í‹°ë¸Œ ì²´ì¸ì€ Cold Sequenceë¡œ ë™ì‘í•©ë‹ˆë‹¤. êµ¬ë…ì´ ë°œìƒí•˜ê¸° ì „ê¹Œì§€ëŠ” íŒŒì´í”„ë¼ì¸ë§Œ ì •ì˜ë  ë¿, ì‹¤ì œ ì‹¤í–‰ì€ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. HTTP ìš”ì²­ ë°œì†¡ ì‹œì ì€ <code node="[object Object]">subscribe()</code>ê°€ í˜¸ì¶œë˜ëŠ” ìˆœê°„ì´ë©°, ì½”ë“œìƒì˜ <code node="[object Object]">block()</code>ì´ ë‚´ë¶€ì ìœ¼ë¡œ ì´ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span>List&lt;RefineResult&gt; results = Flux.fromIterable(registerDtos)
</span>    .flatMap(dto -&gt; Mono.defer(() -&gt; ...))
<!-- -->    .collectList()
<span>    .block();  </span><span style="color:#a0a1a7;font-style:italic">// â† êµ¬ë… ì‹œì‘ì </span></code></div></pre>
<p><code node="[object Object]">block()</code>ì˜ êµ¬ë… ì‹ í˜¸ëŠ” **ì—­ë°©í–¥(upstream)**ìœ¼ë¡œ ì „íŒŒë©ë‹ˆë‹¤</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-text" style="white-space:pre"><span>block() â†’ collectList() â†’ flatMap() â†’ Mono.defer() â†’ WebClient ì²´ì¸</span></code></div></pre>
<p><code node="[object Object]">flatMap(Function, int concurrency)</code>ì€ ì¸ìë¡œ ì „ë‹¬ëœ concurrency ìˆ˜ ë§Œí¼ì˜ Monoë¥¼ ë™ì‹œì— êµ¬ë…í•©ë‹ˆë‹¤. <code node="[object Object]">Mono.defer()</code>ëŠ” ê° êµ¬ë… ì‹œì ë§ˆë‹¤ ë‚´ë¶€ ëŒë‹¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ Monoë¥¼ ìƒì„±í•˜ë¯€ë¡œ, ê° DTOë§ˆë‹¤ ë…ë¦½ì ì¸ HTTP ìš”ì²­ íŒŒì´í”„ë¼ì¸ì´ ìƒì„±ë©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// êµ¬ë…ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ WebClient ì²´ì¸ ìƒì„±</span><span>
</span>Mono.defer(() -&gt; omsService.refineAddress(...))</code></div></pre>
<h2>TaskQueueë¡œì˜ ì „ë‹¬</h2>
<p><code node="[object Object]">omsService.refineAddress(...)</code>ê°€ ë°˜í™˜í•˜ëŠ” Monoê°€ êµ¬ë…ë˜ë©´ ìš”ì²­ ì„¤ì •ì„ ë¹Œë“œí•˜ê³ , <code node="[object Object]">.retrieve()</code> ì´í›„ ì²´ì¸ì´ êµ¬ë…ë˜ë©´ì„œ ì“°ê¸° ìš”ì²­ì´ <strong>TaskQueue</strong>ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span>omsClient.post()
</span><span>    .uri(</span><span style="color:#50a14f">&quot;/refine-address&quot;</span><span>)
</span>    .bodyValue(request)
<!-- -->    .retrieve()
<!-- -->    .bodyToMono(RefineAddressOutput.class)</code></div></pre>
<p>POST ìš”ì²­ì´ NioEventLoopì˜ TaskQueueì— ì €ì¥ë˜ë©´, WebClientë¥¼ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œì˜ ì—­í• ì€ ì—¬ê¸°ì„œ ëë‚©ë‹ˆë‹¤. ì´í›„ ì‘ì—…ì€ EventLoop ìŠ¤ë ˆë“œê°€ ë‹´ë‹¹í•©ë‹ˆë‹¤.</p>
<h2>Netty EventLoop ìŠ¤ë ˆë“œì˜ ë™ì‘ ì›ë¦¬</h2>
<p>WebClientì˜ HTTP ìš”ì²­ì´ TaskQueueì— ì €ì¥ë˜ëŠ” ì´ìœ ëŠ” Nettyì˜ <strong>ì´ë²¤íŠ¸ ë£¨í”„ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ ëª¨ë¸</strong> ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ëª¨ë¸ì„ ì´í•´í•˜ë ¤ë©´ ë¨¼ì € ë„¤íŠ¸ì›Œí¬ í†µì‹ ì˜ ê¸°ë³¸ ê°œë…ì„ ì§šê³  ë„˜ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.</p>
<h3>User Spaceì™€ Kernel Space</h3>
<p>ì„œë¡œ ë‹¤ë¥¸ ë¨¸ì‹ ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í†µì‹ í•˜ë ¤ë©´ ì‹œìŠ¤í…œ ì½œë¡œ ìœ ì € ëª¨ë“œì™€ ì»¤ë„ ëª¨ë“œë¥¼ ì˜¤ê°€ë©° ì»¤ë„ ë‚´ ì†Œì¼“ ë²„í¼ì— ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì¨ì•¼ í•©ë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qjtark4qo45ybfnj0lwk.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ì†Œì¼“ ë²„í¼ì— ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì½ê³  ì“°ëŠëƒì— ë”°ë¼ Blocking I/Oì™€ Non-blocking I/Oë¡œ ë‚˜ë‰©ë‹ˆë‹¤. ë‘˜ì˜ ì°¨ì´ëŠ” ìŠ¤ë ˆë“œê°€ ì‹œìŠ¤í…œ ì½œ í›„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ”ì§€ ì—¬ë¶€ì…ë‹ˆë‹¤.</p>
<ul>
<li><code node="[object Object]">Blocking I/O</code>: ë°ì´í„°ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ìŠ¤ë ˆë“œê°€ ëŒ€ê¸°</li>
<li><code node="[object Object]">Non-blocking I/O</code>: ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜, ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥</li>
</ul>
<p>íš¨ìœ¨ì ì¸ Non-blocking I/Oë¥¼ êµ¬í˜„í•˜ë ¤ë©´ íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•´ ë†“ê³  í•´ë‹¹ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œë§Œ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¡œ ì—¬ëŸ¬ ì±„ë„ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3>Multiplexing I/Oì™€ Selector</h3>
<p>ì´ë²¤íŠ¸ ê¸°ë°˜ ì†Œì¼“ í†µì‹ ì—ì„œëŠ” <strong>í•˜ë‚˜ì˜ Selectorê°€ ì—¬ëŸ¬ ì†Œì¼“ ì±„ë„ì˜ ë³€í™”ë¥¼ ê°ì§€</strong>í•˜ë©° ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ <code node="[object Object]">Multiplexing I/O</code>ë¼ê³  í•©ë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7sqinsru5nse3xrks1f3.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>Linuxì—ì„œ ì´ Multiplexing I/OëŠ” <code node="[object Object]">epoll</code> ì‹œìŠ¤í…œ ì½œë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. Java NIOì˜ SelectorëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì´ epollì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<h2>Selector.select()ì˜ ì‹¤ì œ ë™ì‘</h2>
<p>OS ì»¤ë„ì´ ëŠ¥ë™ì ìœ¼ë¡œ I/O ì´ë²¤íŠ¸ë¥¼ Selectorì— ì•Œë ¤ì£¼ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<p>Selector.select()ê°€ í˜¸ì¶œë˜ë©´ ìœ ì € ëª¨ë“œì—ì„œ ì»¤ë„ ëª¨ë“œë¡œ ì „í™˜ë˜ê³ , ë‚´ë¶€ì ìœ¼ë¡œ <code node="[object Object]">epoll_wait()</code> ì‹œìŠ¤í…œ ì½œì´ í˜¸ì¶œë˜ë©´ì„œ í˜¸ì¶œ ìŠ¤ë ˆë“œëŠ” ì»¤ë„ì—ì„œ ë¸”ë¡œí‚¹ ìƒíƒœë¡œ ëŒ€ê¸°í•©ë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rokpi9s20m4thyx0akjp.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p><code node="[object Object]">epoll_wait</code>ì„ í˜¸ì¶œí•˜ë©´, OS ì»¤ë„ì€ ì´ì „ì— <code node="[object Object]">epoll_ctl</code>ë¡œ ë“±ë¡ëœ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°(ì†Œì¼“)ë“¤ì„ ëª¨ë‹ˆí„°ë§í•˜ë‹¤ê°€, ë„¤íŠ¸ì›Œí¬ ì¹´ë“œì— ë°ì´í„°ê°€ ë„ì°©í•˜ê±°ë‚˜ ì†Œì¼“ ë²„í¼ì— ì“°ê¸°ê°€ ê°€ëŠ¥í•´ì§€ëŠ” ë“±ì˜ I/O ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì´ë¥¼ ê°ì§€í•©ë‹ˆë‹¤. I/Oê°€ ë°œìƒí•œ ì†Œì¼“ì€ ì»¤ë„ ë‚´ Ready Queueì— ì¶”ê°€ë˜ê³ , <code node="[object Object]">epoll_wait()</code>ì´ ë°˜í™˜ë˜ì–´ ëŒ€ê¸° ì¤‘ì´ë˜ ìŠ¤ë ˆë“œê°€ ê¹¨ì–´ë‚©ë‹ˆë‹¤.</p>
<p>ì¦‰, User Spaceê°€ ì»¤ë„ì— ìš”ì²­í•˜ê³  ì‹œìŠ¤í…œ ì½œë¡œ ì‘ë‹µë°›ëŠ” pull êµ¬ì¡°ì…ë‹ˆë‹¤.</p>
<p><code node="[object Object]">select()</code> ìì²´ëŠ” ë¸”ë¡œí‚¹ í˜¸ì¶œì´ì§€ë§Œ, í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ì—¬ëŸ¬ ì†Œì¼“ì„ ê°ì‹œí•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì†Œì¼“ë“¤ë§Œ ê³¨ë¼ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê° ì†Œì¼“ ì…ì¥ì—ì„œëŠ” ì „ìš© ìŠ¤ë ˆë“œ ì—†ì´ë„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ê²ƒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ì–»ê²Œ ë©ë‹ˆë‹¤.</p>
<h2>NioEventLoopì˜ êµ¬ì¡°</h2>
<p>ì´ì œ Nettyì˜ EventLoopê°€ Selectorë¥¼ ì–´ë–»ê²Œ í™œìš©í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p>EventLoopì˜ êµ¬í˜„ì²´ì¸ NioEventLoopëŠ” <code node="[object Object]">1 Thread + 1 Selector + 1 TaskQueue</code>ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c1xl9zcj1h0pk3eml8sr.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>EventLoop ìŠ¤ë ˆë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ CPU ì½”ì–´ ìˆ˜ë§Œí¼ ìƒì„±ë©ë‹ˆë‹¤. <code node="[object Object]">Math.max(Runtime.getRuntime().availableProcessors(), 4)</code></p>
<p>ê° EventLoop ìŠ¤ë ˆë“œëŠ” ì „ìš© NioEventLoop ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©°, ë‹¨ì¼ ìŠ¤ë ˆë“œê°€ ë¬´í•œ ë£¨í”„ë¥¼ ëŒë©´ì„œ ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
<ol>
<li>I/O ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë„¤íŠ¸ì›Œí¬ ì½ê¸°/ì“°ê¸°)</li>
<li>TaskQueueì˜ ì‘ì—… ì²˜ë¦¬ (ì‚¬ìš©ìê°€ ë“±ë¡í•œ Runnable)</li>
</ol>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// ê°œë…ì ì¸ ì½”ë“œ</span><span>
</span><span></span><span style="color:#a626a4">while</span><span> (</span><span style="color:#a626a4">true</span><span>) {
</span><span>    </span><span style="color:#a0a1a7;font-style:italic">// 1. ë„¤íŠ¸ì›Œí¬ì—ì„œ ë­”ê°€ ì¼ì–´ë‚¬ëŠ”ì§€ í™•ì¸</span><span>
</span>    ë„¤íŠ¸ì›Œí¬_ì´ë²¤íŠ¸_í™•ì¸();
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 2. ì¼ì–´ë‚œ ì¼ë“¤ ì²˜ë¦¬</span><span>
</span>    ì´ë²¤íŠ¸ë“¤_ì²˜ë¦¬();
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 3. ëˆ„ê°€ ì‹œì¼œë†“ì€ ì‘ì—…ë“¤ ì²˜ë¦¬</span><span>
</span>    ì‘ì—…íì—ì„œ_ì‘ì—…êº¼ë‚´ì„œ_ì‹¤í–‰();
<!-- -->}</code></div></pre>
<p>ì‹¤ì œ Netty ì½”ë“œë¥¼ ë³´ë©´ (Netty 4.2 ê¸°ì¤€)</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// SingleThreadIoEventLoop.java:153-164</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">protected</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">run</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span><span>    </span><span style="color:#a626a4">do</span><span> {
</span><span>        runIo();                    </span><span style="color:#a0a1a7;font-style:italic">// â† 1+2: I/O í™•ì¸ ë° ì²˜ë¦¬</span><span>
</span><span>        runAllTasks(maxTasksPerRun); </span><span style="color:#a0a1a7;font-style:italic">// â† 3: ì‘ì—…í ì²˜ë¦¬</span><span>
</span><span>    } </span><span style="color:#a626a4">while</span><span> (!confirmShutdown());
</span>}</code></div></pre>
<p><code node="[object Object]">runIo()</code>ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ <code node="[object Object]">NioIoHandler.run()</code>ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// NioIoHandler.java:420-485</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">run</span><span class="hljs-function hljs-params">(IoExecutionContext runner)</span><span class="hljs-function"> </span><span>{
</span><span>    </span><span style="color:#a0a1a7;font-style:italic">// 1ë‹¨ê³„: select - I/O ì´ë²¤íŠ¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸</span><span>
</span><span>    select(runner, wakenUp.getAndSet(</span><span style="color:#a626a4">false</span><span>));
</span>
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 2ë‹¨ê³„: ìˆìœ¼ë©´ ì²˜ë¦¬</span><span>
</span><span>    </span><span style="color:#a626a4">return</span><span> processSelectedKeys();
</span>}</code></div></pre>
<p>ì´ì œ ê° ë‹¨ê³„ë¥¼ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<h3>1. select() - I/O ì´ë²¤íŠ¸ ê°ì§€</h3>
<p>EventLoopëŠ” I/O ì´ë²¤íŠ¸ ì²˜ë¦¬ì™€ TaskQueueì— ìŒ“ì¸ ì‘ì—… ì²˜ë¦¬, ë‘ ê°€ì§€ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì´ë•Œ <code node="[object Object]">Selector.select()</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•  I/O ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
<p><code node="[object Object]">select()</code> ë©”ì„œë“œëŠ” TaskQueueì— ì‘ì—…ì´ ì¡´ì¬í•˜ëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ì ì ˆí•œ select ë°©ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// NioIoHandler.java</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">select</span><span class="hljs-function hljs-params">(IoExecutionContext runner, </span><span class="hljs-function hljs-params" style="color:#a626a4">boolean</span><span class="hljs-function hljs-params"> oldWakenUp)</span><span class="hljs-function"> </span><span>{
</span><span>    Selector selector = </span><span style="color:#a626a4">this</span><span>.selector;
</span>
<span>    </span><span style="color:#a626a4">for</span><span> (;;) {
</span><span>        </span><span style="color:#a0a1a7;font-style:italic">// íƒœìŠ¤í¬ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í™•ì¸í•˜ê³  ë„˜ì–´ê°</span><span>
</span><span>        </span><span style="color:#a626a4">if</span><span> (!runner.canBlock() &amp;&amp; wakenUp.compareAndSet(</span><span style="color:#a626a4">false</span><span>, </span><span style="color:#a626a4">true</span><span>)) {
</span><span>            selector.selectNow();   </span><span style="color:#a0a1a7;font-style:italic">// ì‘ì—… ìˆìœ¼ë©´ ë°”ë¡œ í™•ì¸</span><span>
</span><span>            </span><span style="color:#a626a4">break</span><span>;
</span>        }
<!-- -->
<span>        </span><span style="color:#a0a1a7;font-style:italic">// íƒœìŠ¤í¬ê°€ ì—†ìœ¼ë©´ ì´ë²¤íŠ¸ ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°</span><span>
</span><span>        </span><span style="color:#a626a4">int</span><span> selectedKeys = selector.select(timeoutMillis);
</span>    }
<!-- -->}</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Override</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">boolean</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">canBlock</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span><span>   </span><span class="hljs-function" style="color:#a626a4">assert</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">inEventLoop</span><span class="hljs-function hljs-params">()</span><span>;
</span><span>   </span><span style="color:#a626a4">return</span><span> !hasTasks() &amp;&amp; !hasScheduledTasks();
</span>}</code></div></pre>
<h4>TaskQueueê°€ ë¹„ì—ˆì„ ë•Œ</h4>
<p><code node="[object Object]">TaskQueue</code>ê°€ ë¹„ì–´ìˆìœ¼ë©´ NettyëŠ” <code node="[object Object]">select(timeout)</code>ì„ í˜¸ì¶œí•˜ì—¬ ì»¤ë„ë¡œ ë¶€í„° I/O ì´ë²¤íŠ¸ ì‹ í˜¸ë¥¼ ë°›ê±°ë‚˜ íƒ€ì„ì•„ì›ƒì´ ë  ë•Œê¹Œì§€ ë¸”ë¡œí‚¹ ìƒíƒœë¡œ ëŒ€ê¸°í•˜ì—¬ CPU ì‚¬ìš©ì„ ì¤„ì…ë‹ˆë‹¤.</p>
<p>ë§Œì•½ ëŒ€ê¸° ì¤‘ <code node="[object Object]">TaskQueue</code>ì— ìƒˆ taskê°€ ë“¤ì–´ì˜¤ë©´, <code node="[object Object]">wakeup</code> ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ <code node="[object Object]">select()</code>ì˜ ë¸”ë¡œí‚¹ì„ ê¹¨ì›Œì„œ ì¦‰ì‹œ ë°˜í™˜ì‹œí‚¤ê³ , ë£¨í”„ë¥¼ ëŒë©° TaskQueueë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<h4>TaskQueueê°€ ìˆì„ ë•Œ</h4>
<p><code node="[object Object]">TaskQueue</code>ì— ì‘ì—…ì´ ìˆìœ¼ë©´ <code node="[object Object]">selectNow()</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ I/O ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê³ , ê³§ë°”ë¡œ í…ŒìŠ¤í¬ ì‹¤í–‰ìœ¼ë¡œ ë„˜ì–´ê°€ ì‘ì—… ì§€ì—°ì„ ì¤„ì…ë‹ˆë‹¤.</p>
<p>ë§Œì•½ TaskQueueì— ì‘ì—…ì´ ìˆëŠ” ìƒí™©ì—ì„œ <code node="[object Object]">select(timeout)</code>ì„ í˜¸ì¶œí•´ ë¸”ë¡œí‚¹ë˜ë©´, EventLoop ìŠ¤ë ˆë“œê°€ ì ë“¤ì–´ í…ŒìŠ¤í¬ ì²˜ë¦¬ê°€ ì§€ì—°ë˜ê³  ì‘ë‹µì„±ì´ ë–¨ì–´ì§€ê²Œ ë©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ <code node="[object Object]">selectNow()</code>ë§Œ ê³„ì† ìˆ˜í–‰í•˜ë©´ ì¤€ë¹„ëœ I/O ì´ë²¤íŠ¸ê°€ ì—†ì–´ë„ ê³„ì† í™•ì¸í•˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ ë°˜ë³µìœ¼ë¡œ busy-wait(CPU ë‚­ë¹„)ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì¦‰, Nettyì˜ <code node="[object Object]">select()</code>ëŠ” ìƒí™©ì— ë”°ë¼ ì ì ˆí•œ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ CPUë¥¼ ë‚­ë¹„í•˜ì§€ ì•Šê³  íš¨ìœ¨ì ìœ¼ë¡œ I/O ì´ë²¤íŠ¸ë¥¼ ëŒ€ê¸°í•©ë‹ˆë‹¤.</p>
<h4>select() í˜¸ì¶œ ì´í›„ì˜ ë‚´ë¶€ ë™ì‘</h4>
<p>ì•ì„œ Nettyê°€ ìƒí™©ì— ë”°ë¼ <code node="[object Object]">select(timeout)</code> ë˜ëŠ” <code node="[object Object]">selectNow()</code>ë¥¼ ì„ íƒì ìœ¼ë¡œ í˜¸ì¶œí•œë‹¤ëŠ” ê²ƒì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ì œ ì´ í˜¸ì¶œì´ ì‹¤ì œë¡œ ì–´ë–¤ ê³¼ì •ì„ ê±°ì³ ì»¤ë„ê¹Œì§€ ë„ë‹¬í•˜ê³ , ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<p><code node="[object Object]">Selector.select()</code>ë¥¼ í˜¸ì¶œí•˜ë©´ JDK ë‚´ë¶€ì˜ <code node="[object Object]">SelectorImpl</code> í´ë˜ìŠ¤ê°€ ì´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// SelectorImpl.java</span><span>
</span><span></span><span style="color:#4078f2">@Override</span><span>
</span><span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">final</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">select</span><span class="hljs-function hljs-params">(</span><span class="hljs-function hljs-params" style="color:#a626a4">long</span><span class="hljs-function hljs-params"> timeout)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> IOException </span><span>{
</span><span>        </span><span style="color:#a626a4">return</span><span> lockAndDoSelect(</span><span style="color:#a626a4">null</span><span>, (timeout == </span><span style="color:#986801">0</span><span>) ? -</span><span style="color:#986801">1</span><span> : timeout);
</span>    }</code></div></pre>
<p><code node="[object Object]">lockAndDoSelect()</code>ëŠ” ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•œ ë’¤ Multiplexing I/Oë¥¼ ë‹´ë‹¹í•˜ëŠ” <code node="[object Object]">doSelect()</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// SelectorImpl.java</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">lockAndDoSelect</span><span class="hljs-function hljs-params">(Consumer&lt;SelectionKey&gt; action, </span><span class="hljs-function hljs-params" style="color:#a626a4">long</span><span class="hljs-function hljs-params"> timeout)</span><span class="hljs-function">
</span><span class="hljs-function">      </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> IOException
</span><span class="hljs-function"></span><span>{
</span><span>    </span><span style="color:#a626a4">synchronized</span><span> (</span><span style="color:#a626a4">this</span><span>) {
</span>        ensureOpen();
<span>        </span><span style="color:#a626a4">if</span><span> (inSelect)
</span><span>            </span><span style="color:#a626a4">throw</span><span> </span><span style="color:#a626a4">new</span><span> IllegalStateException(</span><span style="color:#50a14f">&quot;select in progress&quot;</span><span>);
</span><span>        inSelect = </span><span style="color:#a626a4">true</span><span>;
</span><span>        </span><span style="color:#a626a4">try</span><span> {
</span><span>            </span><span style="color:#a626a4">synchronized</span><span> (publicSelectedKeys) {
</span><span>                </span><span style="color:#a626a4">return</span><span> doSelect(action, timeout);
</span>            }
<span>        } </span><span style="color:#a626a4">finally</span><span> {
</span><span>            inSelect = </span><span style="color:#a626a4">false</span><span>;
</span>        }
<!-- -->    }
<!-- -->}</code></div></pre>
<p>ì—¬ê¸°ì„œ <code node="[object Object]">doSelect()</code>ëŠ” ì¶”ìƒ ë©”ì„œë“œì…ë‹ˆë‹¤. ìš´ì˜ì²´ì œë§ˆë‹¤ íš¨ìœ¨ì ì¸ Multiplexing I/O ë©”ì»¤ë‹ˆì¦˜ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, JDKëŠ” í”Œë«í¼ë³„ë¡œ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<table><thead><tr><th>OS</th><th>êµ¬í˜„ í´ë˜ìŠ¤</th><th>ì‹œìŠ¤í…œ ì½œ</th></tr></thead><tbody><tr><td>Linux</td><td>EPollSelectorImpl</td><td>epoll_wait()</td></tr><tr><td>macOS</td><td>KQueueSelectorImpl</td><td>kevent()</td></tr><tr><td>Windows</td><td>WindowsSelectorImpl</td><td>IOCP</td></tr></tbody></table>
<p>ì´ ê¸€ì—ì„œëŠ” ì„œë²„ í™˜ê²½ì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” <strong>Linuxì˜ epoll ê¸°ë°˜ êµ¬í˜„</strong>ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. (JDK 21 ê¸°ì¤€)</p>
<h3>EPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ëŠ” ì–¸ì œ ìƒì„±ë˜ëŠ”ê°€?</h3>
<p>EPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ëŠ” <code node="[object Object]">Selector.open()</code> í˜¸ì¶œ ì‹œì ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p>
<ol>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ new NioEventLoopGroup(n) í˜¸ì¶œ</li>
<li>ë‚´ë¶€ì ìœ¼ë¡œ nê°œì˜ NioIoHandler ìƒì„±</li>
<li>ê° NioIoHandler ìƒì„±ìì—ì„œ provider.openSelector() í˜¸ì¶œ</li>
<li>Linux í™˜ê²½ì—ì„œëŠ” EPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ ìƒì„±</li>
</ol>
<p>EPollSelectorImpl ìƒì„± ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì´ˆê¸°í™”ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span>EPollSelectorImpl(SelectorProvider sp) </span><span style="color:#a626a4">throws</span><span> IOException {
</span><span>   </span><span style="color:#a626a4">super</span><span>(sp);
</span>
<span>   </span><span style="color:#a0a1a7;font-style:italic">// 1. epoll ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (epoll_create ì‹œìŠ¤í…œ ì½œ)</span><span>
</span><span>   </span><span style="color:#a626a4">this</span><span>.epfd = EPoll.create();
</span>
<span>   </span><span style="color:#a0a1a7;font-style:italic">// 2. epoll_wait ê²°ê³¼ë¥¼ ì €ì¥í•  ë„¤ì´í‹°ë¸Œ ë©”ëª¨ë¦¬ í• ë‹¹</span><span>
</span><span>   </span><span style="color:#a626a4">this</span><span>.pollArrayAddress = EPoll.allocatePollArray(NUM_EPOLLEVENTS);
</span>
<span>   </span><span style="color:#a0a1a7;font-style:italic">// 3. wakeupìš© EventFD ìƒì„±</span><span>
</span><span>   </span><span style="color:#a626a4">this</span><span>.eventfd = </span><span style="color:#a626a4">new</span><span> EventFD();
</span><span>   IOUtil.configureBlocking(IOUtil.newFD(eventfd.efd()), </span><span style="color:#a626a4">false</span><span>);
</span>
<span>   </span><span style="color:#a0a1a7;font-style:italic">// 4. EventFDë¥¼ epollì— EPOLLINìœ¼ë¡œ ë“±ë¡</span><span>
</span>   EPoll.ctl(epfd, EPOLL_CTL_ADD, eventfd.efd(), EPOLLIN);
<!-- -->}</code></div></pre>
<p>ì¦‰, í•˜ë‚˜ì˜ EventLoopë§ˆë‹¤ í•˜ë‚˜ì˜ epoll ì¸ìŠ¤í„´ìŠ¤ê°€ ë§¤í•‘ë©ë‹ˆë‹¤.</p>
<h4>epollì˜ ì„¸ ê°€ì§€ ì‹œìŠ¤í…œ ì½œ</h4>
<p>epollì€ ì„¸ ê°€ì§€ ì‹œìŠ¤í…œ ì½œì„ ì œê³µí•©ë‹ˆë‹¤</p>
<ul>
<li><code node="[object Object]">epoll_create</code>: epoll ì¸ìŠ¤í„´ìŠ¤(ì±„ë„ ê°ì‹œ ì €ì¥ì†Œ) ìƒì„±</li>
<li><code node="[object Object]">epoll_ctl</code>: ê°ì‹œí•  FD ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</li>
<li><code node="[object Object]">epoll_wait</code>: ì´ë²¤íŠ¸(read/write)ê°€ ë°œìƒí•  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê³ , ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ FD ëª©ë¡ì„ ë°˜í™˜</li>
</ul>
<p>JDKì˜ <code node="[object Object]">EPoll.wait()</code>ëŠ” JNIë¥¼ í†µí•´ ì»¤ë„ì˜ <code node="[object Object]">epoll_wait()</code> ì‹œìŠ¤í…œ ì½œì„ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.</p>
<p><code node="[object Object]">epoll_wait()</code>ëŠ” ë¯¸ë¦¬ í• ë‹¹ëœ ë„¤ì´í‹°ë¸Œ ë©”ëª¨ë¦¬ì˜ <code node="[object Object]">epoll_event</code> êµ¬ì¡°ì²´ ë°°ì—´ì— ì¤€ë¹„ëœ ì´ë²¤íŠ¸ ì •ë³´ë¥¼ ì±„ìš°ê³ , ì¤€ë¹„ëœ ì´ë²¤íŠ¸ ê°œìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ ë°°ì—´ì—ëŠ” ê° FDì™€ ë°œìƒí•œ  ì´ë²¤íŠ¸ íƒ€ì…(EPOLLIN/EPOLLOUT/EPOLLERR ë“±)ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.</p>
<p>EPollSelectorImpl.doSelect()ì—ì„œ ì´ ë©”ì„œë“œë“¤ì´ ì‹¤ì œë¡œ í˜¸ì¶œë˜ëŠ” íë¦„ì„ ë³´ë©´:</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// EpollSelectorImpl.java</span><span>
</span><span></span><span style="color:#4078f2">@Override</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">protected</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">doSelect</span><span class="hljs-function hljs-params">(Consumer&lt;SelectionKey&gt; action, </span><span class="hljs-function hljs-params" style="color:#a626a4">long</span><span class="hljs-function hljs-params"> timeout)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> IOException </span><span>{
</span><span>    </span><span style="color:#a626a4">int</span><span> to = (</span><span style="color:#a626a4">int</span><span>) Math.min(timeout, Integer.MAX_VALUE);
</span>
<span>    </span><span style="color:#a626a4">int</span><span> numEntries;
</span><span>    processUpdateQueue();      </span><span style="color:#a0a1a7;font-style:italic">// epoll_ctlë¡œ ê´€ì‹¬ ì´ë²¤íŠ¸ ë³€ê²½ ë°˜ì˜</span><span>
</span>    processDeregisterQueue();
<!-- -->
<span>    </span><span style="color:#a626a4">try</span><span> {
</span>        begin(blocking);
<span>        </span><span style="color:#a0a1a7;font-style:italic">// epoll_wait ì‹œìŠ¤í…œ ì½œ í˜¸ì¶œ</span><span>
</span>        numEntries = EPoll.wait(epfd, pollArrayAddress, NUM_EPOLLEVENTS, to);
<span>    } </span><span style="color:#a626a4">finally</span><span> {
</span>        end(blocking);
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// ë°˜í™˜ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬</span><span>
</span><span>    </span><span style="color:#a626a4">return</span><span> processEvents(numEntries, action);
</span>}</code></div></pre>
<h3>2. processSelectedKeys() - I/O ì´ë²¤íŠ¸ ì²˜ë¦¬</h3>
<p><code node="[object Object]">EPoll.wait()</code>ê°€ ì´ë²¤íŠ¸ ê°œìˆ˜ë¥¼ ë°˜í™˜í•˜ë©´, <code node="[object Object]">EPollSelectorImpl.processEvents()</code>ê°€ í•´ë‹¹ ê°œìˆ˜ë§Œí¼ ì´ë²¤íŠ¸ ë°°ì—´ì„ ìˆœíšŒí•˜ë©° ê° FDì— ì—°ê²°ëœ SelectionKeyë¥¼ ì°¾ì•„ selectedKeysì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´í›„ Nettyì˜ <code node="[object Object]">NioIoHandler.processSelectedKeys()</code>ê°€ <code node="[object Object]">seletedKeys</code>ë¥¼ ìˆœíšŒí•˜ë©° ê° ì±„ë„ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span> </span><span style="color:#a0a1a7;font-style:italic">// NioIoHandler.java</span><span>
</span><span>  </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">int</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">processSelectedKeysOptimized</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span><span>      </span><span style="color:#a626a4">int</span><span> handled = </span><span style="color:#986801">0</span><span>;
</span><span>      </span><span style="color:#a626a4">for</span><span> (</span><span style="color:#a626a4">int</span><span> i = </span><span style="color:#986801">0</span><span>; i &lt; selectedKeys.size; ++i) {
</span>          SelectionKey k = selectedKeys.keys[i];
<span>          selectedKeys.keys[i] = </span><span style="color:#a626a4">null</span><span>;  </span><span style="color:#a0a1a7;font-style:italic">// GCë¥¼ ìœ„í•´ null ì²˜ë¦¬</span><span>
</span>
<span>          processSelectedKey(k);  </span><span style="color:#a0a1a7;font-style:italic">// ê° ì´ë²¤íŠ¸ ì²˜ë¦¬</span><span>
</span>          ++handled;
<!-- -->      }
<span>      </span><span style="color:#a626a4">return</span><span> handled;
</span>  }</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span>  </span><span class="hljs-function" style="color:#a626a4">private</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">processSelectedKey</span><span class="hljs-function hljs-params">(SelectionKey k)</span><span class="hljs-function"> </span><span>{
</span><span>      </span><span style="color:#a626a4">final</span><span> DefaultNioRegistration registration = (DefaultNioRegistration) k.attachment();
</span>
<span>      </span><span style="color:#a0a1a7;font-style:italic">// ì¤€ë¹„ëœ ì´ë²¤íŠ¸ë¥¼ í•¸ë“¤ëŸ¬ì— ì „ë‹¬</span><span>
</span><span>      </span><span style="color:#a0a1a7;font-style:italic">// OP_READ  â†’ ë°ì´í„° ìˆ˜ì‹ </span><span>
</span><span>      </span><span style="color:#a0a1a7;font-style:italic">// OP_WRITE â†’ ë°ì´í„° ì†¡ì‹ </span><span>
</span><span>      </span><span style="color:#a0a1a7;font-style:italic">// OP_CONNECT â†’ ì—°ê²° ì™„ë£Œ</span><span>
</span><span>      </span><span style="color:#a0a1a7;font-style:italic">// OP_ACCEPT â†’ ìƒˆ ì—°ê²° ìš”ì²­</span><span>
</span>      registration.handle(k.readyOps());
<!-- -->  }</code></div></pre>
<p><code node="[object Object]">registration.handle()</code>ì€ ë‚´ë¶€ì ìœ¼ë¡œ <code node="[object Object]">AbstractNioChannel.AbstractNioUnsafe.handle()</code>ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” ì´ë²¤íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// AbstractNioChannel.java:420-450</span><span>
</span><span></span><span style="color:#4078f2">@Override</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">handle</span><span class="hljs-function hljs-params">(IoRegistration registration, IoEvent event)</span><span class="hljs-function"> </span><span>{
</span>    NioIoOps nioReadyOps = ((NioIoEvent) event).ops();
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 1. OP_CONNECT: ì—°ê²° ì™„ë£Œ ì²˜ë¦¬ (ê°€ì¥ ë¨¼ì € ì²˜ë¦¬)</span><span>
</span><span>    </span><span style="color:#a626a4">if</span><span> (nioReadyOps.contains(NioIoOps.CONNECT)) {
</span>        removeAndSubmit(NioIoOps.CONNECT);
<!-- -->        unsafe().finishConnect();
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 2. OP_WRITE: ì“°ê¸° ê°€ëŠ¥ ìƒíƒœ - ëŒ€ê¸° ì¤‘ì¸ ë²„í¼ ì „ì†¡</span><span>
</span><span>    </span><span style="color:#a626a4">if</span><span> (nioReadyOps.contains(NioIoOps.WRITE)) {
</span>        forceFlush();
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// 3. OP_READ / OP_ACCEPT: ë°ì´í„° ìˆ˜ì‹  ë˜ëŠ” ìƒˆ ì—°ê²° ìˆ˜ë½</span><span>
</span><span>    </span><span style="color:#a626a4">if</span><span> (nioReadyOps.contains(NioIoOps.READ_AND_ACCEPT) || nioReadyOps.equals(NioIoOps.NONE)) {
</span>        read();
<!-- -->    }
<!-- -->}</code></div></pre>
<h3>3. runAllTasks() - Non-I/O Task ì²˜ë¦¬</h3>
<p>I/O ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ëë‚˜ë©´ runAllTasks()ê°€ í˜¸ì¶œë˜ì–´ TaskQueueì— ìŒ“ì¸ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. WebClientì˜ HTTP ìš”ì²­ë„ ë°”ë¡œ ì´ ë‹¨ê³„ì—ì„œ ì‹¤ì œë¡œ ì „ì†¡ë©ë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a0a1a7;font-style:italic">// SingleThreadEventExecutor.java</span><span>
</span><span></span><span class="hljs-function" style="color:#a626a4">protected</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">boolean</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">runAllTasks</span><span class="hljs-function hljs-params">(</span><span class="hljs-function hljs-params" style="color:#a626a4">long</span><span class="hljs-function hljs-params"> timeoutNanos)</span><span class="hljs-function"> </span><span>{
</span><span>     </span><span style="color:#a0a1a7;font-style:italic">// ìŠ¤ì¼€ì¤„ íì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ íƒœìŠ¤í¬ë¥¼ TaskQueueë¡œ ì´ë™</span><span>
</span>     fetchFromScheduledTaskQueue();
<!-- -->     Runnable task = pollTask();
<!-- -->
<span>     </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">long</span><span> deadline = timeoutNanos &gt; </span><span style="color:#986801">0</span><span> ? getCurrentTimeNanos() + timeoutNanos : </span><span style="color:#986801">0</span><span>;
</span><span>     </span><span style="color:#a626a4">long</span><span> runTasks = </span><span style="color:#986801">0</span><span>;
</span>
<span>     </span><span style="color:#a626a4">for</span><span> (;;) {
</span><span>         safeExecute(task); </span><span style="color:#a0a1a7;font-style:italic">// í…ŒìŠ¤í¬ ì‹¤í–‰</span><span>
</span>
<!-- -->         runTasks ++;
<!-- -->
<!-- -->         task = pollTask();
<span>         </span><span style="color:#a626a4">if</span><span> (task == </span><span style="color:#a626a4">null</span><span>) {
</span>             lastExecutionTime = getCurrentTimeNanos();
<span>             </span><span style="color:#a626a4">break</span><span>;
</span>          }
<!-- -->      }
<!-- -->
<!-- -->     afterRunningAllTasks();
<span>     </span><span style="color:#a626a4">return</span><span> </span><span style="color:#a626a4">true</span><span>;
</span>}</code></div></pre>
<h3>ì „ì²´ íë¦„ ìš”ì•½</h3>
<p>ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ë‚´ìš©ì„ í•˜ë‚˜ì˜ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s5f9g86wsuwo500ky37d.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ë³‘ëª©ì´ ë°œìƒí•œ ì¸ìŠ¤í„´ìŠ¤ì˜ vCPU ìˆ˜ëŠ” 2ê°œì˜€ìŠµë‹ˆë‹¤. Nettyì˜ EventLoop ìŠ¤ë ˆë“œ ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ <code node="[object Object]">Math.max(availableProcessors(), 4)</code>ë¡œ ê²°ì •ë˜ë¯€ë¡œ, ì´ í™˜ê²½ì—ì„œëŠ” EventLoop ìŠ¤ë ˆë“œê°€ <strong>ì´ 4ê°œ</strong> ì¡´ì¬í•©ë‹ˆë‹¤.</p>
<p>ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ë°”ì™€ ê°™ì´ Nettyì˜ EventLoopëŠ” Multiplexing I/O ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì ì€ ìˆ˜ì˜ ìŠ¤ë ˆë“œë¡œë„ ë§ì€ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code node="[object Object]">epoll_wait()</code>ì€ ìˆ˜ì²œ ê°œì˜ ì±„ë„ì´ ë“±ë¡ë˜ì–´ ìˆì–´ë„ ì‹¤ì œë¡œ I/O ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì±„ë„ë§Œ ë°˜í™˜í•˜ë¯€ë¡œ, ë™ì‹œ ìš”ì²­ ìˆ˜ê°€ EventLoop ìŠ¤ë ˆë“œ ìˆ˜ë³´ë‹¤ ë§ë‹¤ê³  í•´ì„œ ë³‘ëª©ì´ ë°œìƒí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.</p>
<p>ë”°ë¼ì„œ <strong>&quot;ë™ì‹œ ìš”ì²­ 10ê°œ &gt; EventLoop ìŠ¤ë ˆë“œ 4ê°œ&quot;ëŠ” ë³‘ëª©ì˜ ì›ì¸ì´ ì•„ë‹™ë‹ˆë‹¤.</strong></p>
<h3>ë˜ ë‹¤ë¥¸ ê°€ì„¤: Parallel Scheduler ìŠ¤ë ˆë“œ ê²½í•©</h3>
<p>ê·¸ë ‡ë‹¤ë©´ ë¬´ì—‡ì´ ë¬¸ì œì˜€ì„ê¹Œìš”? ë¬¸ì œê°€ ë°œìƒí•œ ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">return</span><span> omsClient.post()
</span><span>   .uri(</span><span style="color:#50a14f">&quot;/refine-address&quot;</span><span>)
</span>   .bodyValue(request)
<!-- -->   .retrieve()
<!-- -->   .bodyToMono(RefineAddressOutput.class)
<span>   .timeout(Duration.ofSeconds(</span><span style="color:#986801">5</span><span>)) </span><span style="color:#a0a1a7;font-style:italic">// â† ì—¬ê¸°</span><span>
</span><span>   .retryWhen(RetryPolicy.fixedDelay(</span><span style="color:#986801">1</span><span>, Duration.ofMillis(</span><span style="color:#986801">100</span><span>), </span><span style="color:#50a14f">&quot;...&quot;</span><span>)) </span><span style="color:#a0a1a7;font-style:italic">// â† ì—¬ê¸°</span><span>
</span><span>   </span><span style="color:#a0a1a7;font-style:italic">// ...</span></code></div></pre>
<p><code node="[object Object]">timeout()</code>ê³¼ <code node="[object Object]">retryWhen()</code>ì˜ fixedDelay()ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ **Schedulers.parallel()**ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì´ë¨¸ë¥¼ ìŠ¤ì¼€ì¤„ë§í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Parallel Schedulerì˜ ìŠ¤ë ˆë“œ ìˆ˜ ì—­ì‹œ CPU ì½”ì–´ ìˆ˜ì— ë¹„ë¡€í•©ë‹ˆë‹¤.</p>
<p>vCPU 2ê°œ í™˜ê²½ì—ì„œ ë™ì‹œ ìš”ì²­ ìˆ˜ê°€ 10ê°œì¸ í™˜ê²½ì—ì„œ í• ë‹¹ëœ Parallel Scheduler ìŠ¤ë ˆë“œ ìˆ˜ë³´ë‹¤ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©´ì„œ ë³‘ëª©ì´ ë°œìƒí–ˆì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.</p>
<h2>ê²€ì¦</h2>
<p>ì‹¤ì œë¡œ CPU ì½”ì–´ ìˆ˜ ì œí•œì´ WebClient ë™ì‹œ í˜¸ì¶œ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì¸¡ì •í•˜ê¸° ìœ„í•´ <code node="[object Object]">JMH(Java Microbenchmark Harness)</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë²¤ì¹˜ë§ˆí¬ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.</p>
<h3>í…ŒìŠ¤íŠ¸ í™˜ê²½</h3>
<p><strong>ê³µí†µ ì„¤ì •</strong></p>
<ul>
<li>ë™ì‹œ í˜¸ì¶œ ìˆ˜ (Concurrency): 10</li>
<li>ì´ ìš”ì²­ ìˆ˜ (totalRequests): 50</li>
<li>ì„œë²„ ì‘ë‹µ ì§€ì—° (serverLatencyMs): 200m</li>
<li>ì¸¡ì • ë°©ì‹: 10íšŒ ë°˜ë³µ ì¸¡ì • í›„ í‰ê· ê°’ ì‚°ì¶œ</li>
</ul>
<h3>Case 1: CPU ì½”ì–´ 10ê°œ (refineAddress_concurrency10_cpu10)</h3>
<ul>
<li>JVM ì˜µì…˜: <code node="[object Object]">-XX:ActiveProcessorCount=10</code></li>
<li>Available Processors: 10</li>
<li>Reactor Schedulers DefaultPoolSize: 10</li>
</ul>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/izmlmaiex478fbxj28hm.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lnz16df329xde31f8r3k.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<h3>Case 2: CPU ì½”ì–´ 2ê°œ (refineAddress_concurrency10_cpu2)</h3>
<ul>
<li>JVM ì˜µì…˜: <code node="[object Object]">-XX:ActiveProcessorCount=2</code></li>
<li>Available Processors: 2</li>
<li>Reactor Schedulers DefaultPoolSize: 2</li>
</ul>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ma6r5otdoiguigptt1y8.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d26n2gg4dthjtbew5m8c.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<h3>ê²°ê³¼</h3>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/640a2hz9kqcccv395blw.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<table><thead><tr><th>ì§€í‘œ</th><th>CPU 10 ì½”ì–´</th><th>CPU 2 ì½”ì–´</th></tr></thead><tbody><tr><td>í‰ê·  ì²˜ë¦¬ ì‹œê°„</td><td>1035.498 ms</td><td>1049.652 ms</td></tr><tr><td>ì•ˆì •ì„± (Stdev)</td><td>7.496</td><td>18.554</td></tr><tr><td>ì‹ ë¢°êµ¬ê°„ í­</td><td>22.667 ms</td><td>56.103 ms</td></tr><tr><td>Reactor ì›Œì»¤ ìˆ˜</td><td>10</td><td>2</td></tr></tbody></table>
<p>ì˜ˆìƒê³¼ ë‹¬ë¦¬, CPU ì½”ì–´ ìˆ˜(Parallel Scheduler Pool Size)ì— ë”°ë¥¸ ì²˜ë¦¬ ì‹œê°„ ì°¨ì´ëŠ” ì•½ 14ms(1.4%) ë¡œ ê±°ì˜ ì—†ì—ˆìŠµë‹ˆë‹¤.</p>
<p>ìŠ¤ë ˆë“œ ìˆ˜ê°€ 2ê°œì—ì„œ 10ê°œë¡œ ì¦ê°€í•´ë„ ì„±ëŠ¥ í–¥ìƒì´ ë¯¸ë¯¸í•©ë‹ˆë‹¤. timeout/retryì˜ ìŠ¤ì¼€ì¤„ë§ ìì²´ëŠ” ë§¤ìš° ê°€ë²¼ìš´ ì‘ì—…ì´ë¯€ë¡œ, ìŠ¤ë ˆë“œ ìˆ˜ê°€ ì ì–´ë„ í° ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p><strong>ë²¤ì¹˜ ë§ˆí¬ ì½”ë“œ</strong></p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">RunBenchmark</span><span class="hljs-class"> </span><span>{
</span>
<span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">main</span><span class="hljs-function hljs-params">(String[] args)</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">throws</span><span class="hljs-function"> RunnerException </span><span>{
</span>
<span>        Options options = </span><span style="color:#a626a4">new</span><span> OptionsBuilder()
</span>            .include(OmsWebClientConcurrencyBenchmark.class.getSimpleName())
<span>            .forks(</span><span style="color:#986801">1</span><span>)
</span><span>            .warmupIterations(</span><span style="color:#986801">10</span><span>) </span><span style="color:#a0a1a7;font-style:italic">// ê° ë²¤ì¹˜ ë§ˆí¬ ì‹¤í–‰ ì „ ìµœì í™”ë¥¼ ìœ„í•œ ì›œì—…</span><span>
</span><span>            .warmupTime(TimeValue.seconds(</span><span style="color:#986801">5</span><span>))
</span><span>            .measurementIterations(</span><span style="color:#986801">10</span><span>) </span><span style="color:#a0a1a7;font-style:italic">// ê° ë²¤ì¹˜ë§ˆí¬ ì¸¡ì •. 10íšŒ ë°˜ë³µ</span><span>
</span><span>            .measurementTime(TimeValue.seconds(</span><span style="color:#986801">5</span><span>))
</span>            .timeUnit(TimeUnit.MILLISECONDS)
<span>            .addProfiler(JavaFlightRecorderProfiler.class)  </span><span style="color:#a0a1a7;font-style:italic">// JFR í”„ë¡œíŒŒì¼ëŸ¬ ì¶”ê°€</span><span>
</span>            .resultFormat(ResultFormatType.JSON)
<span>            .result(</span><span style="color:#50a14f">&quot;jmh-results.json&quot;</span><span>)
</span>            .build();
<!-- -->
<span>        </span><span style="color:#a626a4">new</span><span> Runner(options).run();
</span>    }
<!-- -->}</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@BenchmarkMode(Mode.AverageTime)</span><span>
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">OmsWebClientConcurrencyBenchmark</span><span class="hljs-class"> </span><span>{
</span>
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">final</span><span> </span><span style="color:#a626a4">int</span><span> CONCURRENCY_CALL = </span><span style="color:#986801">10</span><span>;
</span>
<span>    </span><span style="color:#4078f2">@State(Scope.Benchmark)</span><span>
</span><span>    </span><span style="color:#a626a4">public</span><span> </span><span style="color:#a626a4">static</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">BenchState</span><span class="hljs-class"> </span><span>{
</span>
<span>        </span><span style="color:#4078f2">@Param({&quot;50&quot;})</span><span>
</span><span>        </span><span style="color:#a626a4">public</span><span> </span><span style="color:#a626a4">int</span><span> totalRequests; </span><span style="color:#a0a1a7;font-style:italic">// í•œ ë²ˆì˜ ë²¤ì¹˜ë§ˆí¬ í˜¸ì¶œë‹¹ ìš”ì²­ ì´ ê°œìˆ˜</span><span>
</span>
<span>        </span><span style="color:#4078f2">@Param({&quot;200&quot;})</span><span>
</span><span>        </span><span style="color:#a626a4">public</span><span> </span><span style="color:#a626a4">int</span><span> serverLatencyMs; </span><span style="color:#a0a1a7;font-style:italic">// ëª© ì„œë²„ê°€ ì‘ë‹µ ì „ ì¸ìœ„ì ìœ¼ë¡œ ëŒ€ê¸°í•  ì§€ì—°(ms)</span><span>
</span>
<span>        </span><span style="color:#a626a4">private</span><span> DisposableServer server;
</span><span>        </span><span style="color:#a626a4">private</span><span> OmsService omsService;
</span>
<span>        </span><span style="color:#4078f2">@Setup(Level.Trial)</span><span>
</span><span>        </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">setup</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span><span>            </span><span style="color:#a626a4">int</span><span> availableProcessors = Runtime.getRuntime().availableProcessors();
</span><span>            String reactorPoolSize = System.getProperty(</span><span style="color:#50a14f">&quot;reactor.schedulers.defaultPoolSize&quot;</span><span>, String.valueOf(availableProcessors));
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;\n========================================&quot;</span><span>);
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;Benchmark started: OMS WebClient concurrency(10) under different CPU core caps&quot;</span><span>);
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;Params: totalRequests=&quot;</span><span> + totalRequests + </span><span style="color:#50a14f">&quot;, serverLatencyMs=&quot;</span><span> + serverLatencyMs);
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;Available processors (current JVM): &quot;</span><span> + availableProcessors);
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;Reactor Schedulers DefaultPoolSize: &quot;</span><span> + reactorPoolSize);
</span><span>            System.out.println(</span><span style="color:#50a14f">&quot;========================================&quot;</span><span>);
</span>
<span>            </span><span style="color:#a0a1a7;font-style:italic">// ëª© ì‘ë‹µ JSON</span><span>
</span><span>            String json = </span><span style="color:#50a14f">&quot;{&quot;</span><span> +
</span><span>                </span><span style="color:#50a14f">&quot;\&quot;jibeonAddress\&quot;:{\&quot;primaryAddress\&quot;:\&quot;ì„œìš¸ì‹œ ê°•ë‚¨êµ¬\&quot;,\&quot;secondaryAddress\&quot;:\&quot;í…ŒìŠ¤íŠ¸ë¡œ 123\&quot;,\&quot;zipCode\&quot;:\&quot;06200\&quot;},&quot;</span><span> +
</span><span>                </span><span style="color:#50a14f">&quot;\&quot;roadAddress\&quot;:{\&quot;primaryAddress\&quot;:\&quot;ì„œìš¸ì‹œ ê°•ë‚¨êµ¬\&quot;,\&quot;secondaryAddress\&quot;:\&quot;í…ŒìŠ¤íŠ¸ë¡œ 123\&quot;,\&quot;zipCode\&quot;:\&quot;06200\&quot;},&quot;</span><span> +
</span><span>                </span><span style="color:#50a14f">&quot;\&quot;sigungu\&quot;:\&quot;ê°•ë‚¨êµ¬\&quot;,\&quot;dong\&quot;:\&quot;ì—­ì‚¼ë™\&quot;,\&quot;provider\&quot;:\&quot;OMS\&quot;,\&quot;hcode\&quot;:\&quot;11110\&quot;,\&quot;bcode\&quot;:\&quot;1111010100\&quot;,\&quot;buildingNumber\&quot;:\&quot;123\&quot;&quot;</span><span> +
</span><span>                </span><span style="color:#50a14f">&quot;}&quot;</span><span>;
</span>
<span>            </span><span style="color:#a626a4">this</span><span>.server = HttpServer.create()
</span><span>                .host(</span><span style="color:#50a14f">&quot;127.0.0.1&quot;</span><span>)
</span><span>                .port(</span><span style="color:#986801">0</span><span>)
</span><span>                .route(routes -&gt; routes.post(</span><span style="color:#50a14f">&quot;/refine-address&quot;</span><span>, (req, res) -&gt;
</span><span>                    res.header(</span><span style="color:#50a14f">&quot;Content-Type&quot;</span><span>, </span><span style="color:#50a14f">&quot;application/json&quot;</span><span>)
</span>                        .sendString(Mono.delay(Duration.ofMillis(serverLatencyMs))
<!-- -->                            .then(Mono.just(json)))))
<!-- -->                .bindNow();
<!-- -->
<span>            </span><span style="color:#a626a4">int</span><span> port = server.port();
</span><span>            WebClient omsClient = WebClient.builder().baseUrl(</span><span style="color:#50a14f">&quot;http://127.0.0.1:&quot;</span><span> + port).build();
</span><span>            WebClient fbkClient = WebClient.builder().baseUrl(</span><span style="color:#50a14f">&quot;http://127.0.0.1:&quot;</span><span> + port).build();
</span><span>            </span><span style="color:#a626a4">this</span><span>.omsService = </span><span style="color:#a626a4">new</span><span> OmsServiceImpl(omsClient, fbkClient);
</span>        }
<!-- -->
<span>        </span><span style="color:#4078f2">@TearDown(Level.Trial)</span><span>
</span><span>        </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">tearDown</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span><span>            </span><span style="color:#a626a4">if</span><span> (server != </span><span style="color:#a626a4">null</span><span>) {
</span>                server.disposeNow();
<!-- -->            }
<!-- -->        }
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#a626a4">private</span><span> List&lt;ApiResponse&lt;RefineAddressDto&gt;&gt; invokeRefineAddressBatch(OmsService omsService, </span><span style="color:#a626a4">int</span><span> totalRequests) {
</span><span>        </span><span style="color:#a626a4">return</span><span> Flux.range(</span><span style="color:#986801">0</span><span>, totalRequests)
</span><span>            .flatMap(i -&gt; Mono.defer(() -&gt; omsService.refineAddressIgnore(</span><span style="color:#50a14f">&quot;ì„œìš¸ì‹œ ê°•ë‚¨êµ¬&quot;</span><span>, </span><span style="color:#50a14f">&quot;í…ŒìŠ¤íŠ¸ë¡œ 123&quot;</span><span>)
</span><span>                .defaultIfEmpty(ApiResponse.failure(</span><span style="color:#50a14f">&quot;NO_RESPONSE&quot;</span><span>, </span><span style="color:#a626a4">false</span><span>))), CONCURRENCY_CALL)
</span>            .collectList()
<!-- -->            .block();
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// ì½”ì–´ ìˆ˜ 2ë¡œ ì‹¤í–‰</span><span>
</span><span>    </span><span style="color:#4078f2">@Benchmark</span><span>
</span><span>    </span><span style="color:#4078f2">@Fork(value = 1, jvmArgsAppend = {
</span><span style="color:#4078f2">        &quot;-XX:ActiveProcessorCount=2&quot;,
</span><span style="color:#4078f2">        &quot;-XX:FlightRecorderOptions=threadbuffersize=16k,globalbuffersize=10m,memorysize=50m&quot;,
</span><span style="color:#4078f2">        &quot;-XX:StartFlightRecording=settings=profile&quot;
</span><span style="color:#4078f2">    })</span><span>
</span><span>    </span><span style="color:#a626a4">public</span><span> List&lt;ApiResponse&lt;RefineAddressDto&gt;&gt; refineAddress_concurrency10_cpu2(BenchState state, Blackhole blackhole) {
</span><span>        </span><span style="color:#a626a4">var</span><span> result = invokeRefineAddressBatch(state.omsService, state.totalRequests);
</span>        blackhole.consume(result);
<span>        </span><span style="color:#a626a4">return</span><span> result;
</span>    }
<!-- -->
<span>    </span><span style="color:#a0a1a7;font-style:italic">// ì½”ì–´ ìˆ˜ 10ìœ¼ë¡œ ì‹¤í–‰</span><span>
</span><span>    </span><span style="color:#4078f2">@Benchmark</span><span>
</span><span>    </span><span style="color:#4078f2">@Fork(value = 1, jvmArgsAppend = {
</span><span style="color:#4078f2">        &quot;-XX:ActiveProcessorCount=10&quot;,
</span><span style="color:#4078f2">        &quot;-XX:FlightRecorderOptions=threadbuffersize=16k,globalbuffersize=10m,memorysize=50m&quot;,
</span><span style="color:#4078f2">        &quot;-XX:StartFlightRecording=settings=profile&quot;
</span><span style="color:#4078f2">    })</span><span>
</span><span>    </span><span style="color:#a626a4">public</span><span> List&lt;ApiResponse&lt;RefineAddressDto&gt;&gt; refineAddress_concurrency10_cpu10(BenchState state, Blackhole blackhole) {
</span><span>        </span><span style="color:#a626a4">var</span><span> result = invokeRefineAddressBatch(state.omsService, state.totalRequests);
</span>        blackhole.consume(result);
<span>        </span><span style="color:#a626a4">return</span><span> result;
</span>    }
<!-- -->}</code></div></pre>
<h2>ì§€ì—°ì˜ ì›ì¸: Cold Start</h2>
<p>ì›ì¸ì„ ë¶„ì„í•˜ëŠ” ë™ì•ˆ ìœ ì‚¬í•œ ì§€í‘œë¥¼ ê°€ì§„ Traceë¥¼ ì¶”ê°€ë¡œ ìˆ˜ì§‘í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”. ì§€í‘œì—ì„œ í•œ ê°€ì§€ ê³µí†µëœ íŒ¨í„´ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<p>ì§€ì—°ì´ ë°œìƒí•œ ëª¨ë“  ì¼€ì´ìŠ¤ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì§í›„ ì²« ë²ˆì§¸ ì™¸ë¶€ API í˜¸ì¶œ ì‹œì ì— ë°œìƒí•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>
<p>Nettyì˜ ë¦¬ì†ŒìŠ¤ëŠ” <strong>Lazy Initialization</strong> ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ì¦‰, <code node="[object Object]">WebClient</code>ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì´ ì•„ë‹ˆë¼ <strong>ì‹¤ì œë¡œ ì²« ë²ˆì§¸ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‹œì </strong>ì— ì´ˆê¸°í™”ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p>
<h2>Cold Start í•´ê²°ì±…</h2>
<p>ë‘ ê°€ì§€ í•´ê²°ì±…ì„ ê²€í† í–ˆìŠµë‹ˆë‹¤.</p>
<ol>
<li><code node="[object Object]">Connection Poolì— ì‚¬ì „ ì»¤ë„¥ì…˜ ë§ºê¸°</code>: ë¯¸ë¦¬ ì—°ê²°ì„ ìƒì„±í•´ ëŒ€ê¸°</li>
<li><code node="[object Object]">Warmup ì˜µì…˜</code>: ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ì „ ë¡œë“œí•˜ë˜ ì‹¤ì œ ì—°ê²°ì€ í•„ìš” ì‹œì ì— ìƒì„±</li>
</ol>
<h3>Connection Poolì— ì‚¬ì „ ì»¤ë„¥ì…˜ ìƒì„±</h3>
<p>ì²˜ìŒì—ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ì—¬ í’€ì— ëŒ€ê¸°ì‹œí‚¤ëŠ” ë°©ë²•ì„ ê³ ë ¤í•˜ì˜€ìŠµë‹ˆë‹¤. ì»¤ë„¥ì…˜ì€ <code node="[object Object]">maxIdleTime</code>, <code node="[object Object]">maxLifeTime</code> ë§Œí¼ ì‚´ì•„ìˆë‹¤ê°€ ì¢…ë£Œë˜ëŠ”ë°, ê¸°ë³¸ê°’ì€ <code node="[object Object]">-1</code>ë¡œ ë¬´ì œí•œì…ë‹ˆë‹¤. ì¦‰, ë³„ë„ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ì»¤ë„¥ì…˜ì´ ì‹œê°„ ì œí•œ ì—†ì´ í’€ì— ìœ ì§€ë©ë‹ˆë‹¤.</p>
<p>ë‹¨, ë‘ ì„¤ì •ê°’ì„ ê¸°ë³¸ê°’(-1)ìœ¼ë¡œ ë‘ë©´ ì„œë²„ ì¸¡ì˜ <code node="[object Object]">keepAliveTimeout</code> ì„¤ì •ê³¼ ì¶©ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì„œë²„ì—ì„œ ì»¤ë„¥ì…˜ì„ ë¨¼ì € ëŠìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë¯¸ ë‹«íŒ ì»¤ë„¥ì…˜ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ì–´ <code node="[object Object]">&quot;Connection reset by peer&quot;</code> ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‹¤ë¬´ì—ì„œëŠ” <strong>ì„œë²„ì˜ keepAliveTimeoutë³´ë‹¤ ì‘ì€ ê°’ìœ¼ë¡œ maxIdleTimeì„ ì„¤ì •</strong>í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.</p>
<p>ê²°êµ­ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì»¤ë„¥ì…˜ì„ ìƒì„±í•´ ë†“ë”ë¼ë„ ì¼ì • ì‹œê°„ ìš”ì²­ì´ ì—†ìœ¼ë©´ ìœ íœ´ ì»¤ë„¥ì…˜ì´ ìë™ í•´ì œë˜ë¯€ë¡œ íŠ¸ë˜í”½ì´ ê°„í—ì ì¸ &#x27;ì£¼ë¬¸ ë“±ë¡&#x27;ê³¼ ê°™ì€ ì¼€ì´ìŠ¤ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>Netty ì´ìŠˆì—ì„œë„ ConnectionPoolì„ ì›œì—…í•˜ëŠ”ê±´ í•´ê²°ì±…ì´ ì•„ë‹ˆë©° ê³ ë ¤ì‚¬í•­ì´ ì•„ë‹ˆë¼ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (<a href="https://github.com/reactor/reactor-netty/pull/1455">Add warmup functionality for the servers/clients #1455</a>)</p>
</blockquote>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/umgeh6s5sbz9pi13lwf2.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<h3>Warmup ì˜µì…˜</h3>
<p>ë°˜ë©´ warmupì€ ì‹¤ì œ TCP ì»¤ë„¥ì…˜ì„ ë§ºì§€ ì•Šê³ , ì´í›„ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì´ˆê¸°í™” í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì»¤ë„¥ì…˜ì´ í•´ì œë˜ë”ë¼ë„ EventLoop, DNS ë¦¬ì¡¸ë²„ ë“±ì€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì–´, í›„ì† ìš”ì²­ì—ì„œ ì´ˆê¸°í™” ë¹„ìš©ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Configuration</span><span>
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">WebClientConfig</span><span class="hljs-class"> </span><span>{
</span>
<span>   </span><span style="color:#4078f2">@Bean</span><span>
</span><span>   </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> WebClient </span><span class="hljs-function" style="color:#4078f2">omsWebClient</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span>      HttpClient httpClient = HttpClient.create()
<span>         .baseUrl(</span><span style="color:#50a14f">&quot;https://oms-api.example.com&quot;</span><span>);
</span>
<span>       </span><span style="color:#a0a1a7;font-style:italic">// ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ warmup ìˆ˜í–‰</span><span>
</span>       httpClient.warmup().block();
<!-- -->
<span>       </span><span style="color:#a626a4">return</span><span> WebClient.builder()
</span><span>           .clientConnector(</span><span style="color:#a626a4">new</span><span> ReactorClientHttpConnector(httpClient))
</span>           .build();
<!-- -->   }
<!-- -->}</code></div></pre>
<p><strong>Warmupìœ¼ë¡œ ë¯¸ë¦¬ ì¤€ë¹„ë˜ëŠ” ë¦¬ì†ŒìŠ¤</strong></p>
<p>Warmupì„ í˜¸ì¶œí•˜ë©´, HttpClient/TcpClient ë‚´ë¶€ì—ì„œ ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ë“¤ì´ êµ¬ì„±ì— ë”°ë¼ ì‚¬ì „ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p>
<ul>
<li><strong>EventLoopGroup</strong>: EventLoop ìŠ¤ë ˆë“œ í’€ ìƒì„±</li>
<li><strong>DNS Resolver</strong>: ë¹„ë™ê¸° DNS ë¦¬ì¡¸ë²„ ì´ˆê¸°í™”</li>
<li><strong>Native transport ë¼ì´ë¸ŒëŸ¬ë¦¬</strong>: epoll ë“± ë„¤ì´í‹°ë¸Œ ë£¨í”„ ë° ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ</li>
<li><strong>SSL Context</strong>: TLS í•¸ë“œì…°ì´í¬ìš© SSL ì—”ì§„ (HTTPSì¸ ê²½ìš°)</li>
</ul>
<h2>ë§ˆë¬´ë¦¬</h2>
<p>ì§€ê¸ˆê¹Œì§€ WebClientì˜ ê°„í—ì  ì§€ì—° ë¬¸ì œë¥¼ ì¶”ì í•˜ë©° Netty EventLoopê°€ Selectorì™€ TaskQueueë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ì‹, Linux epollì˜ Multiplexing I/O ë©”ì»¤ë‹ˆì¦˜, ê·¸ë¦¬ê³  ì‹¤ì œ ì›ì¸ì´ì—ˆë˜ Nettyì˜ Lazy Initializationê³¼ warmup í•´ê²°ì±…ê¹Œì§€ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.</p>
<p>ì´ ê³¼ì •ì„ í†µí•´ ë‹¨ìˆœíˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë„˜ì–´, ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ ë‹¤ì‹œ í•œë²ˆ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. í‘œë©´ì ì¸ ì¦ìƒë§Œ ë³´ê³  &#x27;ì½”ì–´ ìˆ˜ë¥¼ ëŠë¦¬ì&#x27;ê±°ë‚˜ &#x27;íƒ€ì„ì•„ì›ƒì„ ì¡°ì •í•˜ì&#x27;ëŠ” ì‹ì˜ ì ‘ê·¼ ëŒ€ì‹ , ê° ë ˆì´ì–´ë¥¼ ë‹¨ê³„ë³„ë¡œ íŒŒê³ ë“¤ë©´ì„œ ë³‘ëª©ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§€ì ì„ í•˜ë‚˜ì”© ê°€ì‹œí™”í•˜ê³  ë²”ìœ„ë¥¼ ì¢í˜€ë‚˜ê°ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p></div><section></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"post33","lang":"ko","title":"Netty ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¡œ íŒŒí—¤ì¹œ WebClient ì´ˆê¸° ì§€ì—° ì´ìŠˆ","date":"2025-12-26","section":"tech","tags":"Netty","thumbnail":"https://miro.medium.com/1*KNou9wcBzw1P9IrgfxrJyQ.png","preview":"\në¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ë³´ìœ í•˜ê³  ìˆëŠ” íšŒì‚¬ë“¤ì€ 3PLì´ë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 3PLì´ë€ ë¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ê°–ì¶˜ íšŒì‚¬ê°€ ê·¸ë ‡ì§€ ëª»í•œ íŒë§¤ì²˜ë¡œë¶€í„° ë°°ì†¡ ì—…ë¬´ë¥¼ ìœ„íƒë°›ì•„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤.\n\níŒë§¤ì²˜ëŠ” ë°°ì†¡ì´ í•„ìš”í•œ ì£¼ë¬¸ ëª©ë¡ì„ 3PL ì‹œìŠ¤í…œì— ë“±ë¡í•˜ê²Œ ë˜"},"detail":"\në¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ë³´ìœ í•˜ê³  ìˆëŠ” íšŒì‚¬ë“¤ì€ 3PLì´ë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 3PLì´ë€ ë¬¼ë¥˜ ì¸í”„ë¼ë¥¼ ê°–ì¶˜ íšŒì‚¬ê°€ ê·¸ë ‡ì§€ ëª»í•œ íŒë§¤ì²˜ë¡œë¶€í„° ë°°ì†¡ ì—…ë¬´ë¥¼ ìœ„íƒë°›ì•„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§í•©ë‹ˆë‹¤.\n\níŒë§¤ì²˜ëŠ” ë°°ì†¡ì´ í•„ìš”í•œ ì£¼ë¬¸ ëª©ë¡ì„ 3PL ì‹œìŠ¤í…œì— ë“±ë¡í•˜ê²Œ ë˜ëŠ”ë°, ì´ ê³¼ì •ì—ì„œ ì…ë ¥ëœ ì£¼ë¬¸ì´ ìœ íš¨í•œ ì£¼ë¬¸ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ ì‹œìŠ¤í…œê³¼ ì†Œí†µí•˜ê²Œ ë©ë‹ˆë‹¤.\n\nì™¸ë¶€ API í˜¸ì¶œì„ ìœ„í•œ ë„êµ¬ë¡œëŠ” WebClientë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆëŠ”ë°ìš”. ì•„ë˜ ì§€í‘œì—ì„œ ë³´ë“¯ì´, ì™¸ë¶€ API í˜¸ì¶œê¹Œì§€ì˜ ì§€ì—° ì‹œê°„ì´ ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ì´ ê¸¸ì–´ì§€ëŠ” í˜„ìƒì´ 'ê°„í—ì 'ìœ¼ë¡œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n![APM](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yb2pzcn03325b8pk9z9p.png)\n\nì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” í•´ë‹¹ í˜„ìƒì˜ ì›ì¸ì„ íŒŒì•…í•˜ë©° ì•Œê²Œ ëœ WebClientì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ì™€ Reactor Nettyì˜ ì•„í‚¤í…ì²˜, ê·¸ë¦¬ê³  í•´ê²°ì±…ì„ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.\n\n## ì›ì¸ íŒŒì•…ì„ ìœ„í•œ ê°€ì •\n\nì§€ì—°ì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì€ ìš”ì²­ì´ ì–´ë”˜ê°€ì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬ë˜ì§€ ëª»í•˜ê³  ëŒ€ê¸°í•˜ê³  ìˆì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.\n\nì´ì „ ì‚¬ì§„ì—ì„œ ë¹¨ê°„ ë°•ìŠ¤ë¡œ í‘œì‹œëœ ë©”ì„œë“œëŠ” ê°ì²´ ìƒì„±ê³¼ WebClient í˜¸ì¶œë§Œì„ ë‹´ë‹¹í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. WebClient ë‚´ë¶€ì˜ ì–´ëŠ ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ë³‘ëª©ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ ëª…í™•íˆ ì‹ë³„í•˜ë ¤ë©´ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ì´í•´ê°€ ì„ í–‰ë˜ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ WebClientì˜ ìš”ì²­ ì²˜ë¦¬ ë°©ì‹ê³¼ Reactor Nettyì˜ ì•„í‚¤í…ì²˜ë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.\n\n## WebClient ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜\n\në¨¼ì € ë¬¸ì œê°€ ë°œìƒí•œ ì½”ë“œì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n**OrderRegistrationService.java**\n\n```java\nprivate final static int CONCURRENCY_CALL = 10;\n\nList\u003cRefineResult\u003e results = Flux.fromIterable(registerDtos)\n    .flatMap(dto -\u003e Mono.defer(() -\u003e\n       omsService.refineAddress(dto.getPrimaryAddress(), dto.getSecondaryAddress())\n       .defaultIfEmpty(ApiResponse.failure(\"NO_RESPONSE\", false))\n    ).map(resp -\u003e new RefineResult(dto, resp)), CONCURRENCY_CALL)\n    .collectList()\n    .block();\n```\n\n**OmsService.java**\n\n```java\n@Override\npublic Mono\u003cApiResponse\u003cRefineAddressDto\u003e\u003e refineAddress(String primaryAddress, String secondaryAddress) {\n    RefineAddressInput request = RefineAddressInput.builder()\n        .primaryAddress(primaryAddress)\n        .secondaryAddress(secondaryAddress)\n        .build();\n\n    return omsClient.post()\n        .uri(\"/refine-address\")\n        .bodyValue(request)\n        .retrieve()\n        .bodyToMono(RefineAddressOutput.class)\n        .timeout(Duration.ofSeconds(5))\n        .retryWhen(RetryPolicy.fixedDelay(1, Duration.ofMillis(100), \"[OMS ì£¼ì†Œì •ì œ] ì¬ì‹œë„ ìš”ì²­: \" + request))\n        .map(output -\u003e output.isSuccess() ? ApiResponse.success(RefineAddressDto.from(output))\n            : ApiResponse.\u003cRefineAddressDto\u003efailure(\"ì‘ë‹µ ê²°ê³¼ì— ë°ì´í„°ê°€ ì—†ìŒ\", false))\n        .onErrorResume(ex -\u003e ExternalErrorHandler.handleError(ex, extractOmsErrorMessage(ex), \"OMS ì£¼ì†Œì •ì œ\"));\n}\n```\n\n## Cold Sequenceì™€ êµ¬ë… ì‹œì \n\nìœ„ ì½”ë“œì—ì„œ ì‹¤ì œ HTTP ìš”ì²­ì´ ì–¸ì œ ë°œìƒí•˜ëŠ”ì§€ ì´í•´í•˜ë ¤ë©´ WebClientì˜ Cold Sequence íŠ¹ì„±ì„ ë¨¼ì € ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.\n\nWebClientì˜ ë¦¬ì•¡í‹°ë¸Œ ì²´ì¸ì€ Cold Sequenceë¡œ ë™ì‘í•©ë‹ˆë‹¤. êµ¬ë…ì´ ë°œìƒí•˜ê¸° ì „ê¹Œì§€ëŠ” íŒŒì´í”„ë¼ì¸ë§Œ ì •ì˜ë  ë¿, ì‹¤ì œ ì‹¤í–‰ì€ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. HTTP ìš”ì²­ ë°œì†¡ ì‹œì ì€ `subscribe()`ê°€ í˜¸ì¶œë˜ëŠ” ìˆœê°„ì´ë©°, ì½”ë“œìƒì˜ `block()`ì´ ë‚´ë¶€ì ìœ¼ë¡œ ì´ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\n\n```java\nList\u003cRefineResult\u003e results = Flux.fromIterable(registerDtos)\n    .flatMap(dto -\u003e Mono.defer(() -\u003e ...))\n    .collectList()\n    .block();  // â† êµ¬ë… ì‹œì‘ì \n```\n\n`block()`ì˜ êµ¬ë… ì‹ í˜¸ëŠ” **ì—­ë°©í–¥(upstream)**ìœ¼ë¡œ ì „íŒŒë©ë‹ˆë‹¤\n\n```text\nblock() â†’ collectList() â†’ flatMap() â†’ Mono.defer() â†’ WebClient ì²´ì¸\n```\n\n`flatMap(Function, int concurrency)`ì€ ì¸ìë¡œ ì „ë‹¬ëœ concurrency ìˆ˜ ë§Œí¼ì˜ Monoë¥¼ ë™ì‹œì— êµ¬ë…í•©ë‹ˆë‹¤. `Mono.defer()`ëŠ” ê° êµ¬ë… ì‹œì ë§ˆë‹¤ ë‚´ë¶€ ëŒë‹¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ Monoë¥¼ ìƒì„±í•˜ë¯€ë¡œ, ê° DTOë§ˆë‹¤ ë…ë¦½ì ì¸ HTTP ìš”ì²­ íŒŒì´í”„ë¼ì¸ì´ ìƒì„±ë©ë‹ˆë‹¤.\n\n```java\n// êµ¬ë…ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ WebClient ì²´ì¸ ìƒì„±\nMono.defer(() -\u003e omsService.refineAddress(...))\n```\n\n## TaskQueueë¡œì˜ ì „ë‹¬\n\n`omsService.refineAddress(...)`ê°€ ë°˜í™˜í•˜ëŠ” Monoê°€ êµ¬ë…ë˜ë©´ ìš”ì²­ ì„¤ì •ì„ ë¹Œë“œí•˜ê³ , `.retrieve()` ì´í›„ ì²´ì¸ì´ êµ¬ë…ë˜ë©´ì„œ ì“°ê¸° ìš”ì²­ì´ **TaskQueue**ì— ì €ì¥ë©ë‹ˆë‹¤. \n\n```java\nomsClient.post()\n    .uri(\"/refine-address\")\n    .bodyValue(request)\n    .retrieve()\n    .bodyToMono(RefineAddressOutput.class)\n```\n\nPOST ìš”ì²­ì´ NioEventLoopì˜ TaskQueueì— ì €ì¥ë˜ë©´, WebClientë¥¼ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œì˜ ì—­í• ì€ ì—¬ê¸°ì„œ ëë‚©ë‹ˆë‹¤. ì´í›„ ì‘ì—…ì€ EventLoop ìŠ¤ë ˆë“œê°€ ë‹´ë‹¹í•©ë‹ˆë‹¤.\n\n## Netty EventLoop ìŠ¤ë ˆë“œì˜ ë™ì‘ ì›ë¦¬\n\nWebClientì˜ HTTP ìš”ì²­ì´ TaskQueueì— ì €ì¥ë˜ëŠ” ì´ìœ ëŠ” Nettyì˜ **ì´ë²¤íŠ¸ ë£¨í”„ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ ëª¨ë¸** ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ëª¨ë¸ì„ ì´í•´í•˜ë ¤ë©´ ë¨¼ì € ë„¤íŠ¸ì›Œí¬ í†µì‹ ì˜ ê¸°ë³¸ ê°œë…ì„ ì§šê³  ë„˜ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.\n\n### User Spaceì™€ Kernel Space\n\nì„œë¡œ ë‹¤ë¥¸ ë¨¸ì‹ ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í†µì‹ í•˜ë ¤ë©´ ì‹œìŠ¤í…œ ì½œë¡œ ìœ ì € ëª¨ë“œì™€ ì»¤ë„ ëª¨ë“œë¥¼ ì˜¤ê°€ë©° ì»¤ë„ ë‚´ ì†Œì¼“ ë²„í¼ì— ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì¨ì•¼ í•©ë‹ˆë‹¤.\n\n![Web protocol](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qjtark4qo45ybfnj0lwk.png)\n\nì†Œì¼“ ë²„í¼ì— ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì½ê³  ì“°ëŠëƒì— ë”°ë¼ Blocking I/Oì™€ Non-blocking I/Oë¡œ ë‚˜ë‰©ë‹ˆë‹¤. ë‘˜ì˜ ì°¨ì´ëŠ” ìŠ¤ë ˆë“œê°€ ì‹œìŠ¤í…œ ì½œ í›„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ”ì§€ ì—¬ë¶€ì…ë‹ˆë‹¤.\n\n- `Blocking I/O`: ë°ì´í„°ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ìŠ¤ë ˆë“œê°€ ëŒ€ê¸°\n- `Non-blocking I/O`: ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜, ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥\n\níš¨ìœ¨ì ì¸ Non-blocking I/Oë¥¼ êµ¬í˜„í•˜ë ¤ë©´ íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•´ ë†“ê³  í•´ë‹¹ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œë§Œ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¡œ ì—¬ëŸ¬ ì±„ë„ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### Multiplexing I/Oì™€ Selector\n\nì´ë²¤íŠ¸ ê¸°ë°˜ ì†Œì¼“ í†µì‹ ì—ì„œëŠ” **í•˜ë‚˜ì˜ Selectorê°€ ì—¬ëŸ¬ ì†Œì¼“ ì±„ë„ì˜ ë³€í™”ë¥¼ ê°ì§€**í•˜ë©° ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ `Multiplexing I/O`ë¼ê³  í•©ë‹ˆë‹¤.\n\n![Multiplexing I/O](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7sqinsru5nse3xrks1f3.png)\n\nLinuxì—ì„œ ì´ Multiplexing I/OëŠ” `epoll` ì‹œìŠ¤í…œ ì½œë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. Java NIOì˜ SelectorëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì´ epollì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\n## Selector.select()ì˜ ì‹¤ì œ ë™ì‘\n\nOS ì»¤ë„ì´ ëŠ¥ë™ì ìœ¼ë¡œ I/O ì´ë²¤íŠ¸ë¥¼ Selectorì— ì•Œë ¤ì£¼ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nSelector.select()ê°€ í˜¸ì¶œë˜ë©´ ìœ ì € ëª¨ë“œì—ì„œ ì»¤ë„ ëª¨ë“œë¡œ ì „í™˜ë˜ê³ , ë‚´ë¶€ì ìœ¼ë¡œ `epoll_wait()` ì‹œìŠ¤í…œ ì½œì´ í˜¸ì¶œë˜ë©´ì„œ í˜¸ì¶œ ìŠ¤ë ˆë“œëŠ” ì»¤ë„ì—ì„œ ë¸”ë¡œí‚¹ ìƒíƒœë¡œ ëŒ€ê¸°í•©ë‹ˆë‹¤.\n\n![How Selector work](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rokpi9s20m4thyx0akjp.png)\n\n`epoll_wait`ì„ í˜¸ì¶œí•˜ë©´, OS ì»¤ë„ì€ ì´ì „ì— `epoll_ctl`ë¡œ ë“±ë¡ëœ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°(ì†Œì¼“)ë“¤ì„ ëª¨ë‹ˆí„°ë§í•˜ë‹¤ê°€, ë„¤íŠ¸ì›Œí¬ ì¹´ë“œì— ë°ì´í„°ê°€ ë„ì°©í•˜ê±°ë‚˜ ì†Œì¼“ ë²„í¼ì— ì“°ê¸°ê°€ ê°€ëŠ¥í•´ì§€ëŠ” ë“±ì˜ I/O ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì´ë¥¼ ê°ì§€í•©ë‹ˆë‹¤. I/Oê°€ ë°œìƒí•œ ì†Œì¼“ì€ ì»¤ë„ ë‚´ Ready Queueì— ì¶”ê°€ë˜ê³ , `epoll_wait()`ì´ ë°˜í™˜ë˜ì–´ ëŒ€ê¸° ì¤‘ì´ë˜ ìŠ¤ë ˆë“œê°€ ê¹¨ì–´ë‚©ë‹ˆë‹¤.\n\nì¦‰, User Spaceê°€ ì»¤ë„ì— ìš”ì²­í•˜ê³  ì‹œìŠ¤í…œ ì½œë¡œ ì‘ë‹µë°›ëŠ” pull êµ¬ì¡°ì…ë‹ˆë‹¤.\n\n`select()` ìì²´ëŠ” ë¸”ë¡œí‚¹ í˜¸ì¶œì´ì§€ë§Œ, í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ì—¬ëŸ¬ ì†Œì¼“ì„ ê°ì‹œí•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì†Œì¼“ë“¤ë§Œ ê³¨ë¼ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê° ì†Œì¼“ ì…ì¥ì—ì„œëŠ” ì „ìš© ìŠ¤ë ˆë“œ ì—†ì´ë„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ê²ƒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ì–»ê²Œ ë©ë‹ˆë‹¤.\n\n## NioEventLoopì˜ êµ¬ì¡°\n\nì´ì œ Nettyì˜ EventLoopê°€ Selectorë¥¼ ì–´ë–»ê²Œ í™œìš©í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\nEventLoopì˜ êµ¬í˜„ì²´ì¸ NioEventLoopëŠ” `1 Thread + 1 Selector + 1 TaskQueue`ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.\n\n![NioEventLoop Structure](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/c1xl9zcj1h0pk3eml8sr.png)\n\nEventLoop ìŠ¤ë ˆë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ CPU ì½”ì–´ ìˆ˜ë§Œí¼ ìƒì„±ë©ë‹ˆë‹¤. `Math.max(Runtime.getRuntime().availableProcessors(), 4)`\n\nê° EventLoop ìŠ¤ë ˆë“œëŠ” ì „ìš© NioEventLoop ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©°, ë‹¨ì¼ ìŠ¤ë ˆë“œê°€ ë¬´í•œ ë£¨í”„ë¥¼ ëŒë©´ì„œ ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n\n1. I/O ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë„¤íŠ¸ì›Œí¬ ì½ê¸°/ì“°ê¸°)\n2. TaskQueueì˜ ì‘ì—… ì²˜ë¦¬ (ì‚¬ìš©ìê°€ ë“±ë¡í•œ Runnable)\n\n```java\n// ê°œë…ì ì¸ ì½”ë“œ\nwhile (true) {\n    // 1. ë„¤íŠ¸ì›Œí¬ì—ì„œ ë­”ê°€ ì¼ì–´ë‚¬ëŠ”ì§€ í™•ì¸\n    ë„¤íŠ¸ì›Œí¬_ì´ë²¤íŠ¸_í™•ì¸();\n    // 2. ì¼ì–´ë‚œ ì¼ë“¤ ì²˜ë¦¬\n    ì´ë²¤íŠ¸ë“¤_ì²˜ë¦¬();\n    // 3. ëˆ„ê°€ ì‹œì¼œë†“ì€ ì‘ì—…ë“¤ ì²˜ë¦¬\n    ì‘ì—…íì—ì„œ_ì‘ì—…êº¼ë‚´ì„œ_ì‹¤í–‰();\n}\n```\n\nì‹¤ì œ Netty ì½”ë“œë¥¼ ë³´ë©´ (Netty 4.2 ê¸°ì¤€)\n\n```java\n// SingleThreadIoEventLoop.java:153-164\nprotected void run() {\n    do {\n        runIo();                    // â† 1+2: I/O í™•ì¸ ë° ì²˜ë¦¬\n        runAllTasks(maxTasksPerRun); // â† 3: ì‘ì—…í ì²˜ë¦¬\n    } while (!confirmShutdown());\n}\n```\n \n`runIo()`ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `NioIoHandler.run()`ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.\n\n```java\n// NioIoHandler.java:420-485\npublic int run(IoExecutionContext runner) {\n    // 1ë‹¨ê³„: select - I/O ì´ë²¤íŠ¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸\n    select(runner, wakenUp.getAndSet(false));\n\n    // 2ë‹¨ê³„: ìˆìœ¼ë©´ ì²˜ë¦¬\n    return processSelectedKeys();\n}\n```\n\nì´ì œ ê° ë‹¨ê³„ë¥¼ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n### 1. select() - I/O ì´ë²¤íŠ¸ ê°ì§€\n\nEventLoopëŠ” I/O ì´ë²¤íŠ¸ ì²˜ë¦¬ì™€ TaskQueueì— ìŒ“ì¸ ì‘ì—… ì²˜ë¦¬, ë‘ ê°€ì§€ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì´ë•Œ `Selector.select()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•  I/O ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.\n\n`select()` ë©”ì„œë“œëŠ” TaskQueueì— ì‘ì—…ì´ ì¡´ì¬í•˜ëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ì ì ˆí•œ select ë°©ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤.\n\n```java\n// NioIoHandler.java\nprivate void select(IoExecutionContext runner, boolean oldWakenUp) {\n    Selector selector = this.selector;\n\n    for (;;) {\n        // íƒœìŠ¤í¬ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í™•ì¸í•˜ê³  ë„˜ì–´ê°\n        if (!runner.canBlock() \u0026\u0026 wakenUp.compareAndSet(false, true)) {\n            selector.selectNow();   // ì‘ì—… ìˆìœ¼ë©´ ë°”ë¡œ í™•ì¸\n            break;\n        }\n\n        // íƒœìŠ¤í¬ê°€ ì—†ìœ¼ë©´ ì´ë²¤íŠ¸ ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°\n        int selectedKeys = selector.select(timeoutMillis);\n    }\n}\n```\n\n```java\n@Override\npublic boolean canBlock() {\n   assert inEventLoop();\n   return !hasTasks() \u0026\u0026 !hasScheduledTasks();\n}\n```\n\n#### TaskQueueê°€ ë¹„ì—ˆì„ ë•Œ\n\n`TaskQueue`ê°€ ë¹„ì–´ìˆìœ¼ë©´ NettyëŠ” `select(timeout)`ì„ í˜¸ì¶œí•˜ì—¬ ì»¤ë„ë¡œ ë¶€í„° I/O ì´ë²¤íŠ¸ ì‹ í˜¸ë¥¼ ë°›ê±°ë‚˜ íƒ€ì„ì•„ì›ƒì´ ë  ë•Œê¹Œì§€ ë¸”ë¡œí‚¹ ìƒíƒœë¡œ ëŒ€ê¸°í•˜ì—¬ CPU ì‚¬ìš©ì„ ì¤„ì…ë‹ˆë‹¤.\n\në§Œì•½ ëŒ€ê¸° ì¤‘ `TaskQueue`ì— ìƒˆ taskê°€ ë“¤ì–´ì˜¤ë©´, `wakeup` ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ `select()`ì˜ ë¸”ë¡œí‚¹ì„ ê¹¨ì›Œì„œ ì¦‰ì‹œ ë°˜í™˜ì‹œí‚¤ê³ , ë£¨í”„ë¥¼ ëŒë©° TaskQueueë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.\n\n#### TaskQueueê°€ ìˆì„ ë•Œ\n\n`TaskQueue`ì— ì‘ì—…ì´ ìˆìœ¼ë©´ `selectNow()`ë¥¼ í˜¸ì¶œí•˜ì—¬ I/O ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ ë¹ ë¥´ê²Œ í™•ì¸í•˜ê³ , ê³§ë°”ë¡œ í…ŒìŠ¤í¬ ì‹¤í–‰ìœ¼ë¡œ ë„˜ì–´ê°€ ì‘ì—… ì§€ì—°ì„ ì¤„ì…ë‹ˆë‹¤.\n\në§Œì•½ TaskQueueì— ì‘ì—…ì´ ìˆëŠ” ìƒí™©ì—ì„œ `select(timeout)`ì„ í˜¸ì¶œí•´ ë¸”ë¡œí‚¹ë˜ë©´, EventLoop ìŠ¤ë ˆë“œê°€ ì ë“¤ì–´ í…ŒìŠ¤í¬ ì²˜ë¦¬ê°€ ì§€ì—°ë˜ê³  ì‘ë‹µì„±ì´ ë–¨ì–´ì§€ê²Œ ë©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ `selectNow()`ë§Œ ê³„ì† ìˆ˜í–‰í•˜ë©´ ì¤€ë¹„ëœ I/O ì´ë²¤íŠ¸ê°€ ì—†ì–´ë„ ê³„ì† í™•ì¸í•˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ ë°˜ë³µìœ¼ë¡œ busy-wait(CPU ë‚­ë¹„)ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì¦‰, Nettyì˜ `select()`ëŠ” ìƒí™©ì— ë”°ë¼ ì ì ˆí•œ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ CPUë¥¼ ë‚­ë¹„í•˜ì§€ ì•Šê³  íš¨ìœ¨ì ìœ¼ë¡œ I/O ì´ë²¤íŠ¸ë¥¼ ëŒ€ê¸°í•©ë‹ˆë‹¤.\n\n#### select() í˜¸ì¶œ ì´í›„ì˜ ë‚´ë¶€ ë™ì‘\n\nì•ì„œ Nettyê°€ ìƒí™©ì— ë”°ë¼ `select(timeout)` ë˜ëŠ” `selectNow()`ë¥¼ ì„ íƒì ìœ¼ë¡œ í˜¸ì¶œí•œë‹¤ëŠ” ê²ƒì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ì œ ì´ í˜¸ì¶œì´ ì‹¤ì œë¡œ ì–´ë–¤ ê³¼ì •ì„ ê±°ì³ ì»¤ë„ê¹Œì§€ ë„ë‹¬í•˜ê³ , ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n`Selector.select()`ë¥¼ í˜¸ì¶œí•˜ë©´ JDK ë‚´ë¶€ì˜ `SelectorImpl` í´ë˜ìŠ¤ê°€ ì´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n\n```java\n// SelectorImpl.java\n@Override\n    public final int select(long timeout) throws IOException {\n        return lockAndDoSelect(null, (timeout == 0) ? -1 : timeout);\n    }\n```\n\n`lockAndDoSelect()`ëŠ” ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•œ ë’¤ Multiplexing I/Oë¥¼ ë‹´ë‹¹í•˜ëŠ” `doSelect()`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.\n\n```java\n// SelectorImpl.java\nprivate int lockAndDoSelect(Consumer\u003cSelectionKey\u003e action, long timeout)\n      throws IOException\n{\n    synchronized (this) {\n        ensureOpen();\n        if (inSelect)\n            throw new IllegalStateException(\"select in progress\");\n        inSelect = true;\n        try {\n            synchronized (publicSelectedKeys) {\n                return doSelect(action, timeout);\n            }\n        } finally {\n            inSelect = false;\n        }\n    }\n}\n```\n\nì—¬ê¸°ì„œ `doSelect()`ëŠ” ì¶”ìƒ ë©”ì„œë“œì…ë‹ˆë‹¤. ìš´ì˜ì²´ì œë§ˆë‹¤ íš¨ìœ¨ì ì¸ Multiplexing I/O ë©”ì»¤ë‹ˆì¦˜ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, JDKëŠ” í”Œë«í¼ë³„ë¡œ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\n\n| OS      | êµ¬í˜„ í´ë˜ìŠ¤            | ì‹œìŠ¤í…œ ì½œ      |\n|---------|---------------------|--------------|\n| Linux   | EPollSelectorImpl   | epoll_wait() |\n| macOS   | KQueueSelectorImpl  | kevent()     |\n| Windows | WindowsSelectorImpl | IOCP         |\n\nì´ ê¸€ì—ì„œëŠ” ì„œë²„ í™˜ê²½ì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” **Linuxì˜ epoll ê¸°ë°˜ êµ¬í˜„**ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. (JDK 21 ê¸°ì¤€)\n\n### EPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ëŠ” ì–¸ì œ ìƒì„±ë˜ëŠ”ê°€?\n\nEPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ëŠ” `Selector.open()` í˜¸ì¶œ ì‹œì ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\n\n1. ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ new NioEventLoopGroup(n) í˜¸ì¶œ\n2. ë‚´ë¶€ì ìœ¼ë¡œ nê°œì˜ NioIoHandler ìƒì„±\n3. ê° NioIoHandler ìƒì„±ìì—ì„œ provider.openSelector() í˜¸ì¶œ\n4. Linux í™˜ê²½ì—ì„œëŠ” EPollSelectorImpl ì¸ìŠ¤í„´ìŠ¤ ìƒì„±\n\nEPollSelectorImpl ìƒì„± ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì´ˆê¸°í™”ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n\n```java\nEPollSelectorImpl(SelectorProvider sp) throws IOException {\n   super(sp);\n\n   // 1. epoll ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (epoll_create ì‹œìŠ¤í…œ ì½œ)\n   this.epfd = EPoll.create();\n\n   // 2. epoll_wait ê²°ê³¼ë¥¼ ì €ì¥í•  ë„¤ì´í‹°ë¸Œ ë©”ëª¨ë¦¬ í• ë‹¹\n   this.pollArrayAddress = EPoll.allocatePollArray(NUM_EPOLLEVENTS);\n\n   // 3. wakeupìš© EventFD ìƒì„±\n   this.eventfd = new EventFD();\n   IOUtil.configureBlocking(IOUtil.newFD(eventfd.efd()), false);\n\n   // 4. EventFDë¥¼ epollì— EPOLLINìœ¼ë¡œ ë“±ë¡\n   EPoll.ctl(epfd, EPOLL_CTL_ADD, eventfd.efd(), EPOLLIN);\n}\n```\n\nì¦‰, í•˜ë‚˜ì˜ EventLoopë§ˆë‹¤ í•˜ë‚˜ì˜ epoll ì¸ìŠ¤í„´ìŠ¤ê°€ ë§¤í•‘ë©ë‹ˆë‹¤.\n\n#### epollì˜ ì„¸ ê°€ì§€ ì‹œìŠ¤í…œ ì½œ\n\nepollì€ ì„¸ ê°€ì§€ ì‹œìŠ¤í…œ ì½œì„ ì œê³µí•©ë‹ˆë‹¤\n\n- `epoll_create`: epoll ì¸ìŠ¤í„´ìŠ¤(ì±„ë„ ê°ì‹œ ì €ì¥ì†Œ) ìƒì„±\n- `epoll_ctl`: ê°ì‹œí•  FD ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ\n- `epoll_wait`: ì´ë²¤íŠ¸(read/write)ê°€ ë°œìƒí•  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê³ , ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ FD ëª©ë¡ì„ ë°˜í™˜\n\nJDKì˜ `EPoll.wait()`ëŠ” JNIë¥¼ í†µí•´ ì»¤ë„ì˜ `epoll_wait()` ì‹œìŠ¤í…œ ì½œì„ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.\n\n`epoll_wait()`ëŠ” ë¯¸ë¦¬ í• ë‹¹ëœ ë„¤ì´í‹°ë¸Œ ë©”ëª¨ë¦¬ì˜ `epoll_event` êµ¬ì¡°ì²´ ë°°ì—´ì— ì¤€ë¹„ëœ ì´ë²¤íŠ¸ ì •ë³´ë¥¼ ì±„ìš°ê³ , ì¤€ë¹„ëœ ì´ë²¤íŠ¸ ê°œìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ ë°°ì—´ì—ëŠ” ê° FDì™€ ë°œìƒí•œ  ì´ë²¤íŠ¸ íƒ€ì…(EPOLLIN/EPOLLOUT/EPOLLERR ë“±)ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.\n\nEPollSelectorImpl.doSelect()ì—ì„œ ì´ ë©”ì„œë“œë“¤ì´ ì‹¤ì œë¡œ í˜¸ì¶œë˜ëŠ” íë¦„ì„ ë³´ë©´:\n\n```java\n// EpollSelectorImpl.java\n@Override\nprotected int doSelect(Consumer\u003cSelectionKey\u003e action, long timeout) throws IOException {\n    int to = (int) Math.min(timeout, Integer.MAX_VALUE);\n\n    int numEntries;\n    processUpdateQueue();      // epoll_ctlë¡œ ê´€ì‹¬ ì´ë²¤íŠ¸ ë³€ê²½ ë°˜ì˜\n    processDeregisterQueue();\n\n    try {\n        begin(blocking);\n        // epoll_wait ì‹œìŠ¤í…œ ì½œ í˜¸ì¶œ\n        numEntries = EPoll.wait(epfd, pollArrayAddress, NUM_EPOLLEVENTS, to);\n    } finally {\n        end(blocking);\n    }\n\n    // ë°˜í™˜ëœ ì´ë²¤íŠ¸ ì²˜ë¦¬\n    return processEvents(numEntries, action);\n}\n```\n\n### 2. processSelectedKeys() - I/O ì´ë²¤íŠ¸ ì²˜ë¦¬\n\n`EPoll.wait()`ê°€ ì´ë²¤íŠ¸ ê°œìˆ˜ë¥¼ ë°˜í™˜í•˜ë©´, `EPollSelectorImpl.processEvents()`ê°€ í•´ë‹¹ ê°œìˆ˜ë§Œí¼ ì´ë²¤íŠ¸ ë°°ì—´ì„ ìˆœíšŒí•˜ë©° ê° FDì— ì—°ê²°ëœ SelectionKeyë¥¼ ì°¾ì•„ selectedKeysì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´í›„ Nettyì˜ `NioIoHandler.processSelectedKeys()`ê°€ `seletedKeys`ë¥¼ ìˆœíšŒí•˜ë©° ê° ì±„ë„ì˜ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n\n```java\n // NioIoHandler.java\n  private int processSelectedKeysOptimized() {\n      int handled = 0;\n      for (int i = 0; i \u003c selectedKeys.size; ++i) {\n          SelectionKey k = selectedKeys.keys[i];\n          selectedKeys.keys[i] = null;  // GCë¥¼ ìœ„í•´ null ì²˜ë¦¬\n\n          processSelectedKey(k);  // ê° ì´ë²¤íŠ¸ ì²˜ë¦¬\n          ++handled;\n      }\n      return handled;\n  }\n```\n\n```java\n  private void processSelectedKey(SelectionKey k) {\n      final DefaultNioRegistration registration = (DefaultNioRegistration) k.attachment();\n\n      // ì¤€ë¹„ëœ ì´ë²¤íŠ¸ë¥¼ í•¸ë“¤ëŸ¬ì— ì „ë‹¬\n      // OP_READ  â†’ ë°ì´í„° ìˆ˜ì‹ \n      // OP_WRITE â†’ ë°ì´í„° ì†¡ì‹ \n      // OP_CONNECT â†’ ì—°ê²° ì™„ë£Œ\n      // OP_ACCEPT â†’ ìƒˆ ì—°ê²° ìš”ì²­\n      registration.handle(k.readyOps());\n  }\n```\n\n`registration.handle()`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `AbstractNioChannel.AbstractNioUnsafe.handle()`ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ ë©”ì„œë“œëŠ” ì´ë²¤íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n\n```java\n// AbstractNioChannel.java:420-450\n@Override\npublic void handle(IoRegistration registration, IoEvent event) {\n    NioIoOps nioReadyOps = ((NioIoEvent) event).ops();\n\n    // 1. OP_CONNECT: ì—°ê²° ì™„ë£Œ ì²˜ë¦¬ (ê°€ì¥ ë¨¼ì € ì²˜ë¦¬)\n    if (nioReadyOps.contains(NioIoOps.CONNECT)) {\n        removeAndSubmit(NioIoOps.CONNECT);\n        unsafe().finishConnect();\n    }\n\n    // 2. OP_WRITE: ì“°ê¸° ê°€ëŠ¥ ìƒíƒœ - ëŒ€ê¸° ì¤‘ì¸ ë²„í¼ ì „ì†¡\n    if (nioReadyOps.contains(NioIoOps.WRITE)) {\n        forceFlush();\n    }\n\n    // 3. OP_READ / OP_ACCEPT: ë°ì´í„° ìˆ˜ì‹  ë˜ëŠ” ìƒˆ ì—°ê²° ìˆ˜ë½\n    if (nioReadyOps.contains(NioIoOps.READ_AND_ACCEPT) || nioReadyOps.equals(NioIoOps.NONE)) {\n        read();\n    }\n}\n```\n\n### 3. runAllTasks() - Non-I/O Task ì²˜ë¦¬\n\nI/O ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ëë‚˜ë©´ runAllTasks()ê°€ í˜¸ì¶œë˜ì–´ TaskQueueì— ìŒ“ì¸ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. WebClientì˜ HTTP ìš”ì²­ë„ ë°”ë¡œ ì´ ë‹¨ê³„ì—ì„œ ì‹¤ì œë¡œ ì „ì†¡ë©ë‹ˆë‹¤.\n\n```java\n// SingleThreadEventExecutor.java\nprotected boolean runAllTasks(long timeoutNanos) {\n     // ìŠ¤ì¼€ì¤„ íì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ íƒœìŠ¤í¬ë¥¼ TaskQueueë¡œ ì´ë™\n     fetchFromScheduledTaskQueue();\n     Runnable task = pollTask();\n\n     final long deadline = timeoutNanos \u003e 0 ? getCurrentTimeNanos() + timeoutNanos : 0;\n     long runTasks = 0;\n\n     for (;;) {\n         safeExecute(task); // í…ŒìŠ¤í¬ ì‹¤í–‰\n\n         runTasks ++;\n\n         task = pollTask();\n         if (task == null) {\n             lastExecutionTime = getCurrentTimeNanos();\n             break;\n          }\n      }\n\n     afterRunningAllTasks();\n     return true;\n}\n```\n\n### ì „ì²´ íë¦„ ìš”ì•½\n\nì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ë‚´ìš©ì„ í•˜ë‚˜ì˜ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\n\n![overall](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s5f9g86wsuwo500ky37d.png)\n\në³‘ëª©ì´ ë°œìƒí•œ ì¸ìŠ¤í„´ìŠ¤ì˜ vCPU ìˆ˜ëŠ” 2ê°œì˜€ìŠµë‹ˆë‹¤. Nettyì˜ EventLoop ìŠ¤ë ˆë“œ ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `Math.max(availableProcessors(), 4)`ë¡œ ê²°ì •ë˜ë¯€ë¡œ, ì´ í™˜ê²½ì—ì„œëŠ” EventLoop ìŠ¤ë ˆë“œê°€ **ì´ 4ê°œ** ì¡´ì¬í•©ë‹ˆë‹¤.\n\nì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ë°”ì™€ ê°™ì´ Nettyì˜ EventLoopëŠ” Multiplexing I/O ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì ì€ ìˆ˜ì˜ ìŠ¤ë ˆë“œë¡œë„ ë§ì€ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `epoll_wait()`ì€ ìˆ˜ì²œ ê°œì˜ ì±„ë„ì´ ë“±ë¡ë˜ì–´ ìˆì–´ë„ ì‹¤ì œë¡œ I/O ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì±„ë„ë§Œ ë°˜í™˜í•˜ë¯€ë¡œ, ë™ì‹œ ìš”ì²­ ìˆ˜ê°€ EventLoop ìŠ¤ë ˆë“œ ìˆ˜ë³´ë‹¤ ë§ë‹¤ê³  í•´ì„œ ë³‘ëª©ì´ ë°œìƒí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.\n\në”°ë¼ì„œ **\"ë™ì‹œ ìš”ì²­ 10ê°œ \u003e EventLoop ìŠ¤ë ˆë“œ 4ê°œ\"ëŠ” ë³‘ëª©ì˜ ì›ì¸ì´ ì•„ë‹™ë‹ˆë‹¤.**\n\n### ë˜ ë‹¤ë¥¸ ê°€ì„¤: Parallel Scheduler ìŠ¤ë ˆë“œ ê²½í•©\n\nê·¸ë ‡ë‹¤ë©´ ë¬´ì—‡ì´ ë¬¸ì œì˜€ì„ê¹Œìš”? ë¬¸ì œê°€ ë°œìƒí•œ ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n```java\nreturn omsClient.post()\n   .uri(\"/refine-address\")\n   .bodyValue(request)\n   .retrieve()\n   .bodyToMono(RefineAddressOutput.class)\n   .timeout(Duration.ofSeconds(5)) // â† ì—¬ê¸°\n   .retryWhen(RetryPolicy.fixedDelay(1, Duration.ofMillis(100), \"...\")) // â† ì—¬ê¸°\n   // ...\n```\n\n`timeout()`ê³¼ `retryWhen()`ì˜ fixedDelay()ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ **Schedulers.parallel()**ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì´ë¨¸ë¥¼ ìŠ¤ì¼€ì¤„ë§í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  Parallel Schedulerì˜ ìŠ¤ë ˆë“œ ìˆ˜ ì—­ì‹œ CPU ì½”ì–´ ìˆ˜ì— ë¹„ë¡€í•©ë‹ˆë‹¤.\n\nvCPU 2ê°œ í™˜ê²½ì—ì„œ ë™ì‹œ ìš”ì²­ ìˆ˜ê°€ 10ê°œì¸ í™˜ê²½ì—ì„œ í• ë‹¹ëœ Parallel Scheduler ìŠ¤ë ˆë“œ ìˆ˜ë³´ë‹¤ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©´ì„œ ë³‘ëª©ì´ ë°œìƒí–ˆì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.\n\n## ê²€ì¦\n\nì‹¤ì œë¡œ CPU ì½”ì–´ ìˆ˜ ì œí•œì´ WebClient ë™ì‹œ í˜¸ì¶œ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì¸¡ì •í•˜ê¸° ìœ„í•´ `JMH(Java Microbenchmark Harness)`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë²¤ì¹˜ë§ˆí¬ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.\n\n### í…ŒìŠ¤íŠ¸ í™˜ê²½\n\n**ê³µí†µ ì„¤ì •**\n\n- ë™ì‹œ í˜¸ì¶œ ìˆ˜ (Concurrency): 10\n- ì´ ìš”ì²­ ìˆ˜ (totalRequests): 50\n- ì„œë²„ ì‘ë‹µ ì§€ì—° (serverLatencyMs): 200m\n- ì¸¡ì • ë°©ì‹: 10íšŒ ë°˜ë³µ ì¸¡ì • í›„ í‰ê· ê°’ ì‚°ì¶œ\n\n### Case 1: CPU ì½”ì–´ 10ê°œ (refineAddress_concurrency10_cpu10)\n\n- JVM ì˜µì…˜: `-XX:ActiveProcessorCount=10`\n- Available Processors: 10\n- Reactor Schedulers DefaultPoolSize: 10\n\n![Benchmark result1](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/izmlmaiex478fbxj28hm.png)\n\n![Benchmark result2](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lnz16df329xde31f8r3k.png)\n\n### Case 2: CPU ì½”ì–´ 2ê°œ (refineAddress_concurrency10_cpu2)\n\n- JVM ì˜µì…˜: `-XX:ActiveProcessorCount=2`\n- Available Processors: 2\n- Reactor Schedulers DefaultPoolSize: 2\n\n![Benchmark result3](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ma6r5otdoiguigptt1y8.png)\n\n![Benchmark result4](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d26n2gg4dthjtbew5m8c.png)\n\n### ê²°ê³¼\n\n![JMH Benchmark result](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/640a2hz9kqcccv395blw.png)\n\n| ì§€í‘œ    | CPU 10 ì½”ì–´            | CPU 2 ì½”ì–´      |\n|---------|---------------------|--------------|\n| í‰ê·  ì²˜ë¦¬ ì‹œê°„   | 1035.498 ms   | 1049.652 ms |\n| ì•ˆì •ì„± (Stdev)   | 7.496  | 18.554  |\n| ì‹ ë¢°êµ¬ê°„ í­ | 22.667 ms | 56.103 ms         |\n| Reactor ì›Œì»¤ ìˆ˜   | 10  |  2  |\n\nì˜ˆìƒê³¼ ë‹¬ë¦¬, CPU ì½”ì–´ ìˆ˜(Parallel Scheduler Pool Size)ì— ë”°ë¥¸ ì²˜ë¦¬ ì‹œê°„ ì°¨ì´ëŠ” ì•½ 14ms(1.4%) ë¡œ ê±°ì˜ ì—†ì—ˆìŠµë‹ˆë‹¤.\n\nìŠ¤ë ˆë“œ ìˆ˜ê°€ 2ê°œì—ì„œ 10ê°œë¡œ ì¦ê°€í•´ë„ ì„±ëŠ¥ í–¥ìƒì´ ë¯¸ë¯¸í•©ë‹ˆë‹¤. timeout/retryì˜ ìŠ¤ì¼€ì¤„ë§ ìì²´ëŠ” ë§¤ìš° ê°€ë²¼ìš´ ì‘ì—…ì´ë¯€ë¡œ, ìŠ¤ë ˆë“œ ìˆ˜ê°€ ì ì–´ë„ í° ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n**ë²¤ì¹˜ ë§ˆí¬ ì½”ë“œ**\n\n```java\npublic class RunBenchmark {\n\n    public static void main(String[] args) throws RunnerException {\n\n        Options options = new OptionsBuilder()\n            .include(OmsWebClientConcurrencyBenchmark.class.getSimpleName())\n            .forks(1)\n            .warmupIterations(10) // ê° ë²¤ì¹˜ ë§ˆí¬ ì‹¤í–‰ ì „ ìµœì í™”ë¥¼ ìœ„í•œ ì›œì—…\n            .warmupTime(TimeValue.seconds(5))\n            .measurementIterations(10) // ê° ë²¤ì¹˜ë§ˆí¬ ì¸¡ì •. 10íšŒ ë°˜ë³µ\n            .measurementTime(TimeValue.seconds(5))\n            .timeUnit(TimeUnit.MILLISECONDS)\n            .addProfiler(JavaFlightRecorderProfiler.class)  // JFR í”„ë¡œíŒŒì¼ëŸ¬ ì¶”ê°€\n            .resultFormat(ResultFormatType.JSON)\n            .result(\"jmh-results.json\")\n            .build();\n\n        new Runner(options).run();\n    }\n}\n```\n\n```java\n@BenchmarkMode(Mode.AverageTime)\npublic class OmsWebClientConcurrencyBenchmark {\n\n    private static final int CONCURRENCY_CALL = 10;\n\n    @State(Scope.Benchmark)\n    public static class BenchState {\n\n        @Param({\"50\"})\n        public int totalRequests; // í•œ ë²ˆì˜ ë²¤ì¹˜ë§ˆí¬ í˜¸ì¶œë‹¹ ìš”ì²­ ì´ ê°œìˆ˜\n\n        @Param({\"200\"})\n        public int serverLatencyMs; // ëª© ì„œë²„ê°€ ì‘ë‹µ ì „ ì¸ìœ„ì ìœ¼ë¡œ ëŒ€ê¸°í•  ì§€ì—°(ms)\n\n        private DisposableServer server;\n        private OmsService omsService;\n\n        @Setup(Level.Trial)\n        public void setup() {\n            int availableProcessors = Runtime.getRuntime().availableProcessors();\n            String reactorPoolSize = System.getProperty(\"reactor.schedulers.defaultPoolSize\", String.valueOf(availableProcessors));\n            System.out.println(\"\\n========================================\");\n            System.out.println(\"Benchmark started: OMS WebClient concurrency(10) under different CPU core caps\");\n            System.out.println(\"Params: totalRequests=\" + totalRequests + \", serverLatencyMs=\" + serverLatencyMs);\n            System.out.println(\"Available processors (current JVM): \" + availableProcessors);\n            System.out.println(\"Reactor Schedulers DefaultPoolSize: \" + reactorPoolSize);\n            System.out.println(\"========================================\");\n\n            // ëª© ì‘ë‹µ JSON\n            String json = \"{\" +\n                \"\\\"jibeonAddress\\\":{\\\"primaryAddress\\\":\\\"ì„œìš¸ì‹œ ê°•ë‚¨êµ¬\\\",\\\"secondaryAddress\\\":\\\"í…ŒìŠ¤íŠ¸ë¡œ 123\\\",\\\"zipCode\\\":\\\"06200\\\"},\" +\n                \"\\\"roadAddress\\\":{\\\"primaryAddress\\\":\\\"ì„œìš¸ì‹œ ê°•ë‚¨êµ¬\\\",\\\"secondaryAddress\\\":\\\"í…ŒìŠ¤íŠ¸ë¡œ 123\\\",\\\"zipCode\\\":\\\"06200\\\"},\" +\n                \"\\\"sigungu\\\":\\\"ê°•ë‚¨êµ¬\\\",\\\"dong\\\":\\\"ì—­ì‚¼ë™\\\",\\\"provider\\\":\\\"OMS\\\",\\\"hcode\\\":\\\"11110\\\",\\\"bcode\\\":\\\"1111010100\\\",\\\"buildingNumber\\\":\\\"123\\\"\" +\n                \"}\";\n\n            this.server = HttpServer.create()\n                .host(\"127.0.0.1\")\n                .port(0)\n                .route(routes -\u003e routes.post(\"/refine-address\", (req, res) -\u003e\n                    res.header(\"Content-Type\", \"application/json\")\n                        .sendString(Mono.delay(Duration.ofMillis(serverLatencyMs))\n                            .then(Mono.just(json)))))\n                .bindNow();\n\n            int port = server.port();\n            WebClient omsClient = WebClient.builder().baseUrl(\"http://127.0.0.1:\" + port).build();\n            WebClient fbkClient = WebClient.builder().baseUrl(\"http://127.0.0.1:\" + port).build();\n            this.omsService = new OmsServiceImpl(omsClient, fbkClient);\n        }\n\n        @TearDown(Level.Trial)\n        public void tearDown() {\n            if (server != null) {\n                server.disposeNow();\n            }\n        }\n    }\n\n    private List\u003cApiResponse\u003cRefineAddressDto\u003e\u003e invokeRefineAddressBatch(OmsService omsService, int totalRequests) {\n        return Flux.range(0, totalRequests)\n            .flatMap(i -\u003e Mono.defer(() -\u003e omsService.refineAddressIgnore(\"ì„œìš¸ì‹œ ê°•ë‚¨êµ¬\", \"í…ŒìŠ¤íŠ¸ë¡œ 123\")\n                .defaultIfEmpty(ApiResponse.failure(\"NO_RESPONSE\", false))), CONCURRENCY_CALL)\n            .collectList()\n            .block();\n    }\n\n    // ì½”ì–´ ìˆ˜ 2ë¡œ ì‹¤í–‰\n    @Benchmark\n    @Fork(value = 1, jvmArgsAppend = {\n        \"-XX:ActiveProcessorCount=2\",\n        \"-XX:FlightRecorderOptions=threadbuffersize=16k,globalbuffersize=10m,memorysize=50m\",\n        \"-XX:StartFlightRecording=settings=profile\"\n    })\n    public List\u003cApiResponse\u003cRefineAddressDto\u003e\u003e refineAddress_concurrency10_cpu2(BenchState state, Blackhole blackhole) {\n        var result = invokeRefineAddressBatch(state.omsService, state.totalRequests);\n        blackhole.consume(result);\n        return result;\n    }\n\n    // ì½”ì–´ ìˆ˜ 10ìœ¼ë¡œ ì‹¤í–‰\n    @Benchmark\n    @Fork(value = 1, jvmArgsAppend = {\n        \"-XX:ActiveProcessorCount=10\",\n        \"-XX:FlightRecorderOptions=threadbuffersize=16k,globalbuffersize=10m,memorysize=50m\",\n        \"-XX:StartFlightRecording=settings=profile\"\n    })\n    public List\u003cApiResponse\u003cRefineAddressDto\u003e\u003e refineAddress_concurrency10_cpu10(BenchState state, Blackhole blackhole) {\n        var result = invokeRefineAddressBatch(state.omsService, state.totalRequests);\n        blackhole.consume(result);\n        return result;\n    }\n}\n```\n\n## ì§€ì—°ì˜ ì›ì¸: Cold Start\n\nì›ì¸ì„ ë¶„ì„í•˜ëŠ” ë™ì•ˆ ìœ ì‚¬í•œ ì§€í‘œë¥¼ ê°€ì§„ Traceë¥¼ ì¶”ê°€ë¡œ ìˆ˜ì§‘í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”. ì§€í‘œì—ì„œ í•œ ê°€ì§€ ê³µí†µëœ íŒ¨í„´ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\nì§€ì—°ì´ ë°œìƒí•œ ëª¨ë“  ì¼€ì´ìŠ¤ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì§í›„ ì²« ë²ˆì§¸ ì™¸ë¶€ API í˜¸ì¶œ ì‹œì ì— ë°œìƒí•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.\n\nNettyì˜ ë¦¬ì†ŒìŠ¤ëŠ” **Lazy Initialization** ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ì¦‰, `WebClient`ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì´ ì•„ë‹ˆë¼ **ì‹¤ì œë¡œ ì²« ë²ˆì§¸ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‹œì **ì— ì´ˆê¸°í™”ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n\n## Cold Start í•´ê²°ì±…\n\në‘ ê°€ì§€ í•´ê²°ì±…ì„ ê²€í† í–ˆìŠµë‹ˆë‹¤.\n\n1. `Connection Poolì— ì‚¬ì „ ì»¤ë„¥ì…˜ ë§ºê¸°`: ë¯¸ë¦¬ ì—°ê²°ì„ ìƒì„±í•´ ëŒ€ê¸°\n2. `Warmup ì˜µì…˜`: ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ì „ ë¡œë“œí•˜ë˜ ì‹¤ì œ ì—°ê²°ì€ í•„ìš” ì‹œì ì— ìƒì„±\n\n### Connection Poolì— ì‚¬ì „ ì»¤ë„¥ì…˜ ìƒì„±\n\nì²˜ìŒì—ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ì—¬ í’€ì— ëŒ€ê¸°ì‹œí‚¤ëŠ” ë°©ë²•ì„ ê³ ë ¤í•˜ì˜€ìŠµë‹ˆë‹¤. ì»¤ë„¥ì…˜ì€ `maxIdleTime`, `maxLifeTime` ë§Œí¼ ì‚´ì•„ìˆë‹¤ê°€ ì¢…ë£Œë˜ëŠ”ë°, ê¸°ë³¸ê°’ì€ `-1`ë¡œ ë¬´ì œí•œì…ë‹ˆë‹¤. ì¦‰, ë³„ë„ë¡œ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ì»¤ë„¥ì…˜ì´ ì‹œê°„ ì œí•œ ì—†ì´ í’€ì— ìœ ì§€ë©ë‹ˆë‹¤.\n\në‹¨, ë‘ ì„¤ì •ê°’ì„ ê¸°ë³¸ê°’(-1)ìœ¼ë¡œ ë‘ë©´ ì„œë²„ ì¸¡ì˜ `keepAliveTimeout` ì„¤ì •ê³¼ ì¶©ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. \n\nì„œë²„ì—ì„œ ì»¤ë„¥ì…˜ì„ ë¨¼ì € ëŠìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë¯¸ ë‹«íŒ ì»¤ë„¥ì…˜ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ì–´ `\"Connection reset by peer\"` ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‹¤ë¬´ì—ì„œëŠ” **ì„œë²„ì˜ keepAliveTimeoutë³´ë‹¤ ì‘ì€ ê°’ìœ¼ë¡œ maxIdleTimeì„ ì„¤ì •**í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.\n\n\nê²°êµ­ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì»¤ë„¥ì…˜ì„ ìƒì„±í•´ ë†“ë”ë¼ë„ ì¼ì • ì‹œê°„ ìš”ì²­ì´ ì—†ìœ¼ë©´ ìœ íœ´ ì»¤ë„¥ì…˜ì´ ìë™ í•´ì œë˜ë¯€ë¡œ íŠ¸ë˜í”½ì´ ê°„í—ì ì¸ 'ì£¼ë¬¸ ë“±ë¡'ê³¼ ê°™ì€ ì¼€ì´ìŠ¤ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n\u003e Netty ì´ìŠˆì—ì„œë„ ConnectionPoolì„ ì›œì—…í•˜ëŠ”ê±´ í•´ê²°ì±…ì´ ì•„ë‹ˆë©° ê³ ë ¤ì‚¬í•­ì´ ì•„ë‹ˆë¼ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ([Add warmup functionality for the servers/clients #1455](https://github.com/reactor/reactor-netty/pull/1455))\n\n![Connection warmup](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/umgeh6s5sbz9pi13lwf2.png)\n\n### Warmup ì˜µì…˜\n\në°˜ë©´ warmupì€ ì‹¤ì œ TCP ì»¤ë„¥ì…˜ì„ ë§ºì§€ ì•Šê³ , ì´í›„ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ë¯¸ë¦¬ ì´ˆê¸°í™” í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì»¤ë„¥ì…˜ì´ í•´ì œë˜ë”ë¼ë„ EventLoop, DNS ë¦¬ì¡¸ë²„ ë“±ì€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì–´, í›„ì† ìš”ì²­ì—ì„œ ì´ˆê¸°í™” ë¹„ìš©ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n```java\n@Configuration\npublic class WebClientConfig {\n\n   @Bean\n   public WebClient omsWebClient() {\n      HttpClient httpClient = HttpClient.create()\n         .baseUrl(\"https://oms-api.example.com\");\n\n       // ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ warmup ìˆ˜í–‰\n       httpClient.warmup().block();\n\n       return WebClient.builder()\n           .clientConnector(new ReactorClientHttpConnector(httpClient))\n           .build();\n   }\n}\n```\n\n**Warmupìœ¼ë¡œ ë¯¸ë¦¬ ì¤€ë¹„ë˜ëŠ” ë¦¬ì†ŒìŠ¤**\n\nWarmupì„ í˜¸ì¶œí•˜ë©´, HttpClient/TcpClient ë‚´ë¶€ì—ì„œ ë‹¤ìŒ ë¦¬ì†ŒìŠ¤ë“¤ì´ êµ¬ì„±ì— ë”°ë¼ ì‚¬ì „ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\n\n- **EventLoopGroup**: EventLoop ìŠ¤ë ˆë“œ í’€ ìƒì„±\n- **DNS Resolver**: ë¹„ë™ê¸° DNS ë¦¬ì¡¸ë²„ ì´ˆê¸°í™”\n- **Native transport ë¼ì´ë¸ŒëŸ¬ë¦¬**: epoll ë“± ë„¤ì´í‹°ë¸Œ ë£¨í”„ ë° ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ\n- **SSL Context**: TLS í•¸ë“œì…°ì´í¬ìš© SSL ì—”ì§„ (HTTPSì¸ ê²½ìš°)\n\n## ë§ˆë¬´ë¦¬\n\nì§€ê¸ˆê¹Œì§€ WebClientì˜ ê°„í—ì  ì§€ì—° ë¬¸ì œë¥¼ ì¶”ì í•˜ë©° Netty EventLoopê°€ Selectorì™€ TaskQueueë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ì‹, Linux epollì˜ Multiplexing I/O ë©”ì»¤ë‹ˆì¦˜, ê·¸ë¦¬ê³  ì‹¤ì œ ì›ì¸ì´ì—ˆë˜ Nettyì˜ Lazy Initializationê³¼ warmup í•´ê²°ì±…ê¹Œì§€ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.\n\nì´ ê³¼ì •ì„ í†µí•´ ë‹¨ìˆœíˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë„˜ì–´, ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œì§€ ë‹¤ì‹œ í•œë²ˆ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. í‘œë©´ì ì¸ ì¦ìƒë§Œ ë³´ê³  'ì½”ì–´ ìˆ˜ë¥¼ ëŠë¦¬ì'ê±°ë‚˜ 'íƒ€ì„ì•„ì›ƒì„ ì¡°ì •í•˜ì'ëŠ” ì‹ì˜ ì ‘ê·¼ ëŒ€ì‹ , ê° ë ˆì´ì–´ë¥¼ ë‹¨ê³„ë³„ë¡œ íŒŒê³ ë“¤ë©´ì„œ ë³‘ëª©ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì§€ì ì„ í•˜ë‚˜ì”© ê°€ì‹œí™”í•˜ê³  ë²”ìœ„ë¥¼ ì¢í˜€ë‚˜ê°ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n","lang":"ko","allPostsInOtherLang":[{"id":"post9","lang":"en","title":"Solving the Billion-Dollar Mistake: Modern Java Null Safety with JSpecify and NullAway","date":"2025-09-24","section":"tech","tags":"Null Safety","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ftotx4mdagz9nsegld5mr.png","description":"Learn how to eliminate NullPointerExceptions using JSpecify annotations and NullAway static analysis in modern Java applications","searchKeywords":"JSpecify, NullAway, Java null safety, NullPointerException prevention, static analysis","translationSlug":"post10","preview":"\nWhether you're a developer just starting with Java or a senior engineer with two decades of experience, the most frequently encountered err"},{"id":"post8","lang":"en","title":"PostgreSQL MVCC Internals: From xmin/xmax to Isolation Levels","date":"2025-07-06","section":"tech","tags":"PostgreSQL","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7rk467sodudw3ww7iisi.png","description":"Deep dive into PostgreSQL's MVCC implementation, understanding xmin/xmax and how different isolation levels work internally","searchKeywords":"PostgreSQL, MVCC, xmin, xmax, transaction, isolation level, concurrency control","preview":"\nWhen multiple users access a database concurrently, how can we guarantee Isolation, one of the core `ACID` properties? While we could apply"},{"id":"post7","lang":"en","title":"Prompt Engineering Tips from Anthropic Engineers","date":"2025-06-24","section":"tech","tags":"Prompt Engineering, AI, Anthropic, LLM","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fdzzrfth8zqdnrhbj9538.png","description":"Valuable prompt engineering tips and insights from Anthropic engineers","searchKeywords":"prompt engineering, AI tips, Anthropic, LLM best practices","translationSlug":"post22","preview":"\nHere are a few impressive points from [youtube (AI prompt engineering: A deep dive)](https://www.youtube.com/watch?v=T9aRN5JkmL8\u0026t=2463s) w"},{"id":"post6","lang":"en","title":"From Theory to Practice: A JMH Showdown Between Sequential and Parallel Streams","date":"2025-06-15","section":"tech","tags":"Java, JMH","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7ytq239pcfe279t9avzg.png","description":"Practical performance comparison between sequential and parallel streams using JMH benchmarking","searchKeywords":"JMH benchmark, Java performance, sequential vs parallel, stream optimization","preview":"\nIn our [previous post](https://dev.to/headf1rst/discover-how-forkjoinpool-powers-javas-high-performance-parallel-processing-3pn7), we delve"},{"id":"post5","lang":"en","title":"Discover how ForkJoinPool powers Java's high-performance parallel processing","date":"2025-06-03","section":"tech","tags":"ForkJoinPool","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qgawc6pj2vbyzuem20wn.png","description":"Understanding ForkJoinPool and how it powers Java's parallel stream processing","searchKeywords":"ForkJoinPool, Java parallel processing, work-stealing, parallelStream","preview":"\nRecently, I optimized our transport operation plan Excel upload feature, boosting performance for logistics system administrators. This too"},{"id":"post4","lang":"en","title":"Why @Transactional Sometimes Fails: A Deep Dive into Spring AOP Proxies","section":"tech","date":"2025-06-01","tags":"AOP, Transactional","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/a1wxef2amdixh3lr4any.png","description":"Understanding Spring AOP proxies and why @Transactional sometimes fails with internal method calls","searchKeywords":"Spring AOP, @Transactional, proxy pattern, self-invocation","preview":"\n## How @Transactional Works\n\n### Transaction Management via AOP and the Proxy Pattern\n\nAOP (Aspect-Oriented Programming) is a programming p"},{"id":"post3","lang":"en","title":"Java ClassLoaders: How the JVM Dynamically Loads \u0026 Executes Your Code","section":"tech","date":"2025-05-27","tags":"Java","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/iu4pe4d29jz23wt26kwz.png","description":"Deep dive into Java ClassLoaders and JVM's dynamic class loading mechanisms","searchKeywords":"Java ClassLoader, JVM, dynamic loading, class loading process","preview":"\nJava's \"Write Once, Run Anywhere\" principle is foundational to its sustained popularity. This portability is powered by the Java Virtual Ma"},{"id":"post2","lang":"en","title":"Understanding and Resolving the N+1 Query Problem in JPA","section":"tech","date":"2025-05-05","tags":"JPA, Hibernate, N+1 Problem","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fsrf6chohgt3athvqj7u1.png","description":"Learn what causes the N+1 query problem in JPA, how to identify it, and practical solutions using fetch joins, EntityGraph, and QueryDSL","searchKeywords":"JPA, N+1, Hibernate, performance, optimization, fetch join, EntityGraph, QueryDSL","preview":"\nThe **N+1 query problem** arises when one initial query (1) is followed by N additional queriesâ€”one for each result row from the first quer"},{"id":"post1","lang":"en","title":"Kafka Producer Stability Check: Ensuring Message Safety in Apache Kafka","section":"tech","date":"2025-05-04","tags":"Kafka, Producer, Reliability, Apache Kafka","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ojt2w7s7rr9kws35r2yg.png","description":"Learn how to build fault-tolerant Kafka producers that survive rolling patches and broker failures","searchKeywords":"Kafka, producer, reliability, message safety, rolling patch, broker failure","preview":"\nDuring a recent incident, our team observed message loss from a Kafka producer during an Amazon MSK rolling patch. What began as a routine "}]},"__N_SSG":true},"page":"/[lang]/[id]","query":{"lang":"ko","id":"post33"},"buildId":"vjSj3GbVwS7vkZ0Aa3KlF","assetPrefix":"/log","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>