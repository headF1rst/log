<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/2nHGFTv.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><title>ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ</title><meta name="title" content="ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ"/><meta name="description" content="Transactional ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ"/><meta name="keywords" content="transactional, spring, aop"/><meta name="robots" content="index, follow"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="language" content="Korean"/><meta name="author" content="Sanha Ko"/><meta property="og:title" content="ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ"/><meta property="og:url" content="https://headf1rst.github.io/log/ko/post29"/><meta property="og:type" content="blog"/><meta property="og:image" content="https://velog.velcdn.com/images/uiurihappy/post/0c13062e-e5cb-45f0-9727-a9ef018b1ffc/image.png"/><meta property="og:description" content="Transactional ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ"/><link rel="alternate" hrefLang="ko" href="https://headf1rst.github.io/log/ko/post29"/><link rel="alternate" hrefLang="x-default" href="https://headf1rst.github.io/log/ko/post29"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ","datePublished":"2024-10-01 10:00","dateModified":"2024-10-01 10:00","author":{"@type":"Person","name":"Sanha Ko"},"description":"Transactional ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ","image":"https://velog.velcdn.com/images/uiurihappy/post/0c13062e-e5cb-45f0-9727-a9ef018b1ffc/image.png","url":"https://headf1rst.github.io/TIL/ko/post29","keywords":"transactional","inLanguage":"ko-KR","publisher":{"@type":"Organization","name":"headF1rst","logo":{"@type":"ImageObject","url":"https://headf1rst.github.io/TIL/favicon.ico"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://headf1rst.github.io/TIL/ko/post29"}}</script><meta name="next-head-count" content="25"/><link rel="preload" href="/log/_next/static/css/437194234ad87d89.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/437194234ad87d89.css" data-n-g=""/><link rel="preload" href="/log/_next/static/css/38994dd0aed51f22.css" as="style"/><link rel="stylesheet" href="/log/_next/static/css/38994dd0aed51f22.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/log/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/log/_next/static/chunks/webpack-1b0decc0375da57b.js" defer=""></script><script src="/log/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/log/_next/static/chunks/main-6e6d6dc6617c8481.js" defer=""></script><script src="/log/_next/static/chunks/pages/_app-7797c1cc757d9cb4.js" defer=""></script><script src="/log/_next/static/chunks/pages/%5Blang%5D/%5Bid%5D-81798309aa500efe.js" defer=""></script><script src="/log/_next/static/cw6uK4UnfZBis5R_g8eEP/_buildManifest.js" defer=""></script><script src="/log/_next/static/cw6uK4UnfZBis5R_g8eEP/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="flex bg-white sticky top-0 left-0 z-50 justify-between items-center border-b-2 border-gray-100 py-3 md:justify-start md:space-x-10 px-10 sm:px-5 dark:bg-[#0d1117] dark:text-[#c9d1d9] dark:border-gray-600"><div class="flex justify-start"><a href="/log/ko/"><div class="flex items-center gap-2 cursor-pointer"><h1 class="text-lg ">JustAnotherBlog</h1></div></a></div><div class="flex justify-between gap-10 sm:hidden items-center"><a href="/log/ko/"><button class="font-light hover:text-indigo-300 text-base">Home</button></a><a href="/log/ko/?section=tech"><button class="font-light hover:text-indigo-300 text-base">Tech</button></a><a href="/log/ko/?section=domain"><button class="font-light hover:text-indigo-300 text-base">Domain</button></a><a href="https://plain-composer-c65.notion.site/29c7640fdf054059b6ea28ed61189bfb" target="_blank" rel="noreferrer" class="hover:text-indigo-300 text-base font-light flex gap-1">About<span class="flex justify-center" style="align-items:center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z"></path><path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"></path></svg></span></a><div class="relative"><button class="flex items-center gap-1 hover:text-indigo-300 text-base font-light">ğŸ‡°ğŸ‡·<!-- --> <!-- -->í•œêµ­ì–´</button></div></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="lg:hidden" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></nav><main class="dark:bg-[#0d1117] h-screen pb-10"><div class="flex flex-col w-3/5 sm:w-5/6 m-auto pt-20 pb-20 gap-10 dark:bg-[#0d1117] dark:text-[#c9d1d9]"><ul id="scroll-spy" class="sm:hidden p-10 fixed top-50 right-0 h-full w-1/5 text-gray-500 dark:text-[#c9d1d9]"></ul><div class="text-5xl font-bold">ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ</div><div class="flex flex-col gap-2"><div class="text-base text-gray-600 dark:text-gray-300">2024-10-01 10:00</div><div class="flex flex-wrap gap-2 dark:text-black sm:m-0"><span class="p-1 pl-3 pr-3 rounded-md bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition ease-in-out duration-200 text-sm">transactional</span></div></div><div class="flex items-center gap-2"><span class="text-sm text-gray-400">ğŸ‡ºğŸ‡¸ ì˜ì–´ë¡œ ì½ê¸°</span></div><div class="markdown-body" style="font-size:17px"><h1>@Transactional ë™ì‘ ì›ë¦¬</h1>
<h2>AOPì™€ í”„ë¡ì‹œ íŒ¨í„´ì„ í†µí•œ íŠ¸ëœì­ì…˜ ê´€ë¦¬</h2>
<p>AOPëŠ” ì—”í„°í”„ë¼ì´ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ì„œ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°(OOP)ì˜ í•œê³„ë¥¼ ë³´ì™„í•´ì£¼ëŠ” ë³´ì¡°ì ì¸ í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì´ë‹¤. ì´ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜, ìºì‹±, ë¡œê¹… ê°™ì€ ë¶€ê°€ì ì¸ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ê³  ëª¨ë“ˆí™”í•˜ì—¬ ê°œë°œìê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•œë‹¤.</p>
<p>ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ íŒ¨í„´ì„ ì´ìš©í•´ AOPë¥¼ ì§€ì›í•œë‹¤. í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ë¡œì˜ ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì‹¤í–‰ë˜ê¸° ì „í›„ì— ê³µí†µ ê¸°ëŠ¥ì„ ì ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.</p>
<p>íŠ¸ëœì­ì…˜ ê´€ë¦¬ë„ ë§ˆì°¬ê°€ì§€ë¡œ, @Transactionalì´ ì ìš©ëœ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ê¸° ì „í›„ì— í”„ë¡ì‹œ ê°ì²´ê°€ íŠ¸ëœì­ì…˜ ì‹œì‘ê³¼ ì¢…ë£Œë¥¼ ì²˜ë¦¬í•œë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì–´ë–»ê²Œ ìƒì„±ë ê¹Œ?</p>
<h2>Spring AOPì˜ ë‘ ê°€ì§€ í”„ë¡ì‹œ ë°©ì‹</h2>
<p>ìŠ¤í”„ë§ì€ í”„ë¡ì‹œ ê°ì²´ ìƒì„±ì„ ìœ„í•´ JDK ë™ì  í”„ë¡ì‹œì™€ CGLIB í”„ë¡ì‹œ, ë‘ ê°€ì§€ ë°©ì‹ì„ ì œê³µí•œë‹¤.</p>
<h3>1. JDK ë™ì  í”„ë¡ì‹œ</h3>
<p>JDKì˜ java.lang.reflect.Proxy í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ ìƒì„±í•œë‹¤. íƒ€ê²Ÿ ê°ì²´ëŠ” ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•˜ë©°, ê·¸ ì¸í„°í˜ì´ìŠ¤ì˜ ì¶”ìƒ ë©”ì„œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.</p>
<p><img src="https://i.imgur.com/V8LdLQg.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í”„ë¡ì‹œ ê°ì²´ëŠ” InvocationHandlerë¥¼ í†µí•´ íƒ€ê²Ÿ ë©”ì„œë“œë¡œì˜ ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ê³  ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤.</p>
<p>ë§Œì•½ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì´ì™¸ì— ë¡œê¹… ì²˜ë¦¬ë¥¼ ì¶”ê°€ë¡œ íƒ€ê²Ÿ ë©”ì„œë“œì— ë¶€ì—¬í•˜ë©´ ê·¸ì— í•„ìš”í•œ í”„ë¡ì‹œ ê°ì²´ê°€ í•˜ë‚˜ ë” ìƒì„±ë˜ë©° ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ê°ì²´ê°€ í˜¸ì¶œëœë‹¤.</p>
<blockquote>
<p>ProxyLogging -&gt; ProxyTransaction -&gt; Target</p>
</blockquote>
<h3>2. CGLIB í”„ë¡ì‹œ (ê¸°ë³¸ ë°©ì‹)</h3>
<p>CGLIB(Code Generation Library)ëŠ” ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•´ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. JDK ë™ì  í”„ë¡ì‹œì™€ ë‹¬ë¦¬, íƒ€ê²Ÿ ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ë¯€ë¡œ íƒ€ê²Ÿ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. í”„ë¡ì‹œ ê°ì²´ëŠ” íƒ€ê²Ÿ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ í˜¸ì¶œì„ ê°€ë¡œì±„ê³ , ë©”ì„œë“œ ì‹¤í–‰ ì „í›„ì— ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤.</p>
<p>ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x ì´í›„ì—ëŠ” íƒ€ê¹ƒ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆëŠ”ì§€ì™€ ìƒê´€ì—†ì´ ê¸°ë³¸ì ìœ¼ë¡œ CGLIB í”„ë¡ì‹œ ë°©ì‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ë™ì‘í•œë‹¤.</p>
<blockquote>
<p><a href="https://www.springcloud.io/post/2022-01/springboot-aop/#gsc.tab=0">AOP in Spring Boot, is it a JDK dynamic proxy or a Cglib dynamic proxy?</a></p>
</blockquote>
<h1>ë‚´ë¶€ ë©”ì„œë“œì™€ AOP í”„ë¡ì‹œ</h1>
<p>@Transactionalì´ ì–´ë–¤ ì›ë¦¬ë¡œ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ë³´ì•˜ìœ¼ë‹ˆ, ì´ì œ ë™ì¼ í´ë˜ìŠ¤ ë‚´ì—ì„œ ë‚´ë¶€ ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì™€ ê·¸ ì´ìœ ë¥¼ ì‚´í´ë³´ì.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Service</span><span>  
</span><span></span><span style="color:#4078f2">@RequiredArgsConstructor</span><span>  
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportService</span><span class="hljs-class"> </span><span>{  
</span>  
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">final</span><span> TransportRepository transportRepository;  
</span>  
<span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">sendTransportEvents</span><span class="hljs-function hljs-params">(List&lt;Long&gt; transportIds)</span><span class="hljs-function"> </span><span>{  
</span>        transportRepository.changeStatuses(transportIds);  
<span>        </span><span style="color:#a0a1a7;font-style:italic">// ì „ì†¡...  </span><span>
</span>    }  
<!-- -->}</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Repository</span><span>  
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">interface</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportRepository</span><span class="hljs-class"> </span><span>{  
</span>  
<span>    </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">save</span><span class="hljs-function hljs-params">(Transport transport)</span><span>;  
</span>  
<span>    </span><span class="hljs-function" style="color:#a626a4">default</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">changeStatuses</span><span class="hljs-function hljs-params">(List&lt;Long&gt; transportIds)</span><span class="hljs-function"> </span><span>{  
</span><span>        </span><span style="color:#a626a4">for</span><span> (Long transportId : transportIds) {  
</span>            changeStatus(transportId);  
<!-- -->        }  
<!-- -->    }  
<!-- -->  
<span>    </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">changeStatus</span><span class="hljs-function hljs-params">(Long transportId)</span><span>;  
</span>  
<span>    </span><span class="hljs-function">Optional&lt;Transport&gt; </span><span class="hljs-function" style="color:#4078f2">findById</span><span class="hljs-function hljs-params">(Long id)</span><span>;  
</span>}</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Repository</span><span>  
</span><span></span><span style="color:#4078f2">@RequiredArgsConstructor</span><span>  
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportRepositoryImpl</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#a626a4">implements</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportRepository</span><span class="hljs-class"> </span><span>{  
</span>  
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">final</span><span> TransportJpaRepository transportJpaRepository;  
</span>  
<span>    </span><span style="color:#4078f2">@Override</span><span>  
</span><span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">save</span><span class="hljs-function hljs-params">(Transport transport)</span><span class="hljs-function"> </span><span>{  
</span>        transportJpaRepository.save(transport);  
<!-- -->    }
<!-- -->
<span>    </span><span style="color:#4078f2">@Transactional(propagation = Propagation.REQUIRES_NEW)</span><span>
</span><span>    </span><span style="color:#4078f2">@Override</span><span>    
</span><span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">changeStatus</span><span class="hljs-function hljs-params">(Long transportId)</span><span class="hljs-function"> </span><span>{  
</span>        Transport transport = transportJpaRepository.findById(transportId).orElseThrow();  
<!-- -->        transport.updateStatus(TransportStatus.SENT);  
<!-- -->    }  
<!-- -->  
<span>    </span><span style="color:#4078f2">@Override</span><span>  
</span><span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> Optional&lt;Transport&gt; </span><span class="hljs-function" style="color:#4078f2">findById</span><span class="hljs-function hljs-params">(Long id)</span><span class="hljs-function"> </span><span>{  
</span><span>        </span><span style="color:#a626a4">return</span><span> transportJpaRepository.findById(id);  
</span>    }  
<!-- -->}</code></div></pre>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@SpringBootTest</span><span>  
</span><span></span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportServiceTest</span><span class="hljs-class"> </span><span>{  
</span>  
<span>    </span><span style="color:#4078f2">@Autowired</span><span>  
</span><span>    </span><span style="color:#a626a4">private</span><span> TransportService sut;  
</span><span>    </span><span style="color:#4078f2">@Autowired</span><span>  
</span><span>    </span><span style="color:#a626a4">private</span><span> TransportRepository transportRepository;  
</span>  
<span>    </span><span style="color:#4078f2">@Test</span><span>  
</span><span>    </span><span style="color:#a626a4">void</span><span> ìš´ì†¡_ì´ë²¤íŠ¸ê°€_ì „ì†¡ë˜ë©´ì„œ_ìƒíƒœë¥¼_SENTë¡œ_ë³€ê²½í•œë‹¤() {  
</span><span>        </span><span style="color:#a0a1a7;font-style:italic">// given  </span><span>
</span><span>        </span><span style="color:#a626a4">var</span><span> transportA = </span><span style="color:#a626a4">new</span><span> Transport(</span><span style="color:#986801">1L</span><span>, TransportStatus.PENDING);  
</span><span>        </span><span style="color:#a626a4">var</span><span> transportB = </span><span style="color:#a626a4">new</span><span> Transport(</span><span style="color:#986801">2L</span><span>, TransportStatus.PENDING);  
</span>        List.of(transportA, transportB).forEach(transportRepository::save);  
<!-- -->  
<span>        </span><span style="color:#a0a1a7;font-style:italic">// when  </span><span>
</span><span>        sut.sendTransportEvents(List.of(</span><span style="color:#986801">1L</span><span>, </span><span style="color:#986801">2L</span><span>));  
</span>  
<span>        </span><span style="color:#a0a1a7;font-style:italic">// then  </span><span>
</span><span>        </span><span style="color:#a626a4">var</span><span> result1 = transportRepository.findById(</span><span style="color:#986801">1L</span><span>).get();  
</span><span>        </span><span style="color:#a626a4">var</span><span> result2 = transportRepository.findById(</span><span style="color:#986801">2L</span><span>).get();  
</span>  
<!-- -->        assertThat(result1.getStatus()).isEqualTo(TransportStatus.SENT);  
<!-- -->        assertThat(result2.getStatus()).isEqualTo(TransportStatus.SENT);  
<!-- -->    }  
<!-- -->}</code></div></pre>
<p>TransportRepositoryImpl.changeStatus(transportId)ì—ì„œ JPAì˜ ë”í‹° ì²´í‚¹ì„ í™œìš©í•´ transportì˜ ìƒíƒœ ê°’ì„ PENDINGì—ì„œ SENTë¡œ ë³€ê²½ì„ ì‹œë„í•˜ê³  ìˆë‹¤.</p>
<p>JPAì˜ ë”í‹° ì²´í‚¹ì´ ì˜ë„í•œ ëŒ€ë¡œ ë™ì‘í•œë‹¤ë©´ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•´ì•¼ í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ë©° ìƒíƒœ ê°’ì€ ê·¸ëŒ€ë¡œ PENDINGìœ¼ë¡œ ë³€í•˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.</p>
<p><img src="https://i.imgur.com/RI75mwO.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<h2>ì™œ ì´ëŸ° ì¼ì´ ë°œìƒí• ê¹Œ?</h2>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span style="color:#4078f2">@Repository</span><span>  
</span><span></span><span style="color:#4078f2">@RequiredArgsConstructor</span><span>  
</span><span></span><span style="color:#4078f2">@Slf4j</span><span>  
</span><span></span><span style="color:#a626a4">public</span><span> </span><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportRepositoryImpl</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#a626a4">implements</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">TransportRepository</span><span class="hljs-class"> </span><span>{  
</span>  
<span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">final</span><span> TransportJpaRepository transportJpaRepository;  
</span><span>    </span><span style="color:#a626a4">private</span><span> </span><span style="color:#a626a4">final</span><span> EntityManager em;  
</span>
<span>	</span><span style="color:#a0a1a7;font-style:italic">// ...</span><span>
</span>
<span>    </span><span style="color:#4078f2">@Transactional(propagation = Propagation.REQUIRES_NEW)</span><span>
</span><span>    </span><span style="color:#4078f2">@Override</span><span>    
</span><span>    </span><span class="hljs-function" style="color:#a626a4">public</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">changeStatus</span><span class="hljs-function hljs-params">(Long transportId)</span><span class="hljs-function"> </span><span>{    
</span>        Transport transport = transportJpaRepository.findById(transportId).orElseThrow();  
<!-- -->        transport.updateStatus(TransportStatus.SENT);  
<!-- -->  
<span>        </span><span style="color:#a626a4">if</span><span> (em.contains(transport)) {  
</span><span>            log.info(</span><span style="color:#50a14f">&quot;Entity is managed&quot;</span><span>);  
</span><span>        } </span><span style="color:#a626a4">else</span><span> {  
</span><span>            log.info(</span><span style="color:#50a14f">&quot;Entity is detached&quot;</span><span>);  
</span>        }
<!-- -->        
<span>        log.info(</span><span style="color:#50a14f">&quot;Transaction active: {}&quot;</span><span>, TransactionSynchronizationManager.isActualTransactionActive());  
</span>    }
<!-- -->}</code></div></pre>
<p>ë”í‹° ì²´í‚¹ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë ¤ë©´ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ê³  ìˆì–´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì•„ë˜ ë¡œê·¸ë¥¼ ë³´ë©´ Transport ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” í•´ë‹¹ ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<p><img src="https://i.imgur.com/BANQI7X.png" alt="Post image" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°ëŠ” íŠ¸ëœì­ì…˜ê³¼ ë™ì¼í•˜ë‹¤. íŠ¸ëœì­ì…˜ì´ í™œì„±í™”ë˜ì§€ ì•Šìœ¼ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šê³ , ë”°ë¼ì„œ ì—”í‹°í‹°ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤. ê²°êµ­, íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì€ <code node="[object Object]">changeStatus()</code> ë©”ì„œë“œì—ì„œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”í‹° ì²´í‚¹ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.</p>
<p>ìŠ¤í”„ë§ì€ CGLIBì„ ì‚¬ìš©í•´ <code node="[object Object]">TransportRepositoryImpl</code> ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” <code node="[object Object]">@Transactional</code>ì´ ë¶™ì€ <code node="[object Object]">changeStatus()</code> ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬, íŠ¸ëœì­ì…˜ ê´€ë ¨ ë¡œì§ì„ ë©”ì„œë“œ í˜¸ì¶œ ì „í›„ì— ì‚½ì…í•œë‹¤.</p>
<p>ë¬¸ì œëŠ” <code node="[object Object]">changeStatuses()</code> ë©”ì„œë“œê°€ ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ <code node="[object Object]">changeStatus()</code>ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ë°œìƒí•œë‹¤. ìŠ¤í”„ë§ í”„ë¡ì‹œëŠ” í´ë˜ìŠ¤ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë˜ëŠ” ê²½ìš°ì—ë§Œ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ìê¸° ìì‹  ë‚´ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œëŠ” í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>
<h3>ì™œ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šì„ê¹Œ?</h3>
<p>ìŠ¤í”„ë§ AOPì—ì„œ í”„ë¡ì‹œëŠ” ì™¸ë¶€ í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ì¶œí•  ë•Œ ë™ì‘í•œë‹¤. ì™¸ë¶€ì—ì„œ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, í”„ë¡ì‹œëŠ” ì´ í˜¸ì¶œì„ ê°€ë¡œì±„ê³  íŠ¸ëœì­ì…˜ ë“±ì˜ ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤. ê·¸ëŸ¬ë‚˜ ë™ì¼ í´ë˜ìŠ¤ ë‚´ì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ëŠ” ì™¸ë¶€ í˜¸ì¶œì´ ì•„ë‹ˆë¼ ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì‹¤ì œ ë©”ì„œë“œê°€ ì§ì ‘ í˜¸ì¶œëœë‹¤.</p>
<p>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ <code node="[object Object]">@Transactional</code>ì„ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œì— ì ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤. í˜¹ì€ ë‚´ë¶€ ë©”ì„œë“œë¥¼ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•´ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.</p>
<h3>ë§ˆë¬´ë¦¬</h3>
<p>@Transactionalì˜ ë™ì‘ ì›ë¦¬ì— ëŒ€í•´ ì–´ëŠ ì •ë„ ì•Œê³  ìˆë‹¤ê³  ìƒê°í–ˆëŠ”ë° ì´ë²ˆ ë¬¸ì œë¥¼ ê²ªìœ¼ë©´ì„œ ì•„ì§ ëª…í™•íˆ ì •ë¦¬ë˜ì–´ ìˆì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ëŠë¼ê²Œ ë˜ì—ˆë‹¤.</p>
<p>ê¸€ì„ ì‘ì„±í•˜ë©´ì„œ ì •ë¦¬ë˜ì§€ ì•Šê³  ì ìœ¼ë¡œë§Œ ì¡´ì¬í•˜ë˜ ì§€ì‹ì´ ì„ ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ë“¯í•œ ëŠë‚Œì„ ë°›ì•˜ë‹¤. ë°”ì˜ë‹¤ê³  ê¸€ ì“°ëŠ” ê±¸ ë¯¸ë£¨ì§€ ë§ê³  ê¸€ë¡œ ì§€ì‹ê³¼ ê²½í—˜ì„ ë‚´ì¬í™”í•˜ëŠ” ìŠµê´€ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•´ì•¼ê² ë‹¤.</p>
<hr/>
<p><strong>ì°¸ê³  ìë£Œ</strong></p>
<ul>
<li><a href="https://docs.spring.io/spring-framework/reference/core/aop/proxying.html">Proxying Mechanisms</a></li>
<li><a href="https://www.quora.com/In-Java-why-are-dynamic-proxies-only-allowed-to-proxy-interface-classes">In Java, why are dynamic proxies only allowed to proxy interface classes?</a></li>
</ul></div><section></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"post29","lang":"ko","title":"ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ","section":"tech","thumbnail":"https://velog.velcdn.com/images/uiurihappy/post/0c13062e-e5cb-45f0-9727-a9ef018b1ffc/image.png","tags":"transactional","date":"2024-10-01 10:00","searchKeywords":"transactional, spring, aop","description":"Transactional ë‚´ë¶€ ë©”ì„œë“œ í˜¸ì¶œì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ","preview":"\n# @Transactional ë™ì‘ ì›ë¦¬\n\n## AOPì™€ í”„ë¡ì‹œ íŒ¨í„´ì„ í†µí•œ íŠ¸ëœì­ì…˜ ê´€ë¦¬\n\nAOPëŠ” ì—”í„°í”„ë¼ì´ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ì„œ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°(OOP)ì˜ í•œê³„ë¥¼ ë³´ì™„í•´ì£¼ëŠ” ë³´ì¡°ì ì¸ í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì´ë‹¤. ì´ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜, ìºì‹±, ë¡œê¹… "},"detail":"\n# @Transactional ë™ì‘ ì›ë¦¬\n\n## AOPì™€ í”„ë¡ì‹œ íŒ¨í„´ì„ í†µí•œ íŠ¸ëœì­ì…˜ ê´€ë¦¬\n\nAOPëŠ” ì—”í„°í”„ë¼ì´ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ì„œ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°(OOP)ì˜ í•œê³„ë¥¼ ë³´ì™„í•´ì£¼ëŠ” ë³´ì¡°ì ì¸ í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì´ë‹¤. ì´ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜, ìºì‹±, ë¡œê¹… ê°™ì€ ë¶€ê°€ì ì¸ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ê³  ëª¨ë“ˆí™”í•˜ì—¬ ê°œë°œìê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•œë‹¤.\n\nìŠ¤í”„ë§ì€ í”„ë¡ì‹œ íŒ¨í„´ì„ ì´ìš©í•´ AOPë¥¼ ì§€ì›í•œë‹¤. í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ë¡œì˜ ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì‹¤í–‰ë˜ê¸° ì „í›„ì— ê³µí†µ ê¸°ëŠ¥ì„ ì ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.\n\níŠ¸ëœì­ì…˜ ê´€ë¦¬ë„ ë§ˆì°¬ê°€ì§€ë¡œ, @Transactionalì´ ì ìš©ëœ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ê¸° ì „í›„ì— í”„ë¡ì‹œ ê°ì²´ê°€ íŠ¸ëœì­ì…˜ ì‹œì‘ê³¼ ì¢…ë£Œë¥¼ ì²˜ë¦¬í•œë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì–´ë–»ê²Œ ìƒì„±ë ê¹Œ?\n\n## Spring AOPì˜ ë‘ ê°€ì§€ í”„ë¡ì‹œ ë°©ì‹\n\nìŠ¤í”„ë§ì€ í”„ë¡ì‹œ ê°ì²´ ìƒì„±ì„ ìœ„í•´ JDK ë™ì  í”„ë¡ì‹œì™€ CGLIB í”„ë¡ì‹œ, ë‘ ê°€ì§€ ë°©ì‹ì„ ì œê³µí•œë‹¤.\n\n### 1. JDK ë™ì  í”„ë¡ì‹œ\n\nJDKì˜ java.lang.reflect.Proxy í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ ìƒì„±í•œë‹¤. íƒ€ê²Ÿ ê°ì²´ëŠ” ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•˜ë©°, ê·¸ ì¸í„°í˜ì´ìŠ¤ì˜ ì¶”ìƒ ë©”ì„œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.\n\n![Drawing 2024-09-25 18.44.13.excalidraw](https://i.imgur.com/V8LdLQg.png)\n\nì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í”„ë¡ì‹œ ê°ì²´ëŠ” InvocationHandlerë¥¼ í†µí•´ íƒ€ê²Ÿ ë©”ì„œë“œë¡œì˜ ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ê³  ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤.\n\në§Œì•½ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì´ì™¸ì— ë¡œê¹… ì²˜ë¦¬ë¥¼ ì¶”ê°€ë¡œ íƒ€ê²Ÿ ë©”ì„œë“œì— ë¶€ì—¬í•˜ë©´ ê·¸ì— í•„ìš”í•œ í”„ë¡ì‹œ ê°ì²´ê°€ í•˜ë‚˜ ë” ìƒì„±ë˜ë©° ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ê°ì²´ê°€ í˜¸ì¶œëœë‹¤.\n\n\u003e ProxyLogging -\u003e ProxyTransaction -\u003e Target\n\n### 2. CGLIB í”„ë¡ì‹œ (ê¸°ë³¸ ë°©ì‹)\n\nCGLIB(Code Generation Library)ëŠ” ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•´ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. JDK ë™ì  í”„ë¡ì‹œì™€ ë‹¬ë¦¬, íƒ€ê²Ÿ ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ë¯€ë¡œ íƒ€ê²Ÿ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. í”„ë¡ì‹œ ê°ì²´ëŠ” íƒ€ê²Ÿ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ í˜¸ì¶œì„ ê°€ë¡œì±„ê³ , ë©”ì„œë“œ ì‹¤í–‰ ì „í›„ì— ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤.\n\nìŠ¤í”„ë§ ë¶€íŠ¸ 2.x ì´í›„ì—ëŠ” íƒ€ê¹ƒ ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆëŠ”ì§€ì™€ ìƒê´€ì—†ì´ ê¸°ë³¸ì ìœ¼ë¡œ CGLIB í”„ë¡ì‹œ ë°©ì‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ë™ì‘í•œë‹¤.\n\n\u003e [AOP in Spring Boot, is it a JDK dynamic proxy or a Cglib dynamic proxy?](https://www.springcloud.io/post/2022-01/springboot-aop/#gsc.tab=0)\n\n# ë‚´ë¶€ ë©”ì„œë“œì™€ AOP í”„ë¡ì‹œ\n\n@Transactionalì´ ì–´ë–¤ ì›ë¦¬ë¡œ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ë³´ì•˜ìœ¼ë‹ˆ, ì´ì œ ë™ì¼ í´ë˜ìŠ¤ ë‚´ì—ì„œ ë‚´ë¶€ ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì™€ ê·¸ ì´ìœ ë¥¼ ì‚´í´ë³´ì.\n\n```java\n@Service  \n@RequiredArgsConstructor  \npublic class TransportService {  \n  \n    private final TransportRepository transportRepository;  \n  \n    public void sendTransportEvents(List\u003cLong\u003e transportIds) {  \n        transportRepository.changeStatuses(transportIds);  \n        // ì „ì†¡...  \n    }  \n}\n```\n\n```java\n@Repository  \npublic interface TransportRepository {  \n  \n    void save(Transport transport);  \n  \n    default void changeStatuses(List\u003cLong\u003e transportIds) {  \n        for (Long transportId : transportIds) {  \n            changeStatus(transportId);  \n        }  \n    }  \n  \n    void changeStatus(Long transportId);  \n  \n    Optional\u003cTransport\u003e findById(Long id);  \n}\n```\n\n```java\n@Repository  \n@RequiredArgsConstructor  \npublic class TransportRepositoryImpl implements TransportRepository {  \n  \n    private final TransportJpaRepository transportJpaRepository;  \n  \n    @Override  \n    public void save(Transport transport) {  \n        transportJpaRepository.save(transport);  \n    }\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    @Override    \n    public void changeStatus(Long transportId) {  \n        Transport transport = transportJpaRepository.findById(transportId).orElseThrow();  \n        transport.updateStatus(TransportStatus.SENT);  \n    }  \n  \n    @Override  \n    public Optional\u003cTransport\u003e findById(Long id) {  \n        return transportJpaRepository.findById(id);  \n    }  \n}\n```\n\n```java\n@SpringBootTest  \nclass TransportServiceTest {  \n  \n    @Autowired  \n    private TransportService sut;  \n    @Autowired  \n    private TransportRepository transportRepository;  \n  \n    @Test  \n    void ìš´ì†¡_ì´ë²¤íŠ¸ê°€_ì „ì†¡ë˜ë©´ì„œ_ìƒíƒœë¥¼_SENTë¡œ_ë³€ê²½í•œë‹¤() {  \n        // given  \n        var transportA = new Transport(1L, TransportStatus.PENDING);  \n        var transportB = new Transport(2L, TransportStatus.PENDING);  \n        List.of(transportA, transportB).forEach(transportRepository::save);  \n  \n        // when  \n        sut.sendTransportEvents(List.of(1L, 2L));  \n  \n        // then  \n        var result1 = transportRepository.findById(1L).get();  \n        var result2 = transportRepository.findById(2L).get();  \n  \n        assertThat(result1.getStatus()).isEqualTo(TransportStatus.SENT);  \n        assertThat(result2.getStatus()).isEqualTo(TransportStatus.SENT);  \n    }  \n}\n```\n\nTransportRepositoryImpl.changeStatus(transportId)ì—ì„œ JPAì˜ ë”í‹° ì²´í‚¹ì„ í™œìš©í•´ transportì˜ ìƒíƒœ ê°’ì„ PENDINGì—ì„œ SENTë¡œ ë³€ê²½ì„ ì‹œë„í•˜ê³  ìˆë‹¤.\n\nJPAì˜ ë”í‹° ì²´í‚¹ì´ ì˜ë„í•œ ëŒ€ë¡œ ë™ì‘í•œë‹¤ë©´ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•´ì•¼ í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ë©° ìƒíƒœ ê°’ì€ ê·¸ëŒ€ë¡œ PENDINGìœ¼ë¡œ ë³€í•˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.\n\n![ìŠ¤í¬ë¦°ìƒ· 2024-10-01 ì˜¤ì „ 2.05.54.png](https://i.imgur.com/RI75mwO.png)\n\n## ì™œ ì´ëŸ° ì¼ì´ ë°œìƒí• ê¹Œ?\n\n```java\n@Repository  \n@RequiredArgsConstructor  \n@Slf4j  \npublic class TransportRepositoryImpl implements TransportRepository {  \n  \n    private final TransportJpaRepository transportJpaRepository;  \n    private final EntityManager em;  \n\n\t// ...\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    @Override    \n    public void changeStatus(Long transportId) {    \n        Transport transport = transportJpaRepository.findById(transportId).orElseThrow();  \n        transport.updateStatus(TransportStatus.SENT);  \n  \n        if (em.contains(transport)) {  \n            log.info(\"Entity is managed\");  \n        } else {  \n            log.info(\"Entity is detached\");  \n        }\n        \n        log.info(\"Transaction active: {}\", TransactionSynchronizationManager.isActualTransactionActive());  \n    }\n}\n```\n\në”í‹° ì²´í‚¹ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë ¤ë©´ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ê³  ìˆì–´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì•„ë˜ ë¡œê·¸ë¥¼ ë³´ë©´ Transport ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” í•´ë‹¹ ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.\n\n![ìŠ¤í¬ë¦°ìƒ· 2024-10-01 ì˜¤ì „ 2.35.24.png](https://i.imgur.com/BANQI7X.png)\n\nì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°ëŠ” íŠ¸ëœì­ì…˜ê³¼ ë™ì¼í•˜ë‹¤. íŠ¸ëœì­ì…˜ì´ í™œì„±í™”ë˜ì§€ ì•Šìœ¼ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šê³ , ë”°ë¼ì„œ ì—”í‹°í‹°ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤. ê²°êµ­, íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì€ `changeStatus()` ë©”ì„œë“œì—ì„œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”í‹° ì²´í‚¹ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.\n\nìŠ¤í”„ë§ì€ CGLIBì„ ì‚¬ìš©í•´ `TransportRepositoryImpl` ê°ì²´ë¥¼ ìƒì†í•˜ëŠ” í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” `@Transactional`ì´ ë¶™ì€ `changeStatus()` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬, íŠ¸ëœì­ì…˜ ê´€ë ¨ ë¡œì§ì„ ë©”ì„œë“œ í˜¸ì¶œ ì „í›„ì— ì‚½ì…í•œë‹¤.\n\në¬¸ì œëŠ” `changeStatuses()` ë©”ì„œë“œê°€ ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ `changeStatus()`ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ë°œìƒí•œë‹¤. ìŠ¤í”„ë§ í”„ë¡ì‹œëŠ” í´ë˜ìŠ¤ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë˜ëŠ” ê²½ìš°ì—ë§Œ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ìê¸° ìì‹  ë‚´ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œëŠ” í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.\n\n### ì™œ ë‚´ë¶€ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šì„ê¹Œ?\n\nìŠ¤í”„ë§ AOPì—ì„œ í”„ë¡ì‹œëŠ” ì™¸ë¶€ í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ì¶œí•  ë•Œ ë™ì‘í•œë‹¤. ì™¸ë¶€ì—ì„œ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, í”„ë¡ì‹œëŠ” ì´ í˜¸ì¶œì„ ê°€ë¡œì±„ê³  íŠ¸ëœì­ì…˜ ë“±ì˜ ë¶€ê°€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•œë‹¤. ê·¸ëŸ¬ë‚˜ ë™ì¼ í´ë˜ìŠ¤ ë‚´ì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ëŠ” ì™¸ë¶€ í˜¸ì¶œì´ ì•„ë‹ˆë¼ ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì‹¤ì œ ë©”ì„œë“œê°€ ì§ì ‘ í˜¸ì¶œëœë‹¤.\n\nì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `@Transactional`ì„ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œì— ì ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤. í˜¹ì€ ë‚´ë¶€ ë©”ì„œë“œë¥¼ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•´ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.\n\n### ë§ˆë¬´ë¦¬\n\n@Transactionalì˜ ë™ì‘ ì›ë¦¬ì— ëŒ€í•´ ì–´ëŠ ì •ë„ ì•Œê³  ìˆë‹¤ê³  ìƒê°í–ˆëŠ”ë° ì´ë²ˆ ë¬¸ì œë¥¼ ê²ªìœ¼ë©´ì„œ ì•„ì§ ëª…í™•íˆ ì •ë¦¬ë˜ì–´ ìˆì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ëŠë¼ê²Œ ë˜ì—ˆë‹¤.\n\nê¸€ì„ ì‘ì„±í•˜ë©´ì„œ ì •ë¦¬ë˜ì§€ ì•Šê³  ì ìœ¼ë¡œë§Œ ì¡´ì¬í•˜ë˜ ì§€ì‹ì´ ì„ ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ë“¯í•œ ëŠë‚Œì„ ë°›ì•˜ë‹¤. ë°”ì˜ë‹¤ê³  ê¸€ ì“°ëŠ” ê±¸ ë¯¸ë£¨ì§€ ë§ê³  ê¸€ë¡œ ì§€ì‹ê³¼ ê²½í—˜ì„ ë‚´ì¬í™”í•˜ëŠ” ìŠµê´€ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•´ì•¼ê² ë‹¤.\n\n---\n\n**ì°¸ê³  ìë£Œ**\n\n- [Proxying Mechanisms](https://docs.spring.io/spring-framework/reference/core/aop/proxying.html)\n- [In Java, why are dynamic proxies only allowed to proxy interface classes?](https://www.quora.com/In-Java-why-are-dynamic-proxies-only-allowed-to-proxy-interface-classes)\n","lang":"ko","allPostsInOtherLang":[{"id":"post9","lang":"en","title":"Solving the Billion-Dollar Mistake: Modern Java Null Safety with JSpecify and NullAway","date":"2025-09-24","section":"tech","tags":"Null Safety","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ftotx4mdagz9nsegld5mr.png","description":"Learn how to eliminate NullPointerExceptions using JSpecify annotations and NullAway static analysis in modern Java applications","searchKeywords":"JSpecify, NullAway, Java null safety, NullPointerException prevention, static analysis","preview":"\nWhether you're a developer just starting with Java or a senior engineer with two decades of experience, the most frequently encountered err"},{"id":"post8","lang":"en","title":"PostgreSQL MVCC Internals: From xmin/xmax to Isolation Levels","date":"2025-07-06","section":"tech","tags":"PostgreSQL","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7rk467sodudw3ww7iisi.png","description":"Deep dive into PostgreSQL's MVCC implementation, understanding xmin/xmax and how different isolation levels work internally","searchKeywords":"PostgreSQL, MVCC, xmin, xmax, transaction, isolation level, concurrency control","preview":"\nWhen multiple users access a database concurrently, how can we guarantee Isolation, one of the core `ACID` properties? While we could apply"},{"id":"post7","lang":"en","title":"Prompt Engineering Tips from Anthropic Engineers","date":"2025-06-24","section":"tech","tags":"Prompt Engineering, AI, Anthropic, LLM","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fdzzrfth8zqdnrhbj9538.png","description":"Valuable prompt engineering tips and insights from Anthropic engineers","searchKeywords":"prompt engineering, AI tips, Anthropic, LLM best practices","preview":"\nHere are a few impressive points from [youtube (AI prompt engineering: A deep dive)](https://www.youtube.com/watch?v=T9aRN5JkmL8\u0026t=2463s) w"},{"id":"post6","lang":"en","title":"From Theory to Practice: A JMH Showdown Between Sequential and Parallel Streams","date":"2025-06-15","section":"tech","tags":"Java, JMH","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F7ytq239pcfe279t9avzg.png","description":"Practical performance comparison between sequential and parallel streams using JMH benchmarking","searchKeywords":"JMH benchmark, Java performance, sequential vs parallel, stream optimization","preview":"\nIn our [previous post](https://dev.to/headf1rst/discover-how-forkjoinpool-powers-javas-high-performance-parallel-processing-3pn7), we delve"},{"id":"post5","lang":"en","title":"Discover how ForkJoinPool powers Java's high-performance parallel processing","date":"2025-06-03","section":"tech","tags":"ForkJoinPool","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/qgawc6pj2vbyzuem20wn.png","description":"Understanding ForkJoinPool and how it powers Java's parallel stream processing","searchKeywords":"ForkJoinPool, Java parallel processing, work-stealing, parallelStream","preview":"\nRecently, I optimized our transport operation plan Excel upload feature, boosting performance for logistics system administrators. This too"},{"id":"post4","lang":"en","title":"Why @Transactional Sometimes Fails: A Deep Dive into Spring AOP Proxies","section":"tech","date":"2025-06-01","tags":"AOP, Transactional","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/a1wxef2amdixh3lr4any.png","description":"Understanding Spring AOP proxies and why @Transactional sometimes fails with internal method calls","searchKeywords":"Spring AOP, @Transactional, proxy pattern, self-invocation","preview":"\n## How @Transactional Works\n\n### Transaction Management via AOP and the Proxy Pattern\n\nAOP (Aspect-Oriented Programming) is a programming p"},{"id":"post3","lang":"en","title":"Java ClassLoaders: How the JVM Dynamically Loads \u0026 Executes Your Code","section":"tech","date":"2025-05-27","tags":"Java","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/iu4pe4d29jz23wt26kwz.png","description":"Deep dive into Java ClassLoaders and JVM's dynamic class loading mechanisms","searchKeywords":"Java ClassLoader, JVM, dynamic loading, class loading process","preview":"\nJava's \"Write Once, Run Anywhere\" principle is foundational to its sustained popularity. This portability is powered by the Java Virtual Ma"},{"id":"post2","lang":"en","title":"Understanding and Resolving the N+1 Query Problem in JPA","section":"tech","date":"2025-05-05","tags":"JPA, Hibernate, N+1 Problem","thumbnail":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fsrf6chohgt3athvqj7u1.png","description":"Learn what causes the N+1 query problem in JPA, how to identify it, and practical solutions using fetch joins, EntityGraph, and QueryDSL","searchKeywords":"JPA, N+1, Hibernate, performance, optimization, fetch join, EntityGraph, QueryDSL","preview":"\nThe **N+1 query problem** arises when one initial query (1) is followed by N additional queriesâ€”one for each result row from the first quer"},{"id":"post1","lang":"en","title":"Kafka Producer Stability Check: Ensuring Message Safety in Apache Kafka","section":"tech","date":"2025-05-04","tags":"Kafka, Producer, Reliability, Apache Kafka","thumbnail":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ojt2w7s7rr9kws35r2yg.png","description":"Learn how to build fault-tolerant Kafka producers that survive rolling patches and broker failures","searchKeywords":"Kafka, producer, reliability, message safety, rolling patch, broker failure","preview":"\nDuring a recent incident, our team observed message loss from a Kafka producer during an Amazon MSK rolling patch. What began as a routine "}]},"__N_SSG":true},"page":"/[lang]/[id]","query":{"lang":"ko","id":"post29"},"buildId":"cw6uK4UnfZBis5R_g8eEP","assetPrefix":"/log","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>